(()=>{"use strict";const t=(()=>{const e=()=>JSON.parse(localStorage.getItem("projects")||"[]"),t=t=>{const n=e(),a=n.find((e=>e.id==t.id));a?(a.projectName=t.projectName,a.tasks=t.tasks):(t.id=Math.floor(1e6*Math.random()),n.push(t)),localStorage.setItem("projects",JSON.stringify(n))};return{getProjects:e,getTasks:t=>e().find((e=>e.id==t)).tasks,saveProject:t,deleteProject:t=>{const n=e().filter((e=>e.id!=t));localStorage.setItem("projects",JSON.stringify(n))},deleteTask:(n,a)=>{const s=e().find((e=>e.id==n)),o=s.tasks.filter((e=>e.taskId!=a));s.tasks=o,t(s)},findTaskToUpdate:(t,n)=>e().find((e=>e.id==t)).tasks.find((e=>e.taskId==n)),updateTask:(t,n)=>{const a=e(),s=a.find((e=>e.id==t)),o=s.tasks,r=o.findIndex((e=>e.taskId==n.taskId));o[r]=n,s.tasks=o,localStorage.setItem("projects",JSON.stringify(a))}}})(),n=(()=>{const e=()=>{const e=t.getProjects();n(e)},n=e=>{c(e)},a=e=>{d(e)};return{onProjectSelect:e=>{const n=t.getProjects().find((t=>t.id==e)),s=document.querySelector(`[data-project-id='${n.id}']`);a(s)},onProjectAdd:n=>{const s={projectName:n,tasks:[]};t.saveProject(s),e();const o=document.querySelector(`[data-project-id='${s.id}']`);a(o)},onProjectNameEdit:(n,a,s=t.getTasks(n))=>{t.saveProject({id:n,projectName:a,tasks:s}),e()},onTaskAdd:(e,n)=>{const a={item:e,taskId:Math.floor(1e6*Math.random()),priority:"low",dueDate:null,isComplete:!1},s=t.getProjects().find((e=>e.id==n));return s.tasks.push(a),t.saveProject(s),a},onTaskNameEdit:(e,n,a)=>{const s=t.findTaskToUpdate(e,n);t.updateTask(e,{item:a,taskId:s.taskId,priority:s.priority,dueDate:s.dueDate,isComplete:s.isComplete})},onTaskPriorityEdit:(e,n,a)=>{const s=t.findTaskToUpdate(e,n);t.updateTask(e,{item:s.item,taskId:s.taskId,priority:a,dueDate:s.dueDate,isComplete:s.isComplete})},onTaskDueDateEdit:(e,n,a)=>{const s=t.findTaskToUpdate(e,n);t.updateTask(e,{item:s.item,taskId:s.taskId,priority:s.priority,dueDate:a,isComplete:s.isComplete})},onTaskCompleteEdit:(e,n,a)=>{const s=t.findTaskToUpdate(e,n);t.updateTask(e,{item:s.item,taskId:s.taskId,priority:s.priority,dueDate:s.dueDate,isComplete:a})}}})(),a=()=>({createListElement:e=>{const t=document.createElement("li");return t.setAttribute("class",e),t},createSpanElement:e=>{const t=document.createElement("span");return t.classList.add(e),t},createImageElement:(e,t)=>{const n=document.createElement("img");return n.classList.add(t),n.setAttribute("src",e),n.setAttribute("draggable","false"),n},createInputField:e=>{const t=document.createElement("input");return t.setAttribute("type","text"),t.setAttribute("placeholder",e),t.setAttribute("id","user-input"),t.required=!0,t},createForm:()=>document.createElement("form"),createDiv:e=>{const t=document.createElement("div");return t.setAttribute("class",e),t}}),s=()=>{const e=a(),t=e.createSpanElement("icons"),n=e.createImageElement("images/edit-icon.svg","edit-icon"),s=e.createImageElement("images/delete-icon.svg","delete-icon");return n.classList.add("edit-project"),s.classList.add("delete-project"),t.append(n,s),t},o=e=>{const n=a(),s=t.getProjects().find((t=>t.id==e)).projectName,o=document.querySelector("#writing-area"),r=n.createDiv("project");r.setAttribute("data-project-id",e);const c=n.createDiv("skip-line"),d=n.createDiv("project-heading"),i=document.createElement("h2");i.setAttribute("class","notepad-text"),i.textContent=s;const l=document.createElement("h3");l.setAttribute("class","notepad-text"),l.textContent="Due Date";const m=document.createElement("ul");m.classList.add("notepad-text","todos");const p=n.createListElement("task"),u=n.createSpanElement("add-task"),E=n.createImageElement("images/add-icon.svg","add-icon");u.append(E,"Add Task"),p.append(u),m.append(p,c),d.append(i,l),r.append(d,m),o.append(r)},r=(e,t)=>{const n=a(),o=n.createListElement("project-item");o.setAttribute("data-project-id",e);const r=n.createSpanElement("project-name");r.textContent=t;const c=s();return o.append(r,c),o},c=e=>{const t=document.querySelector(".project-list"),a=document.querySelector("[data-add-project]");[].slice.call(t.children).forEach((e=>{e.classList.contains("project-item")&&e.remove()}));for(const n of e){const e=r(n.id,n.projectName);t.insertBefore(e,a)}t.querySelectorAll(".project-item").forEach((e=>{e.addEventListener("click",(()=>{n.onProjectSelect(e.dataset.projectId)}))}))},d=e=>{const t=document.querySelector(".active");t&&t.classList.remove("active"),e.classList.add("active"),e.children.item(0)},i=()=>null!=document.querySelector("#user-input"),l=()=>{const e=document.querySelector("#user-input"),t=e.parentElement.parentElement,n=a().createSpanElement("project-name"),s=e.value.trim();s&&(n.textContent=s,e.parentElement.remove(),t.insertBefore(n,t.childNodes[0]))},m=()=>{if(i())return;(()=>{const e=a(),t=document.querySelector(".project-list"),n=e.createListElement("project-item"),o=e.createForm(),r=e.createInputField("Project name...");o.append(r);const c=s();n.append(o,c),t.insertBefore(n,t.lastElementChild),setTimeout((()=>{r.focus()}),0)})();const e=document.querySelector("#user-input"),t=e.parentElement,r=t.parentElement;e.addEventListener("blur",(function(){if(""==e.value.trim())return void r.remove();l();const t=r.firstElementChild.textContent;n.onProjectAdd(t);const a=document.querySelector(".project-list"),s=a.children[a.childElementCount-2].getAttribute("data-project-id");i()||o(s)})),t.addEventListener("submit",(function(e){e.preventDefault(),l();const t=r.firstElementChild.textContent;n.onProjectAdd(t);const a=document.querySelector(".project-list"),s=a.children[a.childElementCount-2].getAttribute("data-project-id");i()||o(s)}))},p=()=>{const t=document.querySelector("#user-input"),n=t.parentElement,a=n.parentElement.parentElement;t.addEventListener("blur",(function(){const e=a.closest("[data-project-id]").dataset.projectId,n=t.value;E(),n&&u(n,e,a)})),n.addEventListener("submit",(function(){e.preventDefault();const n=a.closest("[data-project-id]").dataset.projectId,s=t.value;E(),s&&u(s,n,a)}))},u=(e,t,a)=>{if(a.dataset.taskId)return n.onTaskNameEdit(t,a.dataset.taskId,e);const s=n.onTaskAdd(e,t);a.setAttribute("data-task-id",s.taskId)},E=()=>{const e=document.querySelector("#user-input"),t=e.parentElement,n=t.parentElement,s=n.parentElement,o=e.value.trim(),r=a().createSpanElement("task-text");r.append(o),""!=o||s.dataset.taskId?""==o&&s.dataset.taskId||(t.remove(),n.prepend(r)):s.remove()};window.onload=()=>{const e=t.getProjects();c(e),e.forEach((e=>{o(e.id)}))},(()=>{const e=document.getElementById("bars-icon-mobile");window.innerWidth<=1024&&e.classList.contains("hidden")&&e.classList.toggle("hidden");const t=document.getElementById("sidebar"),n=()=>{t.classList.toggle("toggle-sidebar"),window.innerWidth<=1024&&e.classList.toggle("hidden")};document.querySelectorAll(".bars-icon").forEach((e=>{e.addEventListener("click",n)}))})(),document.addEventListener("click",(e=>{if(e.target.closest(".delete-project")){const n=e.target.closest(".project-item");n.remove();const a=n.dataset.projectId;t.deleteProject(a)}})),document.querySelector("[data-add-project]").addEventListener("click",m),document.addEventListener("click",(e=>{e.target.classList.contains("edit-project")&&(e=>{if(i())return;const t=a().createForm(),s=a().createInputField("Project name..."),o=e.target.parentElement.previousElementSibling;s.value=o.textContent,o.remove(),t.append(s);const r=e.target.closest(".project-item");r.insertBefore(t,r.childNodes[0]);const c=document.querySelector("#user-input");c.focus();const d=r.dataset.projectId;c.addEventListener("blur",(function(){""!=c.value&&l();const e=r.firstElementChild.textContent;m(d,e),n.onProjectNameEdit(d,e)})),t.addEventListener("submit",(function(e){e.preventDefault(),l();const t=r.firstElementChild.textContent;m(d,t),n.onProjectNameEdit(d,t)}));const m=(e,t)=>{const n=document.querySelector(".notepad").querySelector(`[data-project-id="${e}"]`);n&&(n.childNodes[0].childNodes[0].textContent=t)}})(e)})),document.addEventListener("click",(e=>{e.target.classList.contains("task-text")&&(e=>{e.classList.toggle("completed");let t=!1;e.classList.contains("completed")&&(t=!0);const a=e.closest(".project").dataset.projectId,s=e.dataset.taskId;n.onTaskCompleteEdit(a,s,t)})(e.target.closest(".task")),e.target.classList.contains("add-task")&&((e=>{if(document.getElementById("user-input"))return;const s=a().createListElement("task"),o=a().createSpanElement("task-item"),r=a().createForm(),c=a().createInputField("Enter Task...");r.append(c),o.append(r);const d=a().createSpanElement("icons"),i=a().createImageElement("images/edit-icon.svg","edit-icon"),l=a().createImageElement("images/delete-icon.svg","delete-icon");i.addEventListener("click",(()=>{if(s.classList.contains("completed"))return;const e=document.querySelector(".task-text"),t=e.textContent;e.remove();const n=a().createForm(),r=a().createInputField("Enter Task...");r.value=t,n.append(r),o.insertBefore(n,d),s.prepend(o),r.focus(),p()})),l.addEventListener("click",(e=>{const n=e.target.closest("[data-project-id]").dataset.projectId,a=e.target.closest("[data-task-id]").dataset.taskId;s.remove(),t.deleteTask(n,a)})),d.append(i,l),o.append(d);const m=(()=>{const e=a().createSpanElement("due-date"),t=a().createImageElement("images/priority-icon.svg","priority-icon");t.classList.add("priority-low");const s=document.createElement("label");s.classList.add("date-label");const o=document.createElement("input");o.setAttribute("type","date"),o.required=!0;const r=a().createImageElement("images/calendar-icon.svg","calendar-icon");return s.append(o,r),e.append(t,s),o.addEventListener("change",(()=>{const e=o.closest([".project"]).dataset.projectId,t=o.closest("[data-task-id").dataset.taskId,a=o.value;return n.onTaskDueDateEdit(e,t,a)})),e})();s.append(o,m);const u=e.closest(".todos"),E=u.childElementCount-2;u.insertBefore(s,u.children[E]),setTimeout((()=>{c.focus()}),0)})(e.target),p()),e.target.classList.contains("priority-icon")&&(e=>{if(e.parentElement.parentElement.classList.contains("completed"))return;const t=e.closest(".project").dataset.projectId,a=e.closest("[data-task-id]").dataset.taskId,s=e.classList;s.contains("priority-low")?(s.remove("priority-low"),s.add("priority-medium"),n.onTaskPriorityEdit(t,a,"medium")):s.contains("priority-medium")?(s.remove("priority-medium"),s.add("priority-high"),n.onTaskPriorityEdit(t,a,"high")):s.contains("priority-high")&&(s.remove("priority-high"),s.add("priority-low"),n.onTaskPriorityEdit(t,a,"low"))})(e.target)}))})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QUFXLEtBQ1BXLEVBQVdWLFVBQ1osSUNYSzhDLENBQWF2QyxFQUFFb0IsUUFDZmxCLEtBRUFGLEVBQUVvQixPQUFPeEYsVUFBVXVDLFNBQVMsa0JEOEZqQixDQUFDcUUsSUFFcEIsR0FEMEJBLEVBQVkzRCxjQUFjQSxjQUFjakQsVUFDNUN1QyxTQUFTLGFBQWMsT0FDN0MsTUFBTTlGLEVBQVltSyxFQUFZbkMsUUFBUSxZQUFZNUIsUUFBUXBHLFVBQ3BESyxFQUFTOEosRUFBWW5DLFFBQVEsa0JBQWtCNUIsUUFBUS9GLE9BRXZEK0osRUFBb0JELEVBQVk1RyxVQUVsQzZHLEVBQWtCdEUsU0FBUyxpQkFDM0JzRSxFQUFrQnJFLE9BQU8sZ0JBQ3pCcUUsRUFBa0I1RyxJQUFJLG1CQUNmLHFCQUE0QnhELEVBQVdLLEVBQVEsV0FFdEQrSixFQUFrQnRFLFNBQVMsb0JBQzNCc0UsRUFBa0JyRSxPQUFPLG1CQUN6QnFFLEVBQWtCNUcsSUFBSSxpQkFDZixxQkFBNEJ4RCxFQUFXSyxFQUFRLFNBRXREK0osRUFBa0J0RSxTQUFTLG1CQUMzQnNFLEVBQWtCckUsT0FBTyxpQkFDekJxRSxFQUFrQjVHLElBQUksZ0JBQ2YscUJBQTRCeEQsRUFBV0ssRUFBUSxTQ2xIbERnSyxDQUFlMUMsRUFBRW9CLFkiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly90b2RvLWxpc3QvLi9zcmMvc3RvcmFnZS5qcyIsIndlYnBhY2s6Ly90b2RvLWxpc3QvLi9zcmMvaGFuZGxlcnMuanMiLCJ3ZWJwYWNrOi8vdG9kby1saXN0Ly4vc3JjL2NyZWF0ZURPTUVsZW1lbnRzLmpzIiwid2VicGFjazovL3RvZG8tbGlzdC8uL3NyYy9wcm9qZWN0cy5qcyIsIndlYnBhY2s6Ly90b2RvLWxpc3QvLi9zcmMvdGFza3MuanMiLCJ3ZWJwYWNrOi8vdG9kby1saXN0Ly4vc3JjL2luZGV4LmpzIl0sInNvdXJjZXNDb250ZW50IjpbImNvbnN0IHVwZGF0ZVN0b3JhZ2UgPSAoKSA9PiB7XG4gICAgXG4gICAgY29uc3QgZ2V0UHJvamVjdHMgPSAoKSA9PiB7XG4gICAgICAgIC8vIGNyZWF0ZXMgYW4gYXJyYXkgb2Ygb2JqZWN0cyBcbiAgICAgICAgY29uc3QgcHJvamVjdHMgPSBKU09OLnBhcnNlKGxvY2FsU3RvcmFnZS5nZXRJdGVtKCdwcm9qZWN0cycpIHx8ICdbXScpO1xuICAgICAgICByZXR1cm4gcHJvamVjdHM7XG4gICAgfVxuXG4gICAgY29uc3QgZ2V0VGFza3MgPSAocHJvamVjdElkKSA9PiB7XG4gICAgICAgIGNvbnN0IHByb2plY3RzID0gZ2V0UHJvamVjdHMoKTtcbiAgICAgICAgY29uc3QgY3VycmVudFByb2plY3QgPSBwcm9qZWN0cy5maW5kKHByb2plY3QgPT4gcHJvamVjdC5pZCA9PSBwcm9qZWN0SWQpO1xuICAgICAgICBjb25zdCB0YXNrcyA9IGN1cnJlbnRQcm9qZWN0LnRhc2tzO1xuICAgICAgICByZXR1cm4gdGFza3M7XG4gICAgfVxuXG4gICAgY29uc3Qgc2F2ZVByb2plY3QgPSAocHJvamVjdFRvU2F2ZSkgPT4ge1xuICAgICAgICBjb25zdCBwcm9qZWN0cyA9IGdldFByb2plY3RzKCk7XG5cbiAgICAgICAgLy8gZmluZCBtZXRob2QgcmV0dXJucyB0aGUgZmlyc3Qgb2JqZWN0IHRoYXQgbWF0Y2hlcyB0aGUgaWRcbiAgICAgICAgY29uc3QgZXhpc3RpbmcgPSBwcm9qZWN0cy5maW5kKHByb2plY3QgPT4gcHJvamVjdC5pZCA9PSBwcm9qZWN0VG9TYXZlLmlkKTtcbiAgICAgICAgXG4gICAgICAgIGlmIChleGlzdGluZykge1xuICAgICAgICAgICAgZXhpc3RpbmcucHJvamVjdE5hbWUgPSBwcm9qZWN0VG9TYXZlLnByb2plY3ROYW1lO1xuICAgICAgICAgICAgZXhpc3RpbmcudGFza3MgPSBwcm9qZWN0VG9TYXZlLnRhc2tzO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgcHJvamVjdFRvU2F2ZS5pZCA9IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIDEwMDAwMDApO1xuICAgICAgICAgICAgLy8gQWRkIHByb2plY3ROYW1lXG4gICAgICAgICAgICAvLyBBZGQgVGFza3MgYXJyYXkgY29udGFpbmluZyBhbm90aGVyIGFycmF5IHdoaWNoIGluY2x1ZGVzIHRhc2ssIHByaW9yaXR5LCBkdWVEYXRlLCBhbmQgdHJ1ZS9mYWxzZSBmb3IgY29tcGxldGVkIG9yIG5vdFxuICAgICAgICAgICAgcHJvamVjdHMucHVzaChwcm9qZWN0VG9TYXZlKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKCdwcm9qZWN0cycsIEpTT04uc3RyaW5naWZ5KHByb2plY3RzKSk7XG4gICAgfVxuXG4gICAgY29uc3QgdXBkYXRlVGFzayA9IChwcm9qZWN0SWQsIHVwZGF0ZWRUYXNrKSA9PiB7XG4gICAgICAgIC8vIHRhc2tzIGZvciBjdXJyZW50IHByb2plY3RcbiAgICAgICAgY29uc3QgcHJvamVjdHMgPSBnZXRQcm9qZWN0cygpO1xuICAgICAgICBjb25zdCBwcm9qZWN0VG9VcGRhdGUgPSBwcm9qZWN0cy5maW5kKHByb2plY3QgPT4gcHJvamVjdC5pZCA9PSBwcm9qZWN0SWQpO1xuICAgICAgICBjb25zdCB0YXNrc0FycmF5ID0gcHJvamVjdFRvVXBkYXRlLnRhc2tzO1xuICAgICAgICBcbiAgICAgICAgLy8gZmluZCB0YXNrIGluZGV4IGFuZCByZXBsYWNlIHRoZSB0YXNrIGF0IHRoYXQgaW5kZXggdG8gdXBkYXRlXG4gICAgICAgIGNvbnN0IGluZGV4T2ZVcGRhdGVkVGFzayA9IHRhc2tzQXJyYXkuZmluZEluZGV4KCh0YXNrT2JqKSA9PiB7XG4gICAgICAgICAgICByZXR1cm4gdGFza09iai50YXNrSWQgPT0gdXBkYXRlZFRhc2sudGFza0lkO1xuICAgICAgICB9KTtcblxuICAgICAgICB0YXNrc0FycmF5W2luZGV4T2ZVcGRhdGVkVGFza10gPSB1cGRhdGVkVGFzaztcbiAgICAgICAgLy8gU2F2ZSB1cGRhdGVkIHRhc2tzIGFycmF5IHRvIHRoZSBwcm9qZWN0IG9iamVjdFxuICAgICAgICBwcm9qZWN0VG9VcGRhdGUudGFza3MgPSB0YXNrc0FycmF5O1xuICAgICAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbSgncHJvamVjdHMnLCBKU09OLnN0cmluZ2lmeShwcm9qZWN0cykpO1xuICAgIH1cblxuICAgIGNvbnN0IGZpbmRUYXNrVG9VcGRhdGUgPSAocHJvamVjdElkLCBleGlzdGluZ1Rhc2tJZCkgPT4ge1xuICAgICAgICBjb25zdCBwcm9qZWN0cyA9IGdldFByb2plY3RzKCk7ICAgICBcbiAgICAgICAgY29uc3QgcHJvamVjdFRvVXBkYXRlID0gcHJvamVjdHMuZmluZChwcm9qZWN0ID0+IHByb2plY3QuaWQgPT0gcHJvamVjdElkKTtcbiAgICAgICAgY29uc3QgdGFza3NBcnJheSA9IHByb2plY3RUb1VwZGF0ZS50YXNrc1xuICAgICAgICBjb25zdCBleGlzdGluZ1Rhc2sgPSB0YXNrc0FycmF5LmZpbmQodGFzayA9PiB0YXNrLnRhc2tJZCA9PSBleGlzdGluZ1Rhc2tJZCk7XG4gICAgICAgIHJldHVybiBleGlzdGluZ1Rhc2s7XG4gICAgfVxuXG4gICAgY29uc3QgZGVsZXRlUHJvamVjdCA9IChpZCkgPT4ge1xuICAgICAgICBjb25zdCBwcm9qZWN0cyA9IGdldFByb2plY3RzKCk7XG4gICAgICAgIGNvbnN0IHVwZGF0ZWRQcm9qZWN0TGlzdCA9IHByb2plY3RzLmZpbHRlcihwcm9qZWN0ID0+IHByb2plY3QuaWQgIT0gaWQpO1xuXG4gICAgICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKCdwcm9qZWN0cycsIEpTT04uc3RyaW5naWZ5KHVwZGF0ZWRQcm9qZWN0TGlzdCkpO1xuICAgIH1cblxuICAgIGNvbnN0IGRlbGV0ZVRhc2sgPSAoaWQsIHRhc2tJZCkgPT4ge1xuICAgICAgICBjb25zdCBwcm9qZWN0cyA9IGdldFByb2plY3RzKCk7XG4gICAgICAgIGNvbnN0IHByb2plY3RXaXRoVGFzayA9IHByb2plY3RzLmZpbmQocHJvamVjdCA9PiBwcm9qZWN0LmlkID09IGlkKTtcbiAgICAgICAgY29uc3QgYWxsVGFza3MgPSBwcm9qZWN0V2l0aFRhc2sudGFza3M7XG4gICAgICAgIC8vIEVhY2ggdGFzayBpcyBhbiBvYmplY3RcbiAgICAgICAgY29uc3QgdXBkYXRlZFRhc2tPYmogPSBhbGxUYXNrcy5maWx0ZXIodGFza09iaiA9PiB0YXNrT2JqLnRhc2tJZCAhPSB0YXNrSWQpO1xuICAgICAgICBwcm9qZWN0V2l0aFRhc2sudGFza3MgPSB1cGRhdGVkVGFza09iajtcblxuICAgICAgICBzYXZlUHJvamVjdChwcm9qZWN0V2l0aFRhc2spO1xuICAgIH1cblxuICAgIHJldHVybiB7IGdldFByb2plY3RzLCBnZXRUYXNrcywgc2F2ZVByb2plY3QsIGRlbGV0ZVByb2plY3QsIGRlbGV0ZVRhc2ssIGZpbmRUYXNrVG9VcGRhdGUsIHVwZGF0ZVRhc2sgfVxufVxuXG5leHBvcnQgZGVmYXVsdCB1cGRhdGVTdG9yYWdlKCk7IiwiaW1wb3J0IHsgdXBkYXRlUHJvamVjdExpc3QsIHVwZGF0ZUFjdGl2ZVRhYiB9IGZyb20gXCIuL2NyZWF0ZURPTUVsZW1lbnRzXCI7XG5pbXBvcnQgdXBkYXRlU3RvcmFnZSBmcm9tIFwiLi9zdG9yYWdlXCI7XG5pbXBvcnQge2Zvcm1hdH0gZnJvbSBcImRhdGUtZm5zXCI7XG5cbmNvbnN0IGhhbmRsZXJzID0gKCkgPT4ge1xuICAgIFxuICAgIGNvbnN0IF9yZWZyZXNoUHJvamVjdExpc3QgPSAoKSA9PiB7XG4gICAgICAgIGNvbnN0IHByb2plY3RzID0gdXBkYXRlU3RvcmFnZS5nZXRQcm9qZWN0cygpOyAvLyBVcGRhdGUgcHJvamVjdHMgaW4gc3RvcmFnZSAgICAgICAgXG4gICAgICAgIF9zZXRQcm9qZWN0TGlzdChwcm9qZWN0cyk7IC8vIFVwZGF0ZSBwcm9qZWN0cyBvbiBET01cbiAgICB9XG5cbiAgICBjb25zdCBfc2V0UHJvamVjdExpc3QgPSAocHJvamVjdHMpID0+IHtcbiAgICAgICAgdXBkYXRlUHJvamVjdExpc3QocHJvamVjdHMpO1xuICAgIH1cblxuICAgIGNvbnN0IF9zZXRBY3RpdmVUYWIgPSAodGFiKSA9PiB7XG4gICAgICAgIHVwZGF0ZUFjdGl2ZVRhYih0YWIpO1xuICAgIH1cblxuICAgIC8vIEhlcmUgYmUgaGFuZGxlcnNcbiAgICBjb25zdCBvblByb2plY3RTZWxlY3QgPSAocHJvamVjdElkKSA9PiB7XG4gICAgICAgIGNvbnN0IHByb2plY3RzID0gdXBkYXRlU3RvcmFnZS5nZXRQcm9qZWN0cygpO1xuICAgICAgICBjb25zdCBwcm9qZWN0T2JqZWN0ID0gcHJvamVjdHMuZmluZChwcm9qZWN0ID0+IHByb2plY3QuaWQgPT0gcHJvamVjdElkKTtcbiAgICAgICAgY29uc3Qgc2VsZWN0ZWRQcm9qZWN0ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihgW2RhdGEtcHJvamVjdC1pZD0nJHtwcm9qZWN0T2JqZWN0LmlkfSddYCk7XG4gICAgICAgIF9zZXRBY3RpdmVUYWIoc2VsZWN0ZWRQcm9qZWN0KTtcbiAgICB9XG5cbiAgICBjb25zdCBvblByb2plY3RBZGQgPSAocHJvamVjdE5hbWUpID0+IHtcbiAgICAgICAgLy8gcGFzcyB1c2VyIGlucHV0IGludG8gZnVuY3Rpb25cbiAgICAgICAgY29uc3QgbmV3UHJvamVjdCA9ICB7XG4gICAgICAgICAgICBwcm9qZWN0TmFtZTogcHJvamVjdE5hbWUsXG4gICAgICAgICAgICB0YXNrczogW11cbiAgICAgICAgfVxuICAgICAgICB1cGRhdGVTdG9yYWdlLnNhdmVQcm9qZWN0KG5ld1Byb2plY3QpO1xuICAgICAgICAvLyBhZGQgaW5wdXQgdG8gcGFnZVxuICAgICAgICBfcmVmcmVzaFByb2plY3RMaXN0KCk7XG4gICAgICAgIGNvbnN0IG5ld1Byb2plY3RET01FbGVtZW50ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihgW2RhdGEtcHJvamVjdC1pZD0nJHtuZXdQcm9qZWN0LmlkfSddYCk7XG4gICAgICAgIF9zZXRBY3RpdmVUYWIobmV3UHJvamVjdERPTUVsZW1lbnQpO1xuICAgIH1cbiAgICBcbiAgICBjb25zdCBvblRhc2tBZGQgPSAodGFzaywgaWQpID0+IHtcbiAgICAgICAgY29uc3QgbmV3VGFzayA9IHtcbiAgICAgICAgICAgIGl0ZW06IHRhc2ssIFxuICAgICAgICAgICAgdGFza0lkOiBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAxMDAwMDAwKSxcbiAgICAgICAgICAgIHByaW9yaXR5OiAnbG93JyxcbiAgICAgICAgICAgIGR1ZURhdGU6IG51bGwsXG4gICAgICAgICAgICBpc0NvbXBsZXRlOiBmYWxzZVxuICAgICAgICB9XG4gICAgICAgIGNvbnN0IHByb2plY3RzID0gdXBkYXRlU3RvcmFnZS5nZXRQcm9qZWN0cygpO1xuICAgICAgICBjb25zdCBwcm9qZWN0VG9VcGRhdGUgPSBwcm9qZWN0cy5maW5kKHByb2plY3QgPT4gcHJvamVjdC5pZCA9PSBpZCk7XG4gICAgICAgIHByb2plY3RUb1VwZGF0ZS50YXNrcy5wdXNoKG5ld1Rhc2spO1xuICAgICAgICB1cGRhdGVTdG9yYWdlLnNhdmVQcm9qZWN0KHByb2plY3RUb1VwZGF0ZSk7XG4gICAgICAgIFxuICAgICAgICByZXR1cm4gbmV3VGFzaztcbiAgICB9XG4gICAgXG4gICAgY29uc3Qgb25Qcm9qZWN0TmFtZUVkaXQgPSAocHJvamVjdElkLCBwcm9qZWN0TmFtZSwgdGFza3MgPSB1cGRhdGVTdG9yYWdlLmdldFRhc2tzKHByb2plY3RJZCkpID0+IHtcbiAgICAgICAgdXBkYXRlU3RvcmFnZS5zYXZlUHJvamVjdCh7XG4gICAgICAgICAgICBpZDogcHJvamVjdElkLFxuICAgICAgICAgICAgcHJvamVjdE5hbWU6IHByb2plY3ROYW1lLFxuICAgICAgICAgICAgdGFza3M6IHRhc2tzXG4gICAgICAgIH0pO1xuXG4gICAgICAgIF9yZWZyZXNoUHJvamVjdExpc3QoKTtcbiAgICB9XG5cbiAgICBjb25zdCBvblRhc2tOYW1lRWRpdCA9IChwcm9qZWN0SWQsIHRhc2tJZCwgbmV3VGFza05hbWUpID0+IHtcbiAgICAgICAgY29uc3QgZXhpc3RpbmdUYXNrID0gdXBkYXRlU3RvcmFnZS5maW5kVGFza1RvVXBkYXRlKHByb2plY3RJZCwgdGFza0lkKTtcbiAgICAgICAgdXBkYXRlU3RvcmFnZS51cGRhdGVUYXNrKHByb2plY3RJZCwge1xuICAgICAgICAgICAgICAgIGl0ZW06IG5ld1Rhc2tOYW1lLFxuICAgICAgICAgICAgICAgIHRhc2tJZDogZXhpc3RpbmdUYXNrLnRhc2tJZCxcbiAgICAgICAgICAgICAgICBwcmlvcml0eTogZXhpc3RpbmdUYXNrLnByaW9yaXR5LFxuICAgICAgICAgICAgICAgIGR1ZURhdGU6IGV4aXN0aW5nVGFzay5kdWVEYXRlLFxuICAgICAgICAgICAgICAgIGlzQ29tcGxldGU6IGV4aXN0aW5nVGFzay5pc0NvbXBsZXRlXG4gICAgICAgICAgICB9KTsgIFxuICAgIH1cblxuICAgIGNvbnN0IG9uVGFza1ByaW9yaXR5RWRpdCA9IChwcm9qZWN0SWQsIHRhc2tJZCwgbmV3UHJpb3JpdHkpID0+IHtcbiAgICAgICAgY29uc3QgZXhpc3RpbmdUYXNrID0gdXBkYXRlU3RvcmFnZS5maW5kVGFza1RvVXBkYXRlKHByb2plY3RJZCwgdGFza0lkKTtcbiAgICAgICAgdXBkYXRlU3RvcmFnZS51cGRhdGVUYXNrKHByb2plY3RJZCwge1xuICAgICAgICAgICAgICAgIGl0ZW06IGV4aXN0aW5nVGFzay5pdGVtLFxuICAgICAgICAgICAgICAgIHRhc2tJZDogZXhpc3RpbmdUYXNrLnRhc2tJZCxcbiAgICAgICAgICAgICAgICBwcmlvcml0eTogbmV3UHJpb3JpdHksXG4gICAgICAgICAgICAgICAgZHVlRGF0ZTogZXhpc3RpbmdUYXNrLmR1ZURhdGUsXG4gICAgICAgICAgICAgICAgaXNDb21wbGV0ZTogZXhpc3RpbmdUYXNrLmlzQ29tcGxldGVcbiAgICAgICAgICAgIH0pOyAgXG4gICAgfVxuXG4gICAgY29uc3Qgb25UYXNrRHVlRGF0ZUVkaXQgPSAocHJvamVjdElkLCB0YXNrSWQsIG5ld0R1ZURhdGUpID0+IHtcbiAgICAgICAgY29uc3QgZXhpc3RpbmdUYXNrID0gdXBkYXRlU3RvcmFnZS5maW5kVGFza1RvVXBkYXRlKHByb2plY3RJZCwgdGFza0lkKTtcbiAgICAgICAgdXBkYXRlU3RvcmFnZS51cGRhdGVUYXNrKHByb2plY3RJZCwge1xuICAgICAgICAgICAgICAgIGl0ZW06IGV4aXN0aW5nVGFzay5pdGVtLFxuICAgICAgICAgICAgICAgIHRhc2tJZDogZXhpc3RpbmdUYXNrLnRhc2tJZCxcbiAgICAgICAgICAgICAgICBwcmlvcml0eTogZXhpc3RpbmdUYXNrLnByaW9yaXR5LFxuICAgICAgICAgICAgICAgIGR1ZURhdGU6IG5ld0R1ZURhdGUsXG4gICAgICAgICAgICAgICAgaXNDb21wbGV0ZTogZXhpc3RpbmdUYXNrLmlzQ29tcGxldGVcbiAgICAgICAgICAgIH0pOyAgXG4gICAgfVxuXG4gICAgY29uc3Qgb25UYXNrQ29tcGxldGVFZGl0ID0gKHByb2plY3RJZCwgdGFza0lkLCBpc0NvbXBsZXRlKSA9PiB7XG4gICAgICAgIGNvbnN0IGV4aXN0aW5nVGFzayA9IHVwZGF0ZVN0b3JhZ2UuZmluZFRhc2tUb1VwZGF0ZShwcm9qZWN0SWQsIHRhc2tJZCk7XG4gICAgICAgIHVwZGF0ZVN0b3JhZ2UudXBkYXRlVGFzayhwcm9qZWN0SWQsIHtcbiAgICAgICAgICAgICAgICBpdGVtOiBleGlzdGluZ1Rhc2suaXRlbSxcbiAgICAgICAgICAgICAgICB0YXNrSWQ6IGV4aXN0aW5nVGFzay50YXNrSWQsXG4gICAgICAgICAgICAgICAgcHJpb3JpdHk6IGV4aXN0aW5nVGFzay5wcmlvcml0eSxcbiAgICAgICAgICAgICAgICBkdWVEYXRlOiBleGlzdGluZ1Rhc2suZHVlRGF0ZSxcbiAgICAgICAgICAgICAgICBpc0NvbXBsZXRlOiBpc0NvbXBsZXRlXG4gICAgICAgICAgICB9KTsgIFxuICAgIH1cblxuICAgIHJldHVybiB7IG9uUHJvamVjdFNlbGVjdCwgb25Qcm9qZWN0QWRkLCBvblByb2plY3ROYW1lRWRpdCwgb25UYXNrQWRkLCBvblRhc2tOYW1lRWRpdCwgb25UYXNrUHJpb3JpdHlFZGl0LCBvblRhc2tEdWVEYXRlRWRpdCwgb25UYXNrQ29tcGxldGVFZGl0IH1cbiAgICBcbn1cblxuZXhwb3J0IGRlZmF1bHQgaGFuZGxlcnMoKTsiLCJpbXBvcnQgaGFuZGxlcnMgZnJvbSBcIi4vaGFuZGxlcnNcIlxuaW1wb3J0IHVwZGF0ZVN0b3JhZ2UgZnJvbSBcIi4vc3RvcmFnZVwiO1xuXG4vLyBET00gRWxlbWVudHMgRmFjdG9yeSBGdW5jdGlvblxuY29uc3QgY3JlYXRlRWxlbWVudHMgPSAoKSA9PiB7XG4gICAgXG4gICAgY29uc3QgY3JlYXRlTGlzdEVsZW1lbnQgPSAoaHRtbENsYXNzKSA9PiB7XG4gICAgICAgIGNvbnN0IGxpID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnbGknKTtcbiAgICAgICAgbGkuc2V0QXR0cmlidXRlKCdjbGFzcycsIGh0bWxDbGFzcyk7XG4gICAgICAgIHJldHVybiBsaTtcbiAgICB9XG5cbiAgICBjb25zdCBjcmVhdGVTcGFuRWxlbWVudCA9IChodG1sQ2xhc3MpID0+IHtcbiAgICAgICAgY29uc3Qgc3BhbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3NwYW4nKTtcbiAgICAgICAgc3Bhbi5jbGFzc0xpc3QuYWRkKGh0bWxDbGFzcyk7XG4gICAgICAgIHJldHVybiBzcGFuO1xuICAgIH1cblxuICAgIGNvbnN0IGNyZWF0ZUltYWdlRWxlbWVudCA9IChzcmMsIGh0bWxDbGFzcykgPT4ge1xuICAgICAgICBjb25zdCBpbWcgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdpbWcnKTtcbiAgICAgICAgaW1nLmNsYXNzTGlzdC5hZGQoaHRtbENsYXNzKTtcbiAgICAgICAgaW1nLnNldEF0dHJpYnV0ZSgnc3JjJywgc3JjKTtcbiAgICAgICAgaW1nLnNldEF0dHJpYnV0ZSgnZHJhZ2dhYmxlJywgJ2ZhbHNlJyk7XG4gICAgICAgIHJldHVybiBpbWc7XG4gICAgfVxuICAgIFxuICAgIGNvbnN0IGNyZWF0ZUZvcm0gPSAoKSA9PiB7XG4gICAgICAgIGNvbnN0IGlucHV0Rm9ybSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2Zvcm0nKTtcbiAgICAgICAgcmV0dXJuIGlucHV0Rm9ybTtcbiAgICB9XG5cbiAgICBjb25zdCBjcmVhdGVJbnB1dEZpZWxkID0gKHBsYWNlaG9sZGVyVGV4dCkgPT4ge1xuICAgICAgICBjb25zdCB1c2VySW5wdXQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdpbnB1dCcpO1xuICAgICAgICB1c2VySW5wdXQuc2V0QXR0cmlidXRlKCd0eXBlJywgJ3RleHQnKTtcbiAgICAgICAgdXNlcklucHV0LnNldEF0dHJpYnV0ZSgncGxhY2Vob2xkZXInLCBwbGFjZWhvbGRlclRleHQpO1xuICAgICAgICB1c2VySW5wdXQuc2V0QXR0cmlidXRlKCdpZCcsICd1c2VyLWlucHV0Jyk7XG4gICAgICAgIHVzZXJJbnB1dC5yZXF1aXJlZCA9IHRydWU7XG5cbiAgICAgICAgcmV0dXJuIHVzZXJJbnB1dDtcbiAgICB9XG5cbiAgICBjb25zdCBjcmVhdGVEaXYgPSAoaHRtbENsYXNzKSA9PiB7XG4gICAgICAgIGNvbnN0IGRpdiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICAgICAgICBkaXYuc2V0QXR0cmlidXRlKCdjbGFzcycsIGh0bWxDbGFzcyk7XG4gICAgICAgIHJldHVybiBkaXY7XG4gICAgfVxuXG4gICAgcmV0dXJuIHtjcmVhdGVMaXN0RWxlbWVudCwgY3JlYXRlU3BhbkVsZW1lbnQsIGNyZWF0ZUltYWdlRWxlbWVudCwgY3JlYXRlSW5wdXRGaWVsZCwgY3JlYXRlRm9ybSwgY3JlYXRlRGl2fVxufVxuXG5jb25zdCBjcmVhdGVJY29uU3BhbiA9ICgpID0+IHtcbiAgICBjb25zdCB2aWV3ID0gY3JlYXRlRWxlbWVudHMoKTtcblxuICAgIGNvbnN0IGljb25TcGFuID0gdmlldy5jcmVhdGVTcGFuRWxlbWVudCgnaWNvbnMnKTtcbiAgICBjb25zdCBlZGl0SWNvbiA9IHZpZXcuY3JlYXRlSW1hZ2VFbGVtZW50KCdpbWFnZXMvZWRpdC1pY29uLnN2ZycsICdlZGl0LWljb24nKTtcbiAgICBjb25zdCBkZWxldGVJY29uID0gdmlldy5jcmVhdGVJbWFnZUVsZW1lbnQoJ2ltYWdlcy9kZWxldGUtaWNvbi5zdmcnLCAnZGVsZXRlLWljb24nKTtcbiAgICBcbiAgICBlZGl0SWNvbi5jbGFzc0xpc3QuYWRkKCdlZGl0LXByb2plY3QnKTtcbiAgICBkZWxldGVJY29uLmNsYXNzTGlzdC5hZGQoJ2RlbGV0ZS1wcm9qZWN0Jyk7XG4gICAgXG4gICAgaWNvblNwYW4uYXBwZW5kKGVkaXRJY29uLCBkZWxldGVJY29uKTtcbiAgICBcbiAgICByZXR1cm4gaWNvblNwYW47XG59XG5cbmNvbnN0IGFkZFByb2plY3RUb1NpZGViYXIgPSAoKSA9PiB7XG4gICAgY29uc3QgdmlldyA9IGNyZWF0ZUVsZW1lbnRzKCk7XG4gICAgY29uc3QgcHJvamVjdHNDb250YWluZXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcucHJvamVjdC1saXN0Jyk7XG5cbiAgICBjb25zdCBwcm9qZWN0TGlzdEVsZW1lbnQgPSAgdmlldy5jcmVhdGVMaXN0RWxlbWVudCgncHJvamVjdC1pdGVtJyk7XG4gICAgXG4gICAgY29uc3QgcHJvamVjdElucHV0Rm9ybSA9IHZpZXcuY3JlYXRlRm9ybSgpO1xuICAgIGNvbnN0IHByb2plY3ROYW1lSW5wdXQgPSB2aWV3LmNyZWF0ZUlucHV0RmllbGQoJ1Byb2plY3QgbmFtZS4uLicpO1xuICAgIHByb2plY3RJbnB1dEZvcm0uYXBwZW5kKHByb2plY3ROYW1lSW5wdXQpO1xuXG4gICAgY29uc3QgaWNvblNwYW4gPSBjcmVhdGVJY29uU3BhbigpO1xuICAgIHByb2plY3RMaXN0RWxlbWVudC5hcHBlbmQocHJvamVjdElucHV0Rm9ybSwgaWNvblNwYW4pO1xuICAgIHByb2plY3RzQ29udGFpbmVyLmluc2VydEJlZm9yZShwcm9qZWN0TGlzdEVsZW1lbnQsIHByb2plY3RzQ29udGFpbmVyLmxhc3RFbGVtZW50Q2hpbGQpO1xuXG4gICAgc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICAgIHByb2plY3ROYW1lSW5wdXQuZm9jdXMoKTtcbiAgICB9LCAwKTtcbn1cblxuY29uc3QgYWRkUHJvamVjdFRvTm90ZXBhZCA9IChwcm9qZWN0SWQpID0+IHtcbiAgICBjb25zdCB2aWV3ID0gY3JlYXRlRWxlbWVudHMoKTtcbiAgICAvL2NvbnN0IHByb2plY3RMaXN0ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnByb2plY3QtbGlzdCcpO1xuXG4gICAgY29uc3QgcHJvamVjdHMgPSB1cGRhdGVTdG9yYWdlLmdldFByb2plY3RzKCk7XG4gICAgY29uc3QgcHJvamVjdFRvQWRkID0gcHJvamVjdHMuZmluZChwcm9qZWN0ID0+IHByb2plY3QuaWQgPT0gcHJvamVjdElkKTtcbiAgICBjb25zdCBwcm9qZWN0TmFtZSA9IHByb2plY3RUb0FkZC5wcm9qZWN0TmFtZTtcbiAgICAvL2NvbnN0IGN1cnJlbnRQcm9qZWN0TnVtYmVyID0gcHJvamVjdExpc3QuY2hpbGRFbGVtZW50Q291bnQgLSAyO1xuICAgIC8vY29uc3QgcHJvamVjdE5hbWUgPSBwcm9qZWN0TGlzdC5jaGlsZHJlbltjdXJyZW50UHJvamVjdE51bWJlcl0udGV4dENvbnRlbnQ7XG5cbiAgICBjb25zdCBub3RlcGFkID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignI3dyaXRpbmctYXJlYScpO1xuICAgIGNvbnN0IHByb2plY3REaXYgPSB2aWV3LmNyZWF0ZURpdigncHJvamVjdCcpO1xuICAgIHByb2plY3REaXYuc2V0QXR0cmlidXRlKCdkYXRhLXByb2plY3QtaWQnLCBwcm9qZWN0SWQpO1xuICAgIGNvbnN0IHNraXBMaW5lID0gdmlldy5jcmVhdGVEaXYoJ3NraXAtbGluZScpO1xuICAgIFxuICAgIGNvbnN0IHByb2plY3RIZWFkaW5nID0gdmlldy5jcmVhdGVEaXYoJ3Byb2plY3QtaGVhZGluZycpO1xuICAgIGNvbnN0IGgyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnaDInKTtcbiAgICBoMi5zZXRBdHRyaWJ1dGUoJ2NsYXNzJywgJ25vdGVwYWQtdGV4dCcpO1xuICAgIGgyLnRleHRDb250ZW50ID0gcHJvamVjdE5hbWU7XG4gICAgY29uc3QgaDMgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdoMycpO1xuICAgIGgzLnNldEF0dHJpYnV0ZSgnY2xhc3MnLCAnbm90ZXBhZC10ZXh0Jyk7XG4gICAgaDMudGV4dENvbnRlbnQgPSAnRHVlIERhdGUnO1xuICAgICAgICBcbiAgICBjb25zdCB0YXNrc0NvbnRhaW5lciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3VsJyk7XG4gICAgdGFza3NDb250YWluZXIuY2xhc3NMaXN0LmFkZCgnbm90ZXBhZC10ZXh0JywgJ3RvZG9zJyk7XG5cbiAgICBjb25zdCBhZGRUYXNrTGlzdEVsZW1lbnQgPSB2aWV3LmNyZWF0ZUxpc3RFbGVtZW50KCd0YXNrJyk7XG4gICAgY29uc3QgYWRkVGFza1NwYW4gPSB2aWV3LmNyZWF0ZVNwYW5FbGVtZW50KCdhZGQtdGFzaycpO1xuICAgIGNvbnN0IGFkZEljb24gPSB2aWV3LmNyZWF0ZUltYWdlRWxlbWVudCgnaW1hZ2VzL2FkZC1pY29uLnN2ZycsICdhZGQtaWNvbicpO1xuICAgIGFkZFRhc2tTcGFuLmFwcGVuZChhZGRJY29uLCAnQWRkIFRhc2snKTtcblxuICAgIGFkZFRhc2tMaXN0RWxlbWVudC5hcHBlbmQoYWRkVGFza1NwYW4pO1xuICAgIHRhc2tzQ29udGFpbmVyLmFwcGVuZChhZGRUYXNrTGlzdEVsZW1lbnQsIHNraXBMaW5lKTtcbiAgICBwcm9qZWN0SGVhZGluZy5hcHBlbmQoaDIsIGgzKTtcbiAgICBwcm9qZWN0RGl2LmFwcGVuZChwcm9qZWN0SGVhZGluZywgdGFza3NDb250YWluZXIpO1xuICAgIG5vdGVwYWQuYXBwZW5kKHByb2plY3REaXYpO1xufVxuXG4vLyBjcmVhdGVzIEhUTUwgZm9yIHByb2plY3QgaXRlbXMgaW4gc2lkZWJhciBmcm9tIGxvY2FsU3RvcmFnZSBpdGVtXG5jb25zdCBfY3JlYXRlUHJvamVjdEl0ZW1IVE1MID0gKGlkLCBuYW1lKSA9PiB7XG4gICAgY29uc3QgdmlldyA9IGNyZWF0ZUVsZW1lbnRzKCk7XG5cbiAgICBjb25zdCBwcm9qZWN0SXRlbSA9IHZpZXcuY3JlYXRlTGlzdEVsZW1lbnQoJ3Byb2plY3QtaXRlbScpO1xuICAgIHByb2plY3RJdGVtLnNldEF0dHJpYnV0ZSgnZGF0YS1wcm9qZWN0LWlkJywgaWQpO1xuICAgIGNvbnN0IHByb2plY3ROYW1lID0gdmlldy5jcmVhdGVTcGFuRWxlbWVudCgncHJvamVjdC1uYW1lJyk7XG4gICAgcHJvamVjdE5hbWUudGV4dENvbnRlbnQgPSBuYW1lO1xuICAgIGNvbnN0IGljb25TcGFuID0gY3JlYXRlSWNvblNwYW4oKTtcblxuICAgIHByb2plY3RJdGVtLmFwcGVuZChwcm9qZWN0TmFtZSwgaWNvblNwYW4pO1xuXG4gICAgcmV0dXJuIHByb2plY3RJdGVtO1xufVxuLy8gVXBkYXRlcyBwcm9qZWN0IGxpc3QgaW4gdGhlIHNpZGViYXIgXG5jb25zdCB1cGRhdGVQcm9qZWN0TGlzdCA9IChwcm9qZWN0cykgPT4ge1xuICAgIGNvbnN0IHByb2plY3RzTGlzdENvbnRhaW5lciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5wcm9qZWN0LWxpc3QnKTtcbiAgICBjb25zdCBhZGRQcm9qZWN0QnRuID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignW2RhdGEtYWRkLXByb2plY3RdJyk7XG4gICAgXG4gICAgLy8gQ2xlYXIgYWxsIGVsZW1lbnRzIG9mIGNsYXNzICcucHJvamVjdC1pdGVtJ1xuICAgIGNvbnN0IHByb2plY3RzQXJyYXkgPSBbXS5zbGljZS5jYWxsKHByb2plY3RzTGlzdENvbnRhaW5lci5jaGlsZHJlbik7XG4gICAgcHJvamVjdHNBcnJheS5mb3JFYWNoKGl0ZW0gPT4ge1xuICAgICAgICBpZiAoaXRlbS5jbGFzc0xpc3QuY29udGFpbnMoJ3Byb2plY3QtaXRlbScpKSBpdGVtLnJlbW92ZSgpO1xuICAgIH0pO1xuXG4gICAgZm9yIChjb25zdCBwcm9qZWN0IG9mIHByb2plY3RzKSB7XG4gICAgICAgIGNvbnN0IGh0bWwgPSBfY3JlYXRlUHJvamVjdEl0ZW1IVE1MKHByb2plY3QuaWQsIHByb2plY3QucHJvamVjdE5hbWUpO1xuICAgICAgICBwcm9qZWN0c0xpc3RDb250YWluZXIuaW5zZXJ0QmVmb3JlKGh0bWwsIGFkZFByb2plY3RCdG4pO1xuICAgIH1cblxuICAgIC8vIEFkZCBsaXN0ZW5lcnMgZm9yIGVkaXQsIGRlbGV0ZSA/Pz8/XG4gICAgcHJvamVjdHNMaXN0Q29udGFpbmVyLnF1ZXJ5U2VsZWN0b3JBbGwoJy5wcm9qZWN0LWl0ZW0nKS5mb3JFYWNoKHByb2plY3RJdGVtID0+IHtcbiAgICAgICAgcHJvamVjdEl0ZW0uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB7XG4gICAgICAgICAgICBoYW5kbGVycy5vblByb2plY3RTZWxlY3QocHJvamVjdEl0ZW0uZGF0YXNldC5wcm9qZWN0SWQpO1xuICAgICAgICB9KTtcbiAgICB9KTtcbn1cblxuY29uc3QgbG9hZEFsbFByb2plY3RzID0gKHByb2plY3RzKSA9PiB7XG4gICAgcHJvamVjdHMuZm9yRWFjaChwcm9qZWN0ID0+IHtcbiAgICAgICAgYWRkUHJvamVjdFRvTm90ZXBhZChwcm9qZWN0LmlkKTtcbiAgICB9KTtcbn1cblxuY29uc3QgdXBkYXRlQWN0aXZlVGFiID0gKHRhYikgPT4ge1xuICAgIC8vIGZvciBhbGwgb3RoZXIgcHJvamVjdHMsIGNoYW5nZSBkaXNwbGF5IHRvIG5vbmUsIHRvIGJyaW5nIGJhY2sgc2V0IGRpc3BsYXkgdG8gY29udGVudHMgIFxuICAgICAgICAvLyBpdGVtLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSdcbiAgICAvLyByZW1vdmUgYWN0aXZlIGNsYXNzIGZyb20gYW55IG90aGVyIHNpZGViYXIgZWxlbWVudFxuICAgIGNvbnN0IGN1cnJlbnRBY3RpdmVUYWIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuYWN0aXZlJyk7XG4gICAgaWYgKGN1cnJlbnRBY3RpdmVUYWIpIGN1cnJlbnRBY3RpdmVUYWIuY2xhc3NMaXN0LnJlbW92ZSgnYWN0aXZlJyk7XG4gICAgdGFiLmNsYXNzTGlzdC5hZGQoJ2FjdGl2ZScpO1xuICAgIGNvbnN0IHByb2plY3ROYW1lU3BhbiA9IHRhYi5jaGlsZHJlbi5pdGVtKDApOyAvLyBVcGRhdGUgbm90ZXBhZCBoZXJlP1xuICAgIC8vY29uc29sZS5sb2cocHJvamVjdE5hbWVTcGFuKTtcbn1cblxuZXhwb3J0IHsgYWRkUHJvamVjdFRvU2lkZWJhciwgYWRkUHJvamVjdFRvTm90ZXBhZCwgY3JlYXRlRWxlbWVudHMsIHVwZGF0ZVByb2plY3RMaXN0LCB1cGRhdGVBY3RpdmVUYWIsIGxvYWRBbGxQcm9qZWN0cyB9OyIsImltcG9ydCB7IGFkZFByb2plY3RUb1NpZGViYXIsIGFkZFByb2plY3RUb05vdGVwYWQsIGNyZWF0ZUVsZW1lbnRzIH0gZnJvbSBcIi4vY3JlYXRlRE9NRWxlbWVudHNcIjtcbmltcG9ydCBoYW5kbGVycyBmcm9tIFwiLi9oYW5kbGVyc1wiO1xuaW1wb3J0IHVwZGF0ZVN0b3JhZ2UgZnJvbSBcIi4vc3RvcmFnZVwiXG5cbmNvbnN0IGF3YWl0aW5nSW5wdXQgPSAoKSA9PiB7XG4gICAgY29uc3QgdXNlcklucHV0ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignI3VzZXItaW5wdXQnKTtcbiAgICBpZiAodXNlcklucHV0ICE9IG51bGwpIHJldHVybiB0cnVlO1xuXG4gICAgcmV0dXJuIGZhbHNlO1xufVxuXG5jb25zdCBoYW5kbGVVc2VySW5wdXQgPSAoKSA9PiB7IFxuICAgIC8vIFRoaXMgaXMgRE9NIFN0dWZmXG4gICAgY29uc3QgdXNlcklucHV0ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignI3VzZXItaW5wdXQnKVxuICAgIGNvbnN0IGlucHV0Rm9ybSA9IHVzZXJJbnB1dC5wYXJlbnRFbGVtZW50O1xuICAgIGNvbnN0IHByb2plY3RJdGVtID0gaW5wdXRGb3JtLnBhcmVudEVsZW1lbnQ7XG4gICAgY29uc3QgcHJvamVjdFNwYW4gPSBjcmVhdGVFbGVtZW50cygpLmNyZWF0ZVNwYW5FbGVtZW50KCdwcm9qZWN0LW5hbWUnKTtcbiAgICBcbiAgICBjb25zdCBwcm9qZWN0TmFtZSA9IHVzZXJJbnB1dC52YWx1ZS50cmltKCk7XG4gICAgaWYgKCFwcm9qZWN0TmFtZSkgcmV0dXJuO1xuXG4gICAgcHJvamVjdFNwYW4udGV4dENvbnRlbnQgPSBwcm9qZWN0TmFtZTtcbiAgICB1c2VySW5wdXQucGFyZW50RWxlbWVudC5yZW1vdmUoKTtcbiAgICBwcm9qZWN0SXRlbS5pbnNlcnRCZWZvcmUocHJvamVjdFNwYW4sIHByb2plY3RJdGVtLmNoaWxkTm9kZXNbMF0pOyBcbn1cblxuY29uc3QgYWRkUHJvamVjdCA9ICgpID0+IHtcbiAgICBpZiAoYXdhaXRpbmdJbnB1dCgpKSByZXR1cm47XG4gICAgYWRkUHJvamVjdFRvU2lkZWJhcigpO1xuICAgIFxuICAgIGNvbnN0IHVzZXJJbnB1dCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJyN1c2VyLWlucHV0Jyk7XG4gICAgY29uc3QgaW5wdXRGb3JtID0gdXNlcklucHV0LnBhcmVudEVsZW1lbnQ7XG4gICAgY29uc3QgcHJvamVjdEl0ZW0gPSBpbnB1dEZvcm0ucGFyZW50RWxlbWVudDtcblxuICAgIHVzZXJJbnB1dC5hZGRFdmVudExpc3RlbmVyKCdibHVyJywgZnVuY3Rpb24gKCkge1xuICAgICAgICBpZiAodXNlcklucHV0LnZhbHVlLnRyaW0oKSA9PSAnJykge1xuICAgICAgICAgICAgcHJvamVjdEl0ZW0ucmVtb3ZlKCk7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgaGFuZGxlVXNlcklucHV0KCk7XG5cbiAgICAgICAgY29uc3QgcHJvamVjdE5hbWUgPSBwcm9qZWN0SXRlbS5maXJzdEVsZW1lbnRDaGlsZC50ZXh0Q29udGVudDtcbiAgICAgICAgaGFuZGxlcnMub25Qcm9qZWN0QWRkKHByb2plY3ROYW1lKTsgXG5cbiAgICAgICAgY29uc3QgcHJvamVjdExpc3QgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcucHJvamVjdC1saXN0Jyk7XG4gICAgICAgIC8vIFNlbGVjdCBsYXN0IHByb2plY3QgYWRkZWQgYW5kIGdldCBpZCBhdHRyaWJ1dGVcbiAgICAgICAgY29uc3QgcHJvamVjdElkID0gcHJvamVjdExpc3QuY2hpbGRyZW5bcHJvamVjdExpc3QuY2hpbGRFbGVtZW50Q291bnQgLSAyXS5nZXRBdHRyaWJ1dGUoJ2RhdGEtcHJvamVjdC1pZCcpO1xuICAgICAgICBpZiAoIWF3YWl0aW5nSW5wdXQoKSkgYWRkUHJvamVjdFRvTm90ZXBhZChwcm9qZWN0SWQpO1xuICAgIH0pO1xuXG4gICAgaW5wdXRGb3JtLmFkZEV2ZW50TGlzdGVuZXIoJ3N1Ym1pdCcsIGZ1bmN0aW9uIChlKSB7XG4gICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgaGFuZGxlVXNlcklucHV0KCk7XG4gICAgICAgIGNvbnN0IHByb2plY3ROYW1lID0gcHJvamVjdEl0ZW0uZmlyc3RFbGVtZW50Q2hpbGQudGV4dENvbnRlbnQ7XG4gICAgICAgIGhhbmRsZXJzLm9uUHJvamVjdEFkZChwcm9qZWN0TmFtZSk7IFxuICAgICAgICBjb25zdCBwcm9qZWN0TGlzdCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5wcm9qZWN0LWxpc3QnKTtcbiAgICAgICAgY29uc3QgcHJvamVjdElkID0gcHJvamVjdExpc3QuY2hpbGRyZW5bcHJvamVjdExpc3QuY2hpbGRFbGVtZW50Q291bnQgLSAyXS5nZXRBdHRyaWJ1dGUoJ2RhdGEtcHJvamVjdC1pZCcpO1xuICAgICAgICBpZiAoIWF3YWl0aW5nSW5wdXQoKSkgYWRkUHJvamVjdFRvTm90ZXBhZChwcm9qZWN0SWQpO1xuICAgIH0pO1xufVxuY29uc3QgZGVsZXRlUHJvamVjdCA9ICgpID0+IHtcbiAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIChlKSA9PiB7XG4gICAgICAgIGlmIChlLnRhcmdldC5jbG9zZXN0KCcuZGVsZXRlLXByb2plY3QnKSkge1xuICAgICAgICAgICAgY29uc3QgcHJvamVjdEl0ZW0gPSBlLnRhcmdldC5jbG9zZXN0KCcucHJvamVjdC1pdGVtJylcbiAgICAgICAgICAgIHByb2plY3RJdGVtLnJlbW92ZSgpO1xuICAgICAgICAgICAgY29uc3QgcHJvamVjdElkID0gcHJvamVjdEl0ZW0uZGF0YXNldC5wcm9qZWN0SWQ7XG4gICAgICAgICAgICB1cGRhdGVTdG9yYWdlLmRlbGV0ZVByb2plY3QocHJvamVjdElkKTtcbiAgICAgICAgfVxuICAgIH0pO1xuICAgIC8vIFRPRE86IFJlbW92ZSBwcm9qZWN0IGZyb20gbm90ZXBhZCBieSByZWxvYWRpbmcgbG9jYWxTdG9yYWdlIGl0ZW1zIGZvciBjdXJyZW50IHNlbGVjdGVkIHRhYiAoaS5lLiBUb2RheSkuIElmIGN1cnJlbnQgc2VsZWN0IHRhYiBpcyB0aGUgb25lIHRoYXQgaXMgZGVsZXRlZCBsb2FkIG5vdGVwYWQgd2l0aCBIb21lIHRhYiBcbn1cblxuLy8gVE9ETzogY3JlYXRlIGZ1bmN0aW9uIHRvIHVwZGF0ZSBwcm9qZWN0IG5hbWUgb24gbm90ZXBhZCB3aGVuIHVzZXIgZWRpdHMgaXRcbiBcbmNvbnN0IGVkaXRQcm9qZWN0ID0gKGUpID0+IHtcbiAgICBpZiAoYXdhaXRpbmdJbnB1dCgpKSByZXR1cm47XG4gICAgXG4gICAgLy8gVGhpcyBpcyBET00gU3R1ZmZcbiAgICBjb25zdCBpbnB1dEZvcm0gPSBjcmVhdGVFbGVtZW50cygpLmNyZWF0ZUZvcm0oKTtcbiAgICBjb25zdCBpbnB1dEZpZWxkID0gY3JlYXRlRWxlbWVudHMoKS5jcmVhdGVJbnB1dEZpZWxkKCdQcm9qZWN0IG5hbWUuLi4nKTtcbiAgICBjb25zdCBwcm9qZWN0TmFtZSA9IGUudGFyZ2V0LnBhcmVudEVsZW1lbnQucHJldmlvdXNFbGVtZW50U2libGluZztcblxuICAgIGlucHV0RmllbGQudmFsdWUgPSBwcm9qZWN0TmFtZS50ZXh0Q29udGVudDtcbiAgICBwcm9qZWN0TmFtZS5yZW1vdmUoKTtcbiAgICBpbnB1dEZvcm0uYXBwZW5kKGlucHV0RmllbGQpO1xuICAgIFxuICAgIGNvbnN0IHByb2plY3RJdGVtID0gZS50YXJnZXQuY2xvc2VzdCgnLnByb2plY3QtaXRlbScpO1xuICAgIHByb2plY3RJdGVtLmluc2VydEJlZm9yZShpbnB1dEZvcm0sIHByb2plY3RJdGVtLmNoaWxkTm9kZXNbMF0pO1xuICAgIFxuICAgIGNvbnN0IHVzZXJJbnB1dCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJyN1c2VyLWlucHV0Jyk7XG4gICAgdXNlcklucHV0LmZvY3VzKCk7XG4gICAgXG4gICAgY29uc3QgcHJvamVjdElkID0gcHJvamVjdEl0ZW0uZGF0YXNldC5wcm9qZWN0SWQ7XG5cbiAgICB1c2VySW5wdXQuYWRkRXZlbnRMaXN0ZW5lcignYmx1cicsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgaWYgKHVzZXJJbnB1dC52YWx1ZSAhPSAnJykgaGFuZGxlVXNlcklucHV0KCk7XG4gICAgICAgIC8vaWYgKCFhd2FpdGluZ0lucHV0KCkpIGVkaXRQcm9qZWN0T25Ob3RlcGFkKCk7XG4gICAgICAgIGNvbnN0IHByb2plY3ROYW1lID0gcHJvamVjdEl0ZW0uZmlyc3RFbGVtZW50Q2hpbGQudGV4dENvbnRlbnQ7XG4gICAgICAgIHVwZGF0ZU5hbWVPbk5vdGVwYWQocHJvamVjdElkLCBwcm9qZWN0TmFtZSk7XG4gICAgICAgIGhhbmRsZXJzLm9uUHJvamVjdE5hbWVFZGl0KHByb2plY3RJZCwgcHJvamVjdE5hbWUpO1xuICAgIH0pO1xuXG4gICAgaW5wdXRGb3JtLmFkZEV2ZW50TGlzdGVuZXIoJ3N1Ym1pdCcsIGZ1bmN0aW9uIChlKSB7XG4gICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgaGFuZGxlVXNlcklucHV0KCk7XG4gICAgICAgIC8vaWYgKCFhd2FpdGluZ0lucHV0KCkpIGVkaXRQcm9qZWN0T25Ob3RlcGFkKCk7XG4gICAgICAgIGNvbnN0IHByb2plY3ROYW1lID0gcHJvamVjdEl0ZW0uZmlyc3RFbGVtZW50Q2hpbGQudGV4dENvbnRlbnQ7XG4gICAgICAgIHVwZGF0ZU5hbWVPbk5vdGVwYWQocHJvamVjdElkLCBwcm9qZWN0TmFtZSk7XG4gICAgICAgIGhhbmRsZXJzLm9uUHJvamVjdE5hbWVFZGl0KHByb2plY3RJZCwgcHJvamVjdE5hbWUpO1xuICAgIH0pO1xuXG4gICAgY29uc3QgdXBkYXRlTmFtZU9uTm90ZXBhZCA9IChwcm9qZWN0SWQsIHByb2plY3ROYW1lKSA9PiB7XG4gICAgICAgIGNvbnN0IG5vdGVwYWQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcubm90ZXBhZCcpO1xuICAgICAgICBjb25zdCBwcm9qZWN0VGFza3NDb250YWluZXIgPSBub3RlcGFkLnF1ZXJ5U2VsZWN0b3IoYFtkYXRhLXByb2plY3QtaWQ9XCIke3Byb2plY3RJZH1cIl1gKTtcbiAgICAgICAgaWYgKHByb2plY3RUYXNrc0NvbnRhaW5lcikge1xuICAgICAgICAgICAgcHJvamVjdFRhc2tzQ29udGFpbmVyLmNoaWxkTm9kZXNbMF0uY2hpbGROb2Rlc1swXS50ZXh0Q29udGVudCA9IHByb2plY3ROYW1lO1xuICAgICAgICB9XG4gICAgfVxufVxuXG5leHBvcnQgeyBcbiAgICBhZGRQcm9qZWN0LFxuICAgIGRlbGV0ZVByb2plY3QsXG4gICAgZWRpdFByb2plY3Rcbn0iLCJpbXBvcnQge2NyZWF0ZUVsZW1lbnRzfSBmcm9tIFwiLi9jcmVhdGVET01FbGVtZW50c1wiO1xuaW1wb3J0IHtmb3JtYXR9IGZyb20gXCJkYXRlLWZuc1wiO1xuaW1wb3J0IGhhbmRsZXJzIGZyb20gXCIuL2hhbmRsZXJzXCI7XG5pbXBvcnQgdXBkYXRlU3RvcmFnZSBmcm9tIFwiLi9zdG9yYWdlXCI7XG5cbmNvbnN0IHRvZ2dsZVRhc2sgPSAodGFza0VsZW1lbnQpID0+IHtcbiAgICB0YXNrRWxlbWVudC5jbGFzc0xpc3QudG9nZ2xlKCdjb21wbGV0ZWQnKTtcbiAgICBsZXQgaXNDb21wbGV0ZSA9IGZhbHNlO1xuXG4gICAgaWYgKHRhc2tFbGVtZW50LmNsYXNzTGlzdC5jb250YWlucygnY29tcGxldGVkJykpIHtcbiAgICAgICAgaXNDb21wbGV0ZSA9IHRydWU7XG4gICAgfVxuICAgIGNvbnN0IHByb2plY3RJZCA9IHRhc2tFbGVtZW50LmNsb3Nlc3QoJy5wcm9qZWN0JykuZGF0YXNldC5wcm9qZWN0SWQ7XG4gICAgY29uc3QgdGFza0lkID0gdGFza0VsZW1lbnQuZGF0YXNldC50YXNrSWQ7XG5cbiAgICByZXR1cm4gaGFuZGxlcnMub25UYXNrQ29tcGxldGVFZGl0KHByb2plY3RJZCwgdGFza0lkLCBpc0NvbXBsZXRlKTtcbn1cblxuY29uc3QgYWRkVGFza1RvRE9NID0gKGFkZFRhc2tCdG4pID0+IHtcbiAgICBpZiAoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3VzZXItaW5wdXQnKSkgcmV0dXJuO1xuICAgIGNvbnN0IHRhc2tMaXN0RWxlbWVudCA9IGNyZWF0ZUVsZW1lbnRzKCkuY3JlYXRlTGlzdEVsZW1lbnQoJ3Rhc2snKTtcbiAgICBjb25zdCB0YXNrU3BhbiA9IGNyZWF0ZUVsZW1lbnRzKCkuY3JlYXRlU3BhbkVsZW1lbnQoJ3Rhc2staXRlbScpO1xuICAgIGNvbnN0IGlucHV0Rm9ybSA9IGNyZWF0ZUVsZW1lbnRzKCkuY3JlYXRlRm9ybSgpO1xuICAgIGNvbnN0IGlucHV0RmllbGQgPSBjcmVhdGVFbGVtZW50cygpLmNyZWF0ZUlucHV0RmllbGQoJ0VudGVyIFRhc2suLi4nKTtcbiAgICBcbiAgICBpbnB1dEZvcm0uYXBwZW5kKGlucHV0RmllbGQpO1xuICAgIHRhc2tTcGFuLmFwcGVuZChpbnB1dEZvcm0pO1xuXG4gICAgY29uc3QgaWNvblNwYW4gPSBjcmVhdGVFbGVtZW50cygpLmNyZWF0ZVNwYW5FbGVtZW50KCdpY29ucycpO1xuICAgIGNvbnN0IGVkaXRJY29uID0gY3JlYXRlRWxlbWVudHMoKS5jcmVhdGVJbWFnZUVsZW1lbnQoJ2ltYWdlcy9lZGl0LWljb24uc3ZnJywgJ2VkaXQtaWNvbicpO1xuICAgIGNvbnN0IGRlbGV0ZUljb24gPSBjcmVhdGVFbGVtZW50cygpLmNyZWF0ZUltYWdlRWxlbWVudCgnaW1hZ2VzL2RlbGV0ZS1pY29uLnN2ZycsICdkZWxldGUtaWNvbicpO1xuXG4gICAgZWRpdEljb24uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB7XG4gICAgICAgIGlmICh0YXNrTGlzdEVsZW1lbnQuY2xhc3NMaXN0LmNvbnRhaW5zKCdjb21wbGV0ZWQnKSkgcmV0dXJuO1xuICAgICAgICBjb25zdCB0YXNrVGV4dFNwYW4gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcudGFzay10ZXh0Jyk7XG4gICAgICAgIGNvbnN0IHRhc2tOYW1lID0gdGFza1RleHRTcGFuLnRleHRDb250ZW50O1xuICAgICAgICB0YXNrVGV4dFNwYW4ucmVtb3ZlKCk7XG4gICAgICAgIFxuICAgICAgICBjb25zdCBpbnB1dEZvcm0gPSBjcmVhdGVFbGVtZW50cygpLmNyZWF0ZUZvcm0oKTtcbiAgICAgICAgY29uc3QgaW5wdXRGaWVsZCA9IGNyZWF0ZUVsZW1lbnRzKCkuY3JlYXRlSW5wdXRGaWVsZCgnRW50ZXIgVGFzay4uLicpO1xuXG4gICAgICAgIGlucHV0RmllbGQudmFsdWUgPSB0YXNrTmFtZTtcbiAgICAgICAgXG4gICAgICAgIGlucHV0Rm9ybS5hcHBlbmQoaW5wdXRGaWVsZCk7XG4gICAgICAgIHRhc2tTcGFuLmluc2VydEJlZm9yZShpbnB1dEZvcm0sIGljb25TcGFuKTtcbiAgICAgICAgdGFza0xpc3RFbGVtZW50LnByZXBlbmQodGFza1NwYW4pO1xuICAgICAgICBpbnB1dEZpZWxkLmZvY3VzKCk7XG4gICAgICAgIGFkZFRhc2soKTtcbiAgICB9KTtcblxuICAgIGRlbGV0ZUljb24uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoZSkgPT4ge1xuICAgICAgICBjb25zdCBwcm9qZWN0SWQgPSBlLnRhcmdldC5jbG9zZXN0KCdbZGF0YS1wcm9qZWN0LWlkXScpLmRhdGFzZXQucHJvamVjdElkO1xuICAgICAgICBjb25zdCB0YXNrSWQgPSBlLnRhcmdldC5jbG9zZXN0KCdbZGF0YS10YXNrLWlkXScpLmRhdGFzZXQudGFza0lkO1xuXG4gICAgICAgIHRhc2tMaXN0RWxlbWVudC5yZW1vdmUoKTtcbiAgICAgICAgdXBkYXRlU3RvcmFnZS5kZWxldGVUYXNrKHByb2plY3RJZCwgdGFza0lkKTtcbiAgICB9KTtcblxuICAgIGljb25TcGFuLmFwcGVuZChlZGl0SWNvbiwgZGVsZXRlSWNvbik7XG4gICAgdGFza1NwYW4uYXBwZW5kKGljb25TcGFuKTtcbiAgICBjb25zdCBkdWVEYXRlID0gYWRkRHVlRGF0ZVRvRE9NKCk7XG4gICAgdGFza0xpc3RFbGVtZW50LmFwcGVuZCh0YXNrU3BhbiwgZHVlRGF0ZSk7XG4gICAgXG4gICAgY29uc3QgY29udGFpbmVyID0gYWRkVGFza0J0bi5jbG9zZXN0KCcudG9kb3MnKTtcbiAgICBjb25zdCBudW1iZXJPZlRhc2tzID0gY29udGFpbmVyLmNoaWxkRWxlbWVudENvdW50IC0gMjtcblxuICAgIGNvbnRhaW5lci5pbnNlcnRCZWZvcmUodGFza0xpc3RFbGVtZW50LCBjb250YWluZXIuY2hpbGRyZW5bbnVtYmVyT2ZUYXNrc10pO1xuXG4gICAgc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICAgIGlucHV0RmllbGQuZm9jdXMoKTtcbiAgICB9LCAwKTtcblxuICAgIHJldHVybiB0YXNrU3Bhbjtcbn1cblxuY29uc3QgYWRkRHVlRGF0ZVRvRE9NID0gKCkgPT4ge1xuICAgIGNvbnN0IGR1ZURhdGVTcGFuID0gY3JlYXRlRWxlbWVudHMoKS5jcmVhdGVTcGFuRWxlbWVudCgnZHVlLWRhdGUnKTtcblxuICAgIGNvbnN0IHByaW9yaXR5SWNvbiA9IGNyZWF0ZUVsZW1lbnRzKCkuY3JlYXRlSW1hZ2VFbGVtZW50KCdpbWFnZXMvcHJpb3JpdHktaWNvbi5zdmcnLCAncHJpb3JpdHktaWNvbicpXG4gICAgcHJpb3JpdHlJY29uLmNsYXNzTGlzdC5hZGQoJ3ByaW9yaXR5LWxvdycpO1xuICAgIFxuICAgIGNvbnN0IGRhdGVMYWJlbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2xhYmVsJyk7XG4gICAgZGF0ZUxhYmVsLmNsYXNzTGlzdC5hZGQoJ2RhdGUtbGFiZWwnKTtcbiAgICBcbiAgICBjb25zdCBkYXRlSW5wdXQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdpbnB1dCcpO1xuICAgIGRhdGVJbnB1dC5zZXRBdHRyaWJ1dGUoJ3R5cGUnLCAnZGF0ZScpO1xuICAgIGRhdGVJbnB1dC5yZXF1aXJlZCA9IHRydWU7XG5cbiAgICBjb25zdCBjYWxlbmRhckljb24gPSBjcmVhdGVFbGVtZW50cygpLmNyZWF0ZUltYWdlRWxlbWVudCgnaW1hZ2VzL2NhbGVuZGFyLWljb24uc3ZnJywgJ2NhbGVuZGFyLWljb24nKTtcblxuICAgIGRhdGVMYWJlbC5hcHBlbmQoZGF0ZUlucHV0LCBjYWxlbmRhckljb24pO1xuICAgIGR1ZURhdGVTcGFuLmFwcGVuZChwcmlvcml0eUljb24sIGRhdGVMYWJlbCk7XG4gICAgXG4gICAgLy8gdXBkYXRlIGxvY2FsU3RvcmFnZSBvbiBkdWUgZGF0ZSBjaGFuZ2VcbiAgICBkYXRlSW5wdXQuYWRkRXZlbnRMaXN0ZW5lcignY2hhbmdlJywgKCkgPT4ge1xuICAgICAgICBjb25zdCBwcm9qZWN0SWQgPSBkYXRlSW5wdXQuY2xvc2VzdChbJy5wcm9qZWN0J10pLmRhdGFzZXQucHJvamVjdElkO1xuICAgICAgICBjb25zdCB0YXNrSWQgPSBkYXRlSW5wdXQuY2xvc2VzdCgnW2RhdGEtdGFzay1pZCcpLmRhdGFzZXQudGFza0lkO1xuICAgICAgICBjb25zdCBuZXdEdWVEYXRlID0gZGF0ZUlucHV0LnZhbHVlO1xuXG4gICAgICAgIHJldHVybiBoYW5kbGVycy5vblRhc2tEdWVEYXRlRWRpdChwcm9qZWN0SWQsIHRhc2tJZCwgbmV3RHVlRGF0ZSk7XG4gICAgfSk7XG5cbiAgICByZXR1cm4gZHVlRGF0ZVNwYW47XG59XG5cblxuXG5jb25zdCBhZGRUYXNrID0gKCkgPT4ge1xuICAgIGNvbnN0IGlucHV0RmllbGQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcjdXNlci1pbnB1dCcpO1xuICAgIGNvbnN0IGlucHV0Rm9ybSA9IGlucHV0RmllbGQucGFyZW50RWxlbWVudDtcbiAgICBjb25zdCB0YXNrQ29udGFpbmVyID0gaW5wdXRGb3JtLnBhcmVudEVsZW1lbnQucGFyZW50RWxlbWVudDtcbiAgICBcbiAgICBpbnB1dEZpZWxkLmFkZEV2ZW50TGlzdGVuZXIoJ2JsdXInLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGNvbnN0IHByb2plY3RJZCA9IHRhc2tDb250YWluZXIuY2xvc2VzdCgnW2RhdGEtcHJvamVjdC1pZF0nKS5kYXRhc2V0LnByb2plY3RJZDtcbiAgICAgICAgY29uc3QgdGFzayA9IGlucHV0RmllbGQudmFsdWU7XG4gICAgICAgIHZhbGlkYXRlVXNlcklucHV0KCk7XG4gICAgICAgIGlmICh0YXNrKSBjcmVhdGVUYXNrKHRhc2ssIHByb2plY3RJZCwgdGFza0NvbnRhaW5lcik7XG4gICAgfSk7XG4gICAgXG4gICAgaW5wdXRGb3JtLmFkZEV2ZW50TGlzdGVuZXIoJ3N1Ym1pdCcsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICBjb25zdCBwcm9qZWN0SWQgPSB0YXNrQ29udGFpbmVyLmNsb3Nlc3QoJ1tkYXRhLXByb2plY3QtaWRdJykuZGF0YXNldC5wcm9qZWN0SWQ7XG4gICAgICAgIGNvbnN0IHRhc2sgPSBpbnB1dEZpZWxkLnZhbHVlO1xuICAgICAgICB2YWxpZGF0ZVVzZXJJbnB1dCgpO1xuICAgICAgICBpZiAodGFzaykgY3JlYXRlVGFzayh0YXNrLCBwcm9qZWN0SWQsIHRhc2tDb250YWluZXIpO1xuICAgIH0pO1xufVxuXG5jb25zdCBjcmVhdGVUYXNrID0gKHRhc2ssIHByb2plY3RJZCwgdGFza0NvbnRhaW5lcikgPT4ge1xuICAgIGlmICh0YXNrQ29udGFpbmVyLmRhdGFzZXQudGFza0lkKSB7XG4gICAgICAgIHJldHVybiBoYW5kbGVycy5vblRhc2tOYW1lRWRpdChwcm9qZWN0SWQsIHRhc2tDb250YWluZXIuZGF0YXNldC50YXNrSWQsIHRhc2spO1xuICAgIH1cbiAgICBjb25zdCB0YXNrT2JqID0gaGFuZGxlcnMub25UYXNrQWRkKHRhc2ssIHByb2plY3RJZCk7XG4gICAgdGFza0NvbnRhaW5lci5zZXRBdHRyaWJ1dGUoJ2RhdGEtdGFzay1pZCcsIHRhc2tPYmoudGFza0lkKTtcbn1cblxuY29uc3QgdmFsaWRhdGVVc2VySW5wdXQgPSAoKSA9PiB7XG4gICAgY29uc3QgaW5wdXRGaWVsZCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJyN1c2VyLWlucHV0Jyk7XG4gICAgY29uc3QgaW5wdXRGb3JtID0gaW5wdXRGaWVsZC5wYXJlbnRFbGVtZW50O1xuICAgIGNvbnN0IHRhc2tJdGVtID0gaW5wdXRGb3JtLnBhcmVudEVsZW1lbnQ7XG4gICAgY29uc3QgdGFza0NvbnRhaW5lciA9IHRhc2tJdGVtLnBhcmVudEVsZW1lbnQ7XG5cbiAgICBjb25zdCB1c2VySW5wdXQgPSBpbnB1dEZpZWxkLnZhbHVlLnRyaW0oKTtcbiAgICBjb25zdCB0YXNrVGV4dFNwYW4gPSBjcmVhdGVFbGVtZW50cygpLmNyZWF0ZVNwYW5FbGVtZW50KCd0YXNrLXRleHQnKTtcbiAgICB0YXNrVGV4dFNwYW4uYXBwZW5kKHVzZXJJbnB1dCk7XG5cbiAgICAvLyBSZW1vdmVzIHRhc2sgY29udGFpbmVyIGlmIHRhc2sgaXNuJ3QgeWV0IGluIGxvY2FsU3RvcmFnZSAoaGFzIGEgdGFza0lkIGRhdGEgYXR0cmlidXRlKVxuICAgIGlmICh1c2VySW5wdXQgPT0gJycgJiYgIXRhc2tDb250YWluZXIuZGF0YXNldC50YXNrSWQpIHtcbiAgICAgICAgdGFza0NvbnRhaW5lci5yZW1vdmUoKTtcbiAgICAgICAgcmV0dXJuO1xuICAgIH0gXG4gICAgZWxzZSBpZiAodXNlcklucHV0ID09ICcnICYmIHRhc2tDb250YWluZXIuZGF0YXNldC50YXNrSWQpIHJldHVybjtcbiAgICBpbnB1dEZvcm0ucmVtb3ZlKCk7XG4gICAgdGFza0l0ZW0ucHJlcGVuZCh0YXNrVGV4dFNwYW4pO1xufVxuXG5jb25zdCB1cGRhdGVQcmlvcml0eSA9IChldmVudFRhcmdldCkgPT4ge1xuICAgIGNvbnN0IHRhc2tJdGVtQ2xhc3NMaXN0ID0gZXZlbnRUYXJnZXQucGFyZW50RWxlbWVudC5wYXJlbnRFbGVtZW50LmNsYXNzTGlzdDtcbiAgICBpZiAodGFza0l0ZW1DbGFzc0xpc3QuY29udGFpbnMoJ2NvbXBsZXRlZCcpKSByZXR1cm47XG4gICAgY29uc3QgcHJvamVjdElkID0gZXZlbnRUYXJnZXQuY2xvc2VzdCgnLnByb2plY3QnKS5kYXRhc2V0LnByb2plY3RJZDtcbiAgICBjb25zdCB0YXNrSWQgPSBldmVudFRhcmdldC5jbG9zZXN0KCdbZGF0YS10YXNrLWlkXScpLmRhdGFzZXQudGFza0lkO1xuXG4gICAgY29uc3QgcHJpb3JpdHlDbGFzc0xpc3QgPSBldmVudFRhcmdldC5jbGFzc0xpc3Q7XG5cbiAgICBpZiAocHJpb3JpdHlDbGFzc0xpc3QuY29udGFpbnMoJ3ByaW9yaXR5LWxvdycpKSB7XG4gICAgICAgIHByaW9yaXR5Q2xhc3NMaXN0LnJlbW92ZSgncHJpb3JpdHktbG93Jyk7XG4gICAgICAgIHByaW9yaXR5Q2xhc3NMaXN0LmFkZCgncHJpb3JpdHktbWVkaXVtJyk7XG4gICAgICAgIHJldHVybiBoYW5kbGVycy5vblRhc2tQcmlvcml0eUVkaXQocHJvamVjdElkLCB0YXNrSWQsICdtZWRpdW0nKTsgXG4gICAgfVxuICAgIGlmIChwcmlvcml0eUNsYXNzTGlzdC5jb250YWlucygncHJpb3JpdHktbWVkaXVtJykpIHtcbiAgICAgICAgcHJpb3JpdHlDbGFzc0xpc3QucmVtb3ZlKCdwcmlvcml0eS1tZWRpdW0nKTtcbiAgICAgICAgcHJpb3JpdHlDbGFzc0xpc3QuYWRkKCdwcmlvcml0eS1oaWdoJyk7XG4gICAgICAgIHJldHVybiBoYW5kbGVycy5vblRhc2tQcmlvcml0eUVkaXQocHJvamVjdElkLCB0YXNrSWQsICdoaWdoJyk7XG4gICAgfVxuICAgIGlmIChwcmlvcml0eUNsYXNzTGlzdC5jb250YWlucygncHJpb3JpdHktaGlnaCcpKSB7XG4gICAgICAgIHByaW9yaXR5Q2xhc3NMaXN0LnJlbW92ZSgncHJpb3JpdHktaGlnaCcpO1xuICAgICAgICBwcmlvcml0eUNsYXNzTGlzdC5hZGQoJ3ByaW9yaXR5LWxvdycpO1xuICAgICAgICByZXR1cm4gaGFuZGxlcnMub25UYXNrUHJpb3JpdHlFZGl0KHByb2plY3RJZCwgdGFza0lkLCAnbG93Jyk7XG4gICAgfVxufVxuXG5leHBvcnQge1xuICAgIHRvZ2dsZVRhc2ssXG4gICAgYWRkVGFza1RvRE9NLFxuICAgIGFkZFRhc2ssXG4gICAgdXBkYXRlUHJpb3JpdHksXG59IiwiaW1wb3J0IHsgYWRkUHJvamVjdCwgZGVsZXRlUHJvamVjdCwgZWRpdFByb2plY3QgfSBmcm9tIFwiLi9wcm9qZWN0c1wiO1xuaW1wb3J0IHVwZGF0ZVN0b3JhZ2UgZnJvbSBcIi4vc3RvcmFnZVwiO1xuaW1wb3J0IHsgdXBkYXRlUHJvamVjdExpc3QsIGFkZFByb2plY3RUb05vdGVwYWQgfSBmcm9tIFwiLi9jcmVhdGVET01FbGVtZW50c1wiO1xuaW1wb3J0IHsgdG9nZ2xlVGFzaywgYWRkVGFza1RvRE9NLCBhZGRUYXNrLCB1cGRhdGVQcmlvcml0eSB9IGZyb20gXCIuL3Rhc2tzXCI7XG5cbi8vIExvYWQgbG9jYWxTdG9yYWdlIGl0ZW1zIG9uIHBhZ2UgbG9hZFxud2luZG93Lm9ubG9hZCA9ICgpID0+IHtcbiAgICBjb25zdCBwcm9qZWN0cyA9IHVwZGF0ZVN0b3JhZ2UuZ2V0UHJvamVjdHMoKTtcblxuICAgIGNvbnN0IGxvYWRBbGxQcm9qZWN0cyA9ICgpID0+IHtcbiAgICAgICAgcHJvamVjdHMuZm9yRWFjaChwcm9qZWN0ID0+IHtcbiAgICAgICAgICAgIGFkZFByb2plY3RUb05vdGVwYWQocHJvamVjdC5pZCk7XG4gICAgICAgIH0pO1xuICAgIH0gIFxuICAgIFxuICAgIHVwZGF0ZVByb2plY3RMaXN0KHByb2plY3RzKTtcbiAgICBsb2FkQWxsUHJvamVjdHMocHJvamVjdHMpO1xufVxuXG4vLyBTaWRlYmFyIE1vZHVsZVxuY29uc3Qgc2lkZWJhckNvbnRyb2xsZXIgPSAoKCkgPT4ge1xuXG4gICAgY29uc3QgbW9iaWxlVG9nZ2xlQnRuID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2JhcnMtaWNvbi1tb2JpbGUnKTtcbiAgICBpZiAod2luZG93LmlubmVyV2lkdGggPD0gMTAyNCAmJiBtb2JpbGVUb2dnbGVCdG4uY2xhc3NMaXN0LmNvbnRhaW5zKCdoaWRkZW4nKSkge1xuICAgICAgICBtb2JpbGVUb2dnbGVCdG4uY2xhc3NMaXN0LnRvZ2dsZSgnaGlkZGVuJyk7XG4gICAgfVxuXG4gICAgY29uc3Qgc2lkZWJhciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzaWRlYmFyJyk7XG4gICAgXG4gICAgY29uc3QgdG9nZ2xlU2lkZWJhciA9ICgpID0+IHtcbiAgICAgICAgc2lkZWJhci5jbGFzc0xpc3QudG9nZ2xlKCd0b2dnbGUtc2lkZWJhcicpO1xuICAgICAgICBpZiAod2luZG93LmlubmVyV2lkdGggPD0gMTAyNCkgbW9iaWxlVG9nZ2xlQnRuLmNsYXNzTGlzdC50b2dnbGUoJ2hpZGRlbicpO1xuICAgIH1cbiAgICBcbiAgICBjb25zdCB0b2dnbGVCdG4gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcuYmFycy1pY29uJyk7XG4gICAgdG9nZ2xlQnRuLmZvckVhY2goYnV0dG9uID0+IHtcbiAgICAgICAgYnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgdG9nZ2xlU2lkZWJhcik7XG4gICAgfSk7ICAgICAgICBcbn0pKCk7XG5cbmNvbnN0IHByb2plY3RDb250cm9sbGVyID0gKCgpID0+IHtcbiAgICBkZWxldGVQcm9qZWN0KCk7XG4gICAgY29uc3QgYWRkUHJvamVjdEJ0biA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJ1tkYXRhLWFkZC1wcm9qZWN0XScpO1xuICAgIGFkZFByb2plY3RCdG4uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBhZGRQcm9qZWN0KTtcblxuICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKGUpID0+IHtcbiAgICAgICAgaWYgKGUudGFyZ2V0LmNsYXNzTGlzdC5jb250YWlucygnZWRpdC1wcm9qZWN0JykpIHtcbiAgICAgICAgICAgIGVkaXRQcm9qZWN0KGUpO1xuICAgICAgICB9XG4gICAgfSk7XG59KSgpO1xuXG5jb25zdCB0YXNrQ29udHJvbGxlciA9ICgoKSA9PiB7XG4gICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoZSkgPT4ge1xuICAgICAgICBpZiAoZS50YXJnZXQuY2xhc3NMaXN0LmNvbnRhaW5zKCd0YXNrLXRleHQnKSkge1xuICAgICAgICAgICAgY29uc3QgdGFza0VsZW1lbnQgPSBlLnRhcmdldC5jbG9zZXN0KCcudGFzaycpO1xuICAgICAgICAgICAgdG9nZ2xlVGFzayh0YXNrRWxlbWVudCk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGUudGFyZ2V0LmNsYXNzTGlzdC5jb250YWlucygnYWRkLXRhc2snKSkge1xuICAgICAgICAgICAgYWRkVGFza1RvRE9NKGUudGFyZ2V0KTtcbiAgICAgICAgICAgIGFkZFRhc2soKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoZS50YXJnZXQuY2xhc3NMaXN0LmNvbnRhaW5zKCdwcmlvcml0eS1pY29uJykpIHtcbiAgICAgICAgICAgIHVwZGF0ZVByaW9yaXR5KGUudGFyZ2V0KTtcbiAgICAgICAgfVxuICAgIH0pO1xufSkoKTsiXSwibmFtZXMiOlsiZ2V0UHJvamVjdHMiLCJKU09OIiwicGFyc2UiLCJsb2NhbFN0b3JhZ2UiLCJnZXRJdGVtIiwic2F2ZVByb2plY3QiLCJwcm9qZWN0VG9TYXZlIiwicHJvamVjdHMiLCJleGlzdGluZyIsImZpbmQiLCJwcm9qZWN0IiwiaWQiLCJwcm9qZWN0TmFtZSIsInRhc2tzIiwiTWF0aCIsImZsb29yIiwicmFuZG9tIiwicHVzaCIsInNldEl0ZW0iLCJzdHJpbmdpZnkiLCJnZXRUYXNrcyIsInByb2plY3RJZCIsImRlbGV0ZVByb2plY3QiLCJ1cGRhdGVkUHJvamVjdExpc3QiLCJmaWx0ZXIiLCJkZWxldGVUYXNrIiwidGFza0lkIiwicHJvamVjdFdpdGhUYXNrIiwidXBkYXRlZFRhc2tPYmoiLCJ0YXNrT2JqIiwiZmluZFRhc2tUb1VwZGF0ZSIsImV4aXN0aW5nVGFza0lkIiwidGFzayIsInVwZGF0ZVRhc2siLCJ1cGRhdGVkVGFzayIsInByb2plY3RUb1VwZGF0ZSIsInRhc2tzQXJyYXkiLCJpbmRleE9mVXBkYXRlZFRhc2siLCJmaW5kSW5kZXgiLCJfcmVmcmVzaFByb2plY3RMaXN0IiwiX3NldFByb2plY3RMaXN0IiwidXBkYXRlUHJvamVjdExpc3QiLCJfc2V0QWN0aXZlVGFiIiwidGFiIiwidXBkYXRlQWN0aXZlVGFiIiwib25Qcm9qZWN0U2VsZWN0IiwicHJvamVjdE9iamVjdCIsInNlbGVjdGVkUHJvamVjdCIsImRvY3VtZW50IiwicXVlcnlTZWxlY3RvciIsIm9uUHJvamVjdEFkZCIsIm5ld1Byb2plY3QiLCJuZXdQcm9qZWN0RE9NRWxlbWVudCIsIm9uUHJvamVjdE5hbWVFZGl0Iiwib25UYXNrQWRkIiwibmV3VGFzayIsIml0ZW0iLCJwcmlvcml0eSIsImR1ZURhdGUiLCJpc0NvbXBsZXRlIiwib25UYXNrTmFtZUVkaXQiLCJuZXdUYXNrTmFtZSIsImV4aXN0aW5nVGFzayIsIm9uVGFza1ByaW9yaXR5RWRpdCIsIm5ld1ByaW9yaXR5Iiwib25UYXNrRHVlRGF0ZUVkaXQiLCJuZXdEdWVEYXRlIiwib25UYXNrQ29tcGxldGVFZGl0IiwiY3JlYXRlRWxlbWVudHMiLCJjcmVhdGVMaXN0RWxlbWVudCIsImh0bWxDbGFzcyIsImxpIiwiY3JlYXRlRWxlbWVudCIsInNldEF0dHJpYnV0ZSIsImNyZWF0ZVNwYW5FbGVtZW50Iiwic3BhbiIsImNsYXNzTGlzdCIsImFkZCIsImNyZWF0ZUltYWdlRWxlbWVudCIsInNyYyIsImltZyIsImNyZWF0ZUlucHV0RmllbGQiLCJwbGFjZWhvbGRlclRleHQiLCJ1c2VySW5wdXQiLCJyZXF1aXJlZCIsImNyZWF0ZUZvcm0iLCJjcmVhdGVEaXYiLCJkaXYiLCJjcmVhdGVJY29uU3BhbiIsInZpZXciLCJpY29uU3BhbiIsImVkaXRJY29uIiwiZGVsZXRlSWNvbiIsImFwcGVuZCIsImFkZFByb2plY3RUb05vdGVwYWQiLCJub3RlcGFkIiwicHJvamVjdERpdiIsInNraXBMaW5lIiwicHJvamVjdEhlYWRpbmciLCJoMiIsInRleHRDb250ZW50IiwiaDMiLCJ0YXNrc0NvbnRhaW5lciIsImFkZFRhc2tMaXN0RWxlbWVudCIsImFkZFRhc2tTcGFuIiwiYWRkSWNvbiIsIl9jcmVhdGVQcm9qZWN0SXRlbUhUTUwiLCJuYW1lIiwicHJvamVjdEl0ZW0iLCJwcm9qZWN0c0xpc3RDb250YWluZXIiLCJhZGRQcm9qZWN0QnRuIiwic2xpY2UiLCJjYWxsIiwiY2hpbGRyZW4iLCJmb3JFYWNoIiwiY29udGFpbnMiLCJyZW1vdmUiLCJodG1sIiwiaW5zZXJ0QmVmb3JlIiwicXVlcnlTZWxlY3RvckFsbCIsImFkZEV2ZW50TGlzdGVuZXIiLCJkYXRhc2V0IiwiY3VycmVudEFjdGl2ZVRhYiIsImF3YWl0aW5nSW5wdXQiLCJoYW5kbGVVc2VySW5wdXQiLCJwYXJlbnRFbGVtZW50IiwicHJvamVjdFNwYW4iLCJ2YWx1ZSIsInRyaW0iLCJjaGlsZE5vZGVzIiwiYWRkUHJvamVjdCIsInByb2plY3RzQ29udGFpbmVyIiwicHJvamVjdExpc3RFbGVtZW50IiwicHJvamVjdElucHV0Rm9ybSIsInByb2plY3ROYW1lSW5wdXQiLCJsYXN0RWxlbWVudENoaWxkIiwic2V0VGltZW91dCIsImZvY3VzIiwiYWRkUHJvamVjdFRvU2lkZWJhciIsImlucHV0Rm9ybSIsImZpcnN0RWxlbWVudENoaWxkIiwicHJvamVjdExpc3QiLCJjaGlsZEVsZW1lbnRDb3VudCIsImdldEF0dHJpYnV0ZSIsImUiLCJwcmV2ZW50RGVmYXVsdCIsImFkZFRhc2siLCJpbnB1dEZpZWxkIiwidGFza0NvbnRhaW5lciIsImNsb3Nlc3QiLCJ2YWxpZGF0ZVVzZXJJbnB1dCIsImNyZWF0ZVRhc2siLCJ0YXNrSXRlbSIsInRhc2tUZXh0U3BhbiIsInByZXBlbmQiLCJ3aW5kb3ciLCJvbmxvYWQiLCJtb2JpbGVUb2dnbGVCdG4iLCJnZXRFbGVtZW50QnlJZCIsImlubmVyV2lkdGgiLCJ0b2dnbGUiLCJzaWRlYmFyIiwidG9nZ2xlU2lkZWJhciIsImJ1dHRvbiIsInRhcmdldCIsInByZXZpb3VzRWxlbWVudFNpYmxpbmciLCJ1cGRhdGVOYW1lT25Ob3RlcGFkIiwicHJvamVjdFRhc2tzQ29udGFpbmVyIiwiZWRpdFByb2plY3QiLCJ0YXNrRWxlbWVudCIsInRvZ2dsZVRhc2siLCJhZGRUYXNrQnRuIiwidGFza0xpc3RFbGVtZW50IiwidGFza1NwYW4iLCJ0YXNrTmFtZSIsImR1ZURhdGVTcGFuIiwicHJpb3JpdHlJY29uIiwiZGF0ZUxhYmVsIiwiZGF0ZUlucHV0IiwiY2FsZW5kYXJJY29uIiwiYWRkRHVlRGF0ZVRvRE9NIiwiY29udGFpbmVyIiwibnVtYmVyT2ZUYXNrcyIsImFkZFRhc2tUb0RPTSIsImV2ZW50VGFyZ2V0IiwicHJpb3JpdHlDbGFzc0xpc3QiLCJ1cGRhdGVQcmlvcml0eSJdLCJzb3VyY2VSb290IjoiIn0=