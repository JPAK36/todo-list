(()=>{"use strict";const e=(()=>{const e=()=>JSON.parse(localStorage.getItem("projects")||"[]"),t=t=>{const n=e(),r=n.find((e=>e.id==t.id));r?(r.projectName=t.projectName,r.tasks=t.tasks):(t.id=Math.floor(1e6*Math.random()),n.push(t)),localStorage.setItem("projects",JSON.stringify(n))};return{getProjects:e,saveProject:t,deleteProject:t=>{const n=e().filter((e=>e.id!=t));localStorage.setItem("projects",JSON.stringify(n))},deleteTask:(n,r)=>{const c=e().filter((e=>e.id==n))[0],o=c.tasks.filter((e=>e.task.taskId!=r));c.tasks=o,t(c)}}})(),t=(()=>{const t=()=>{const t=e.getProjects();n(t)},n=e=>{a(e)},r=e=>{s(e)};return{onProjectSelect:t=>{const n=e.getProjects().find((e=>e.id==t)),c=document.querySelector(`[data-project-id='${n.id}']`);r(c)},onProjectAdd:n=>{const c={projectName:n,tasks:[]};e.saveProject(c),t();const o=document.querySelector(`[data-project-id='${c.id}']`);r(o)},onProjectEdit:(n,r,c)=>{e.saveProject({id:n,projectName:r,tasks:c}),t()},onTaskAdd:(t,n)=>{const r={task:{item:t,taskId:Math.floor(1e6*Math.random()),priority:"low",dueDate:null,isComplete:!1}},c=e.getProjects().find((e=>e.id==n));return c.tasks.push(r),e.saveProject(c),r}}})(),n=()=>({createListElement:e=>{const t=document.createElement("li");return t.setAttribute("class",e),t},createSpanElement:e=>{const t=document.createElement("span");return t.classList.add(e),t},createImageElement:(e,t)=>{const n=document.createElement("img");return n.classList.add(t),n.setAttribute("src",e),n.setAttribute("draggable","false"),n},createInputField:e=>{const t=document.createElement("input");return t.setAttribute("type","text"),t.setAttribute("placeholder",e),t.setAttribute("id","user-input"),t.required=!0,t},createForm:()=>document.createElement("form"),createDiv:e=>{const t=document.createElement("div");return t.setAttribute("class",e),t}}),r=()=>{const e=n(),t=e.createSpanElement("icons"),r=e.createImageElement("images/edit-icon.svg","edit-icon"),c=e.createImageElement("images/delete-icon.svg","delete-icon");return r.classList.add("edit-project"),c.classList.add("delete-project"),t.append(r,c),t},c=e=>{const t=n(),r=document.querySelector(".project-list"),c=r.childElementCount-2,o=r.children[c].textContent,a=document.querySelector("#writing-area"),s=t.createDiv("project");s.setAttribute("data-project-id",e);const i=t.createDiv("skip-line"),d=t.createDiv("project-heading"),l=document.createElement("h2");l.setAttribute("class","notepad-text"),l.textContent=o;const m=document.createElement("h3");m.setAttribute("class","notepad-text"),m.textContent="Due Date";const p=document.createElement("ul");p.classList.add("notepad-text","todos");const u=t.createListElement("task"),E=t.createSpanElement("add-task"),g=t.createImageElement("images/add-icon.svg","add-icon");E.append(g,"Add Task"),u.append(E),p.append(u,i),d.append(l,m),s.append(d,p),a.append(s)},o=(e,t)=>{const c=n(),o=c.createListElement("project-item");o.setAttribute("data-project-id",e);const a=c.createSpanElement("project-name");a.textContent=t;const s=r();return o.append(a,s),o},a=e=>{const n=document.querySelector(".project-list"),r=document.querySelector("[data-add-project]");[].slice.call(n.children).forEach((e=>{e.classList.contains("project-item")&&e.remove()}));for(const t of e){const e=o(t.id,t.projectName);n.insertBefore(e,r)}n.querySelectorAll(".project-item").forEach((e=>{e.addEventListener("click",(()=>{t.onProjectSelect(e.dataset.projectId)}))}))},s=e=>{const t=document.querySelector(".active");t&&t.classList.remove("active"),e.classList.add("active"),e.children.item(0)},i=()=>null!=document.querySelector("#user-input"),d=()=>{const e=document.querySelector("#user-input"),t=e.parentElement.parentElement,r=n().createSpanElement("project-name"),c=e.value.trim();c&&(r.textContent=c,e.parentElement.remove(),t.insertBefore(r,t.childNodes[0]))},l=()=>{if(i())return;(()=>{const e=n(),t=document.querySelector(".project-list"),c=e.createListElement("project-item"),o=e.createForm(),a=e.createInputField("Project name...");o.append(a);const s=r();c.append(o,s),t.insertBefore(c,t.lastElementChild),setTimeout((()=>{a.focus()}),0)})();const e=document.querySelector("#user-input"),o=e.parentElement,a=o.parentElement;e.addEventListener("blur",(function(){if(""==e.value.trim())return void a.remove();d();const n=a.firstElementChild.textContent;t.onProjectAdd(n);const r=document.querySelector(".project-list"),o=r.children[r.childElementCount-2].getAttribute("data-project-id");i()||c(o)})),o.addEventListener("submit",(function(e){e.preventDefault(),d();const n=a.firstElementChild.textContent;t.onProjectAdd(n);const r=document.querySelector(".project-list"),o=r.children[r.childElementCount-2].getAttribute("data-project-id");i()||c(o)}))},m=()=>{const e=document.querySelector("#user-input"),t=e.parentElement,n=t.parentElement.parentElement;e.addEventListener("blur",(function(t){const r=t.target.closest("[data-project-id]").dataset.projectId,c=e.value;u(),c&&p(c,r,n)})),t.addEventListener("submit",(function(t){t.preventDefault();const r=t.target.closest("[data-project-id]").dataset.projectId,c=e.value;u(),c&&p(c,r,n)}))},p=(e,n,r)=>{const c=t.onTaskAdd(e,n);r.setAttribute("data-task-id",c.task.taskId)},u=()=>{const e=document.querySelector("#user-input"),t=e.parentElement,r=t.parentElement,c=r.parentElement,o=e.value.trim(),a=n().createSpanElement("task-text");a.append(o),""!=o?(t.remove(),r.prepend(a)):c.remove()};window.onload=()=>{const t=e.getProjects();a(t)},(()=>{const e=document.getElementById("bars-icon-mobile");window.innerWidth<=1024&&e.classList.contains("hidden")&&e.classList.toggle("hidden");const t=document.getElementById("sidebar"),n=()=>{t.classList.toggle("toggle-sidebar"),window.innerWidth<=1024&&e.classList.toggle("hidden")};document.querySelectorAll(".bars-icon").forEach((e=>{e.addEventListener("click",n)}))})(),document.addEventListener("click",(t=>{if(t.target.closest(".delete-project")){const n=t.target.closest(".project-item");n.remove();const r=n.dataset.projectId;e.deleteProject(r)}})),document.querySelector("[data-add-project]").addEventListener("click",l),document.addEventListener("click",(e=>{e.target.classList.contains("edit-project")&&(e=>{if(i())return;const r=n().createForm(),c=n().createInputField("Project name..."),o=e.target.parentElement.previousElementSibling;c.value=o.textContent,o.remove(),r.append(c);const a=e.target.closest(".project-item");a.insertBefore(r,a.childNodes[0]);const s=document.querySelector("#user-input"),l=a.dataset.projectId;s.addEventListener("blur",(function(){""!=s.value&&d();const e=a.firstElementChild.textContent;t.onProjectEdit(l,e,"beans")})),r.addEventListener("submit",(function(e){e.preventDefault(),d();const n=a.firstElementChild.textContent;t.onProjectEdit(l,n,"beans")}))})(e)})),document.addEventListener("click",(t=>{t.target.classList.contains("task-item")&&t.target.parentElement.classList.toggle("completed"),t.target.classList.contains("add-task")&&((t=>{if(document.getElementById("user-input"))return;const r=n().createListElement("task"),c=n().createSpanElement("task-item"),o=n().createForm(),a=n().createInputField("Enter Task...");o.append(a),c.append(o);const s=n().createSpanElement("icons"),i=n().createImageElement("images/edit-icon.svg","edit-icon"),d=n().createImageElement("images/delete-icon.svg","delete-icon");i.addEventListener("click",(()=>{if(r.classList.contains("completed"))return;const e=document.querySelector(".task-text"),t=e.textContent;e.remove();const o=n().createForm(),a=n().createInputField("Enter Task...");a.value=t,o.append(a),c.insertBefore(o,s),r.prepend(c),m()})),d.addEventListener("click",(t=>{const n=t.target.closest("[data-project-id]").dataset.projectId,c=t.target.closest("[data-task-id]").dataset.taskId;r.remove(),e.deleteTask(n,c)})),s.append(i,d),c.append(s);const l=(()=>{const e=n().createSpanElement("due-date"),t=n().createImageElement("images/priority-icon.svg","priority-icon");t.classList.add("priority-low");const r=document.createElement("label");r.classList.add("date-label");const c=document.createElement("input");c.setAttribute("type","date"),c.required=!0;const o=n().createImageElement("images/calendar-icon.svg","calendar-icon");return r.append(c,o),e.append(t,r),e})();r.append(c,l);const p=t.closest(".todos"),u=p.childElementCount-2;p.insertBefore(r,p.children[u]),setTimeout((()=>{a.focus()}),0)})(t.target),m()),t.target.classList.contains("priority-icon")&&(e=>{if(e.parentElement.parentElement.classList.contains("completed"))return;const t=e.classList;t.contains("priority-low")?(t.remove("priority-low"),t.add("priority-medium")):t.contains("priority-medium")?(t.remove("priority-medium"),t.add("priority-high")):t.contains("priority-high")&&(t.remove("priority-high"),t.add("priority-low"))})(t.target)}))})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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M0R2QyxZQUFXLEtBQ1BTLEVBQVdSLFVBQ1osSUNWS3VDLENBQWFsQyxFQUFFSyxRQUNmSCxLQUVBRixFQUFFSyxPQUFPMUUsVUFBVTBDLFNBQVMsa0JEOEVqQixDQUFDOEQsSUFFcEIsR0FEMEJBLEVBQVlwRCxjQUFjQSxjQUFjcEQsVUFDNUMwQyxTQUFTLGFBQWMsT0FFN0MsTUFBTStELEVBQW9CRCxFQUFZeEcsVUFFbEN5RyxFQUFrQi9ELFNBQVMsaUJBQzNCK0QsRUFBa0I5RCxPQUFPLGdCQUN6QjhELEVBQWtCeEcsSUFBSSxvQkFHdEJ3RyxFQUFrQi9ELFNBQVMsb0JBQzNCK0QsRUFBa0I5RCxPQUFPLG1CQUN6QjhELEVBQWtCeEcsSUFBSSxrQkFHdEJ3RyxFQUFrQi9ELFNBQVMsbUJBQzNCK0QsRUFBa0I5RCxPQUFPLGlCQUN6QjhELEVBQWtCeEcsSUFBSSxrQkMvRmxCeUcsQ0FBZXJDLEVBQUVLLFkiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly90b2RvLWxpc3QvLi9zcmMvc3RvcmFnZS5qcyIsIndlYnBhY2s6Ly90b2RvLWxpc3QvLi9zcmMvaGFuZGxlcnMuanMiLCJ3ZWJwYWNrOi8vdG9kby1saXN0Ly4vc3JjL2NyZWF0ZURPTUVsZW1lbnRzLmpzIiwid2VicGFjazovL3RvZG8tbGlzdC8uL3NyYy9wcm9qZWN0cy5qcyIsIndlYnBhY2s6Ly90b2RvLWxpc3QvLi9zcmMvdGFza3MuanMiLCJ3ZWJwYWNrOi8vdG9kby1saXN0Ly4vc3JjL2luZGV4LmpzIl0sInNvdXJjZXNDb250ZW50IjpbImNvbnN0IHVwZGF0ZVN0b3JhZ2UgPSAoKSA9PiB7XG4gICAgXG4gICAgY29uc3QgZ2V0UHJvamVjdHMgPSAoKSA9PiB7XG4gICAgICAgIC8vIGNyZWF0ZXMgYW4gYXJyYXkgb2Ygb2JqZWN0cyBcbiAgICAgICAgY29uc3QgcHJvamVjdHMgPSBKU09OLnBhcnNlKGxvY2FsU3RvcmFnZS5nZXRJdGVtKCdwcm9qZWN0cycpIHx8ICdbXScpO1xuICAgICAgICByZXR1cm4gcHJvamVjdHM7XG4gICAgfVxuXG4gICAgY29uc3Qgc2F2ZVByb2plY3QgPSAocHJvamVjdFRvU2F2ZSkgPT4ge1xuICAgICAgICBjb25zdCBwcm9qZWN0cyA9IGdldFByb2plY3RzKCk7XG5cbiAgICAgICAgLy8gZmluZCBtZXRob2QgcmV0dXJucyB0aGUgZmlyc3Qgb2JqZWN0IHRoYXQgbWF0Y2hlcyB0aGUgaWRcbiAgICAgICAgY29uc3QgZXhpc3RpbmcgPSBwcm9qZWN0cy5maW5kKHByb2plY3QgPT4gcHJvamVjdC5pZCA9PSBwcm9qZWN0VG9TYXZlLmlkKTtcbiAgICAgICAgXG4gICAgICAgIGlmIChleGlzdGluZykge1xuICAgICAgICAgICAgZXhpc3RpbmcucHJvamVjdE5hbWUgPSBwcm9qZWN0VG9TYXZlLnByb2plY3ROYW1lO1xuICAgICAgICAgICAgZXhpc3RpbmcudGFza3MgPSBwcm9qZWN0VG9TYXZlLnRhc2tzO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgcHJvamVjdFRvU2F2ZS5pZCA9IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIDEwMDAwMDApO1xuICAgICAgICAgICAgLy8gQWRkIHByb2plY3ROYW1lXG4gICAgICAgICAgICAvLyBBZGQgVGFza3MgYXJyYXkgY29udGFpbmluZyBhbm90aGVyIGFycmF5IHdoaWNoIGluY2x1ZGVzIHRhc2ssIHByaW9yaXR5LCBkdWVEYXRlLCBhbmQgdHJ1ZS9mYWxzZSBmb3IgY29tcGxldGVkIG9yIG5vdFxuICAgICAgICAgICAgcHJvamVjdHMucHVzaChwcm9qZWN0VG9TYXZlKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKCdwcm9qZWN0cycsIEpTT04uc3RyaW5naWZ5KHByb2plY3RzKSk7XG4gICAgfVxuXG4gICBjb25zdCBkZWxldGVQcm9qZWN0ID0gKGlkKSA9PiB7XG4gICAgICAgIGNvbnN0IHByb2plY3RzID0gZ2V0UHJvamVjdHMoKTtcbiAgICAgICAgY29uc3QgdXBkYXRlZFByb2plY3RMaXN0ID0gcHJvamVjdHMuZmlsdGVyKHByb2plY3QgPT4gcHJvamVjdC5pZCAhPSBpZCk7XG5cbiAgICAgICAgbG9jYWxTdG9yYWdlLnNldEl0ZW0oJ3Byb2plY3RzJywgSlNPTi5zdHJpbmdpZnkodXBkYXRlZFByb2plY3RMaXN0KSk7XG4gICB9XG5cbiAgIGNvbnN0IGRlbGV0ZVRhc2sgPSAoaWQsIHRhc2tJZCkgPT4ge1xuICAgICAgICBjb25zdCBwcm9qZWN0cyA9IGdldFByb2plY3RzKCk7XG4gICAgICAgIGNvbnN0IHByb2plY3RXaXRoVGFzayA9IHByb2plY3RzLmZpbHRlcihwcm9qZWN0ID0+IHByb2plY3QuaWQgPT0gaWQpWzBdO1xuICAgICAgICBjb25zdCBhbGxUYXNrcyA9IHByb2plY3RXaXRoVGFzay50YXNrcztcbiAgICAgICAgLy8gRWFjaCB0YXNrIGlzIGFuIG9iamVjdFxuICAgICAgICBjb25zdCB1cGRhdGVkVGFza09iaiA9IGFsbFRhc2tzLmZpbHRlcih0YXNrT2JqID0+IHRhc2tPYmoudGFzay50YXNrSWQgIT0gdGFza0lkKTtcbiAgICAgICAgcHJvamVjdFdpdGhUYXNrLnRhc2tzID0gdXBkYXRlZFRhc2tPYmo7XG5cbiAgICAgICAgc2F2ZVByb2plY3QocHJvamVjdFdpdGhUYXNrKTtcbiAgIH1cblxuICAgIHJldHVybiB7IGdldFByb2plY3RzLCBzYXZlUHJvamVjdCwgZGVsZXRlUHJvamVjdCwgZGVsZXRlVGFzayB9XG59XG5cbmV4cG9ydCBkZWZhdWx0IHVwZGF0ZVN0b3JhZ2UoKTsiLCJpbXBvcnQgeyB1cGRhdGVQcm9qZWN0TGlzdCwgdXBkYXRlQWN0aXZlVGFiIH0gZnJvbSBcIi4vY3JlYXRlRE9NRWxlbWVudHNcIjtcbmltcG9ydCB1cGRhdGVTdG9yYWdlIGZyb20gXCIuL3N0b3JhZ2VcIjtcbmltcG9ydCB7Zm9ybWF0fSBmcm9tIFwiZGF0ZS1mbnNcIjtcblxuY29uc3QgaGFuZGxlcnMgPSAoKSA9PiB7XG4gICAgXG4gICAgY29uc3QgX3JlZnJlc2hQcm9qZWN0TGlzdCA9ICgpID0+IHtcbiAgICAgICAgY29uc3QgcHJvamVjdHMgPSB1cGRhdGVTdG9yYWdlLmdldFByb2plY3RzKCk7IC8vIFVwZGF0ZSBwcm9qZWN0cyBpbiBzdG9yYWdlICAgICAgICBcbiAgICAgICAgX3NldFByb2plY3RMaXN0KHByb2plY3RzKTsgLy8gVXBkYXRlIHByb2plY3RzIG9uIERPTVxuICAgIH1cblxuICAgIGNvbnN0IF9zZXRQcm9qZWN0TGlzdCA9IChwcm9qZWN0cykgPT4ge1xuICAgICAgICB1cGRhdGVQcm9qZWN0TGlzdChwcm9qZWN0cyk7XG4gICAgfVxuXG4gICAgY29uc3QgX3NldEFjdGl2ZVRhYiA9ICh0YWIpID0+IHtcbiAgICAgICAgdXBkYXRlQWN0aXZlVGFiKHRhYik7XG4gICAgfVxuXG4gICAgLy8gSGVyZSBiZSBoYW5kbGVyc1xuICAgIGNvbnN0IG9uUHJvamVjdFNlbGVjdCA9IChwcm9qZWN0SWQpID0+IHtcbiAgICAgICAgY29uc3QgcHJvamVjdHMgPSB1cGRhdGVTdG9yYWdlLmdldFByb2plY3RzKCk7XG4gICAgICAgIGNvbnN0IHByb2plY3RPYmplY3QgPSBwcm9qZWN0cy5maW5kKHByb2plY3QgPT4gcHJvamVjdC5pZCA9PSBwcm9qZWN0SWQpO1xuICAgICAgICBjb25zdCBzZWxlY3RlZFByb2plY3QgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGBbZGF0YS1wcm9qZWN0LWlkPScke3Byb2plY3RPYmplY3QuaWR9J11gKTtcbiAgICAgICAgX3NldEFjdGl2ZVRhYihzZWxlY3RlZFByb2plY3QpO1xuICAgIH1cblxuICAgIGNvbnN0IG9uUHJvamVjdEFkZCA9IChwcm9qZWN0TmFtZSkgPT4ge1xuICAgICAgICAvLyBwYXNzIHVzZXIgaW5wdXQgaW50byBmdW5jdGlvblxuICAgICAgICBjb25zdCBuZXdQcm9qZWN0ID0gIHtcbiAgICAgICAgICAgIHByb2plY3ROYW1lOiBwcm9qZWN0TmFtZSxcbiAgICAgICAgICAgIHRhc2tzOiBbXVxuICAgICAgICB9XG4gICAgICAgIHVwZGF0ZVN0b3JhZ2Uuc2F2ZVByb2plY3QobmV3UHJvamVjdCk7XG4gICAgICAgIC8vIGFkZCBpbnB1dCB0byBwYWdlXG4gICAgICAgIF9yZWZyZXNoUHJvamVjdExpc3QoKTtcbiAgICAgICAgY29uc3QgbmV3UHJvamVjdERPTUVsZW1lbnQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGBbZGF0YS1wcm9qZWN0LWlkPScke25ld1Byb2plY3QuaWR9J11gKTtcbiAgICAgICAgX3NldEFjdGl2ZVRhYihuZXdQcm9qZWN0RE9NRWxlbWVudCk7XG4gICAgfVxuICAgIC8vIEFkZCBvcHRpb25hbCBwYXJhbWV0ZXJzPyBwcmlvcml0eSA9ICdsb3cnLCBkdWVEYXRlID0gY3VycmVudERhdGUsIGlzQ29tcGxldGU9IGZhbHNlXG4gICAgY29uc3Qgb25UYXNrQWRkID0gKHRhc2ssIGlkKSA9PiB7XG4gICAgICAgIGNvbnN0IG5ld1Rhc2sgPSB7XG4gICAgICAgICAgICB0YXNrOiB7XG4gICAgICAgICAgICAgICAgaXRlbTogdGFzaywgXG4gICAgICAgICAgICAgICAgdGFza0lkOiBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAxMDAwMDAwKSxcbiAgICAgICAgICAgICAgICBwcmlvcml0eTogJ2xvdycsXG4gICAgICAgICAgICAgICAgZHVlRGF0ZTogbnVsbCxcbiAgICAgICAgICAgICAgICBpc0NvbXBsZXRlOiBmYWxzZVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGNvbnN0IHByb2plY3RzID0gdXBkYXRlU3RvcmFnZS5nZXRQcm9qZWN0cygpO1xuICAgICAgICBjb25zdCBwcm9qZWN0VG9VcGRhdGUgPSBwcm9qZWN0cy5maW5kKHByb2plY3QgPT4gcHJvamVjdC5pZCA9PSBpZCk7XG4gICAgICAgIHByb2plY3RUb1VwZGF0ZS50YXNrcy5wdXNoKG5ld1Rhc2spO1xuICAgICAgICB1cGRhdGVTdG9yYWdlLnNhdmVQcm9qZWN0KHByb2plY3RUb1VwZGF0ZSk7XG4gICAgICAgIC8vIFRPRE86IEFwcGVuZCBuZXdUYXNrIHRvIHRhc2tzIGFycmF5XG4gICAgICAgICAgICAgICAgLy8gMSkgR2V0IFByb2plY3RzOiBjb25zdCBwcm9qZWN0cyA9IHVwZGF0ZVN0b3JhZ2UuZ2V0UHJvamVjdHMoKTtcbiAgICAgICAgICAgICAgICAvLyAyKSBmaW5kIHByb2plY3QgbWF0Y2hpbmcgaWQ6IGNvbnN0IHByb2plY3RUb1VwZGF0ZSA9IHByb2plY3RzLmZpbmQocHJvamVjdCA9PiBwcm9qZWN0LmlkID09IGlkKVxuICAgICAgICAgICAgICAgIC8vIDMpIGdldCB0YXNrcyBhcnJheSBhbmQgYXBwZW5kIG5ld1Rhc2s6IHByb2plY3RUb1VwZGF0ZS50YXNrcy5wdXNoKG5ld1Rhc2spO1xuICAgICAgICAgICAgICAgIC8vIDQpIHNhdmVQcm9qZWN0IHRvIGxvY2FsU3RvcmFnZTogdXBkYXRlU3RvcmFnZS5zYXZlUHJvamVjdChwcm9qZWN0VG9VcGRhdGUpOyAqTWlnaHQgaGF2ZSB0byBlZGl0IHNhdmVQcm9qZWN0IGZ1bmN0aW9uIGluIHN0b3JhZ2UuanNcbiAgICAgICAgcmV0dXJuIG5ld1Rhc2s7XG4gICAgfVxuXG4gICAgLy8gVE9ETzogVGhpcyBkb2Vzbid0IHdvcmsuIE1ha2UgdGhpcyBvblByb2plY3ROYW1lRWRpdCBhbmQgaGF2ZSBzZXBhcmF0ZSBvblRhc2tFZGl0IGZ1bmN0aW9uP1xuICAgIGNvbnN0IG9uUHJvamVjdEVkaXQgPSAocHJvamVjdElkLCBwcm9qZWN0TmFtZSwgdGFza3MpID0+IHtcbiAgICAgICAgdXBkYXRlU3RvcmFnZS5zYXZlUHJvamVjdCh7XG4gICAgICAgICAgICBpZDogcHJvamVjdElkLFxuICAgICAgICAgICAgcHJvamVjdE5hbWU6IHByb2plY3ROYW1lLFxuICAgICAgICAgICAgdGFza3M6IHRhc2tzXG4gICAgICAgIH0pO1xuXG4gICAgICAgIF9yZWZyZXNoUHJvamVjdExpc3QoKTtcbiAgICB9XG5cbiAgICByZXR1cm4geyBvblByb2plY3RTZWxlY3QsIG9uUHJvamVjdEFkZCwgb25Qcm9qZWN0RWRpdCwgb25UYXNrQWRkIH1cbiAgICBcbn1cblxuZXhwb3J0IGRlZmF1bHQgaGFuZGxlcnMoKTsiLCJpbXBvcnQgaGFuZGxlcnMgZnJvbSBcIi4vaGFuZGxlcnNcIlxuXG4vLyBET00gRWxlbWVudHMgRmFjdG9yeSBGdW5jdGlvblxuY29uc3QgY3JlYXRlRWxlbWVudHMgPSAoKSA9PiB7XG4gICAgXG4gICAgY29uc3QgY3JlYXRlTGlzdEVsZW1lbnQgPSAoaHRtbENsYXNzKSA9PiB7XG4gICAgICAgIGNvbnN0IGxpID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnbGknKTtcbiAgICAgICAgbGkuc2V0QXR0cmlidXRlKCdjbGFzcycsIGh0bWxDbGFzcyk7XG4gICAgICAgIHJldHVybiBsaTtcbiAgICB9XG5cbiAgICBjb25zdCBjcmVhdGVTcGFuRWxlbWVudCA9IChodG1sQ2xhc3MpID0+IHtcbiAgICAgICAgY29uc3Qgc3BhbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3NwYW4nKTtcbiAgICAgICAgc3Bhbi5jbGFzc0xpc3QuYWRkKGh0bWxDbGFzcyk7XG4gICAgICAgIHJldHVybiBzcGFuO1xuICAgIH1cblxuICAgIGNvbnN0IGNyZWF0ZUltYWdlRWxlbWVudCA9IChzcmMsIGh0bWxDbGFzcykgPT4ge1xuICAgICAgICBjb25zdCBpbWcgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdpbWcnKTtcbiAgICAgICAgaW1nLmNsYXNzTGlzdC5hZGQoaHRtbENsYXNzKTtcbiAgICAgICAgaW1nLnNldEF0dHJpYnV0ZSgnc3JjJywgc3JjKTtcbiAgICAgICAgaW1nLnNldEF0dHJpYnV0ZSgnZHJhZ2dhYmxlJywgJ2ZhbHNlJyk7XG4gICAgICAgIHJldHVybiBpbWc7XG4gICAgfVxuICAgIFxuICAgIGNvbnN0IGNyZWF0ZUZvcm0gPSAoKSA9PiB7XG4gICAgICAgIGNvbnN0IGlucHV0Rm9ybSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2Zvcm0nKTtcbiAgICAgICAgcmV0dXJuIGlucHV0Rm9ybTtcbiAgICB9XG5cbiAgICBjb25zdCBjcmVhdGVJbnB1dEZpZWxkID0gKHBsYWNlaG9sZGVyVGV4dCkgPT4ge1xuICAgICAgICBjb25zdCB1c2VySW5wdXQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdpbnB1dCcpO1xuICAgICAgICB1c2VySW5wdXQuc2V0QXR0cmlidXRlKCd0eXBlJywgJ3RleHQnKTtcbiAgICAgICAgdXNlcklucHV0LnNldEF0dHJpYnV0ZSgncGxhY2Vob2xkZXInLCBwbGFjZWhvbGRlclRleHQpO1xuICAgICAgICB1c2VySW5wdXQuc2V0QXR0cmlidXRlKCdpZCcsICd1c2VyLWlucHV0Jyk7XG4gICAgICAgIHVzZXJJbnB1dC5yZXF1aXJlZCA9IHRydWU7XG5cbiAgICAgICAgcmV0dXJuIHVzZXJJbnB1dDtcbiAgICB9XG5cbiAgICBjb25zdCBjcmVhdGVEaXYgPSAoaHRtbENsYXNzKSA9PiB7XG4gICAgICAgIGNvbnN0IGRpdiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICAgICAgICBkaXYuc2V0QXR0cmlidXRlKCdjbGFzcycsIGh0bWxDbGFzcyk7XG4gICAgICAgIHJldHVybiBkaXY7XG4gICAgfVxuXG4gICAgcmV0dXJuIHtjcmVhdGVMaXN0RWxlbWVudCwgY3JlYXRlU3BhbkVsZW1lbnQsIGNyZWF0ZUltYWdlRWxlbWVudCwgY3JlYXRlSW5wdXRGaWVsZCwgY3JlYXRlRm9ybSwgY3JlYXRlRGl2fVxufVxuXG5jb25zdCBjcmVhdGVJY29uU3BhbiA9ICgpID0+IHtcbiAgICBjb25zdCB2aWV3ID0gY3JlYXRlRWxlbWVudHMoKTtcblxuICAgIGNvbnN0IGljb25TcGFuID0gdmlldy5jcmVhdGVTcGFuRWxlbWVudCgnaWNvbnMnKTtcbiAgICBjb25zdCBlZGl0SWNvbiA9IHZpZXcuY3JlYXRlSW1hZ2VFbGVtZW50KCdpbWFnZXMvZWRpdC1pY29uLnN2ZycsICdlZGl0LWljb24nKTtcbiAgICBjb25zdCBkZWxldGVJY29uID0gdmlldy5jcmVhdGVJbWFnZUVsZW1lbnQoJ2ltYWdlcy9kZWxldGUtaWNvbi5zdmcnLCAnZGVsZXRlLWljb24nKTtcbiAgICBcbiAgICBlZGl0SWNvbi5jbGFzc0xpc3QuYWRkKCdlZGl0LXByb2plY3QnKTtcbiAgICBkZWxldGVJY29uLmNsYXNzTGlzdC5hZGQoJ2RlbGV0ZS1wcm9qZWN0Jyk7XG4gICAgXG4gICAgaWNvblNwYW4uYXBwZW5kKGVkaXRJY29uLCBkZWxldGVJY29uKTtcbiAgICBcbiAgICByZXR1cm4gaWNvblNwYW47XG59XG5cbmNvbnN0IGFkZFByb2plY3RUb1NpZGViYXIgPSAoKSA9PiB7XG4gICAgY29uc3QgdmlldyA9IGNyZWF0ZUVsZW1lbnRzKCk7XG4gICAgY29uc3QgcHJvamVjdHNDb250YWluZXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcucHJvamVjdC1saXN0Jyk7XG5cbiAgICBjb25zdCBwcm9qZWN0TGlzdEVsZW1lbnQgPSAgdmlldy5jcmVhdGVMaXN0RWxlbWVudCgncHJvamVjdC1pdGVtJyk7XG4gICAgXG4gICAgY29uc3QgcHJvamVjdElucHV0Rm9ybSA9IHZpZXcuY3JlYXRlRm9ybSgpO1xuICAgIGNvbnN0IHByb2plY3ROYW1lSW5wdXQgPSB2aWV3LmNyZWF0ZUlucHV0RmllbGQoJ1Byb2plY3QgbmFtZS4uLicpO1xuICAgIHByb2plY3RJbnB1dEZvcm0uYXBwZW5kKHByb2plY3ROYW1lSW5wdXQpO1xuXG4gICAgY29uc3QgaWNvblNwYW4gPSBjcmVhdGVJY29uU3BhbigpO1xuICAgIHByb2plY3RMaXN0RWxlbWVudC5hcHBlbmQocHJvamVjdElucHV0Rm9ybSwgaWNvblNwYW4pO1xuICAgIHByb2plY3RzQ29udGFpbmVyLmluc2VydEJlZm9yZShwcm9qZWN0TGlzdEVsZW1lbnQsIHByb2plY3RzQ29udGFpbmVyLmxhc3RFbGVtZW50Q2hpbGQpO1xuXG4gICAgc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICAgIHByb2plY3ROYW1lSW5wdXQuZm9jdXMoKTtcbiAgICB9LCAwKTtcbn1cblxuY29uc3QgYWRkUHJvamVjdFRvTm90ZXBhZCA9IChwcm9qZWN0SWQpID0+IHtcbiAgICBjb25zdCB2aWV3ID0gY3JlYXRlRWxlbWVudHMoKTtcbiAgICBjb25zdCBwcm9qZWN0TGlzdCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5wcm9qZWN0LWxpc3QnKTtcbiAgICBjb25zdCBjdXJyZW50UHJvamVjdE51bWJlciA9IHByb2plY3RMaXN0LmNoaWxkRWxlbWVudENvdW50IC0gMjtcbiAgICBjb25zdCBwcm9qZWN0TmFtZSA9IHByb2plY3RMaXN0LmNoaWxkcmVuW2N1cnJlbnRQcm9qZWN0TnVtYmVyXS50ZXh0Q29udGVudDtcblxuICAgIGNvbnN0IG5vdGVwYWQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcjd3JpdGluZy1hcmVhJyk7XG4gICAgY29uc3QgcHJvamVjdERpdiA9IHZpZXcuY3JlYXRlRGl2KCdwcm9qZWN0Jyk7XG4gICAgcHJvamVjdERpdi5zZXRBdHRyaWJ1dGUoJ2RhdGEtcHJvamVjdC1pZCcsIHByb2plY3RJZCk7XG4gICAgY29uc3Qgc2tpcExpbmUgPSB2aWV3LmNyZWF0ZURpdignc2tpcC1saW5lJyk7XG4gICAgXG4gICAgY29uc3QgcHJvamVjdEhlYWRpbmcgPSB2aWV3LmNyZWF0ZURpdigncHJvamVjdC1oZWFkaW5nJyk7XG4gICAgY29uc3QgaDIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdoMicpO1xuICAgIGgyLnNldEF0dHJpYnV0ZSgnY2xhc3MnLCAnbm90ZXBhZC10ZXh0Jyk7XG4gICAgaDIudGV4dENvbnRlbnQgPSBwcm9qZWN0TmFtZTtcbiAgICBjb25zdCBoMyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2gzJyk7XG4gICAgaDMuc2V0QXR0cmlidXRlKCdjbGFzcycsICdub3RlcGFkLXRleHQnKTtcbiAgICBoMy50ZXh0Q29udGVudCA9ICdEdWUgRGF0ZSc7XG4gICAgICAgIFxuICAgIGNvbnN0IHRhc2tzQ29udGFpbmVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgndWwnKTtcbiAgICB0YXNrc0NvbnRhaW5lci5jbGFzc0xpc3QuYWRkKCdub3RlcGFkLXRleHQnLCAndG9kb3MnKTtcblxuICAgIGNvbnN0IGFkZFRhc2tMaXN0RWxlbWVudCA9IHZpZXcuY3JlYXRlTGlzdEVsZW1lbnQoJ3Rhc2snKTtcbiAgICBjb25zdCBhZGRUYXNrU3BhbiA9IHZpZXcuY3JlYXRlU3BhbkVsZW1lbnQoJ2FkZC10YXNrJyk7XG4gICAgY29uc3QgYWRkSWNvbiA9IHZpZXcuY3JlYXRlSW1hZ2VFbGVtZW50KCdpbWFnZXMvYWRkLWljb24uc3ZnJywgJ2FkZC1pY29uJyk7XG4gICAgYWRkVGFza1NwYW4uYXBwZW5kKGFkZEljb24sICdBZGQgVGFzaycpO1xuXG4gICAgYWRkVGFza0xpc3RFbGVtZW50LmFwcGVuZChhZGRUYXNrU3Bhbik7XG4gICAgdGFza3NDb250YWluZXIuYXBwZW5kKGFkZFRhc2tMaXN0RWxlbWVudCwgc2tpcExpbmUpO1xuICAgIHByb2plY3RIZWFkaW5nLmFwcGVuZChoMiwgaDMpO1xuICAgIHByb2plY3REaXYuYXBwZW5kKHByb2plY3RIZWFkaW5nLCB0YXNrc0NvbnRhaW5lcik7XG4gICAgbm90ZXBhZC5hcHBlbmQocHJvamVjdERpdik7XG59XG5cbmNvbnN0IF9jcmVhdGVQcm9qZWN0SXRlbUhUTUwgPSAoaWQsIG5hbWUpID0+IHtcbiAgICAvLyBjcmVhdGVzIEhUTUwgZm9yIHByb2plY3QgaXRlbXMgaW4gc2lkZWJhciBmcm9tIGxvY2FsU3RvcmFnZSBpdGVtXG4gICAgY29uc3QgdmlldyA9IGNyZWF0ZUVsZW1lbnRzKCk7XG5cbiAgICBjb25zdCBwcm9qZWN0SXRlbSA9IHZpZXcuY3JlYXRlTGlzdEVsZW1lbnQoJ3Byb2plY3QtaXRlbScpO1xuICAgIHByb2plY3RJdGVtLnNldEF0dHJpYnV0ZSgnZGF0YS1wcm9qZWN0LWlkJywgaWQpO1xuICAgIGNvbnN0IHByb2plY3ROYW1lID0gdmlldy5jcmVhdGVTcGFuRWxlbWVudCgncHJvamVjdC1uYW1lJyk7XG4gICAgcHJvamVjdE5hbWUudGV4dENvbnRlbnQgPSBuYW1lO1xuICAgIGNvbnN0IGljb25TcGFuID0gY3JlYXRlSWNvblNwYW4oKTtcblxuICAgIHByb2plY3RJdGVtLmFwcGVuZChwcm9qZWN0TmFtZSwgaWNvblNwYW4pO1xuXG4gICAgcmV0dXJuIHByb2plY3RJdGVtO1xufVxuXG5jb25zdCB1cGRhdGVQcm9qZWN0TGlzdCA9IChwcm9qZWN0cykgPT4ge1xuICAgIGNvbnN0IHByb2plY3RzTGlzdENvbnRhaW5lciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5wcm9qZWN0LWxpc3QnKTtcbiAgICBjb25zdCBhZGRQcm9qZWN0QnRuID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignW2RhdGEtYWRkLXByb2plY3RdJyk7XG4gICAgXG4gICAgLy8gQ2xlYXIgYWxsIGVsZW1lbnRzIG9mIGNsYXNzICcucHJvamVjdC1pdGVtJ1xuICAgIGNvbnN0IHByb2plY3RzQXJyYXkgPSBbXS5zbGljZS5jYWxsKHByb2plY3RzTGlzdENvbnRhaW5lci5jaGlsZHJlbik7XG4gICAgcHJvamVjdHNBcnJheS5mb3JFYWNoKGl0ZW0gPT4ge1xuICAgICAgICBpZiAoaXRlbS5jbGFzc0xpc3QuY29udGFpbnMoJ3Byb2plY3QtaXRlbScpKSBpdGVtLnJlbW92ZSgpO1xuICAgIH0pO1xuXG4gICAgZm9yIChjb25zdCBwcm9qZWN0IG9mIHByb2plY3RzKSB7XG4gICAgICAgIGNvbnN0IGh0bWwgPSBfY3JlYXRlUHJvamVjdEl0ZW1IVE1MKHByb2plY3QuaWQsIHByb2plY3QucHJvamVjdE5hbWUpO1xuICAgICAgICBwcm9qZWN0c0xpc3RDb250YWluZXIuaW5zZXJ0QmVmb3JlKGh0bWwsIGFkZFByb2plY3RCdG4pO1xuICAgIH1cblxuICAgIC8vIEFkZCBsaXN0ZW5lcnMgZm9yIGVkaXQsIGRlbGV0ZSA/Pz8/XG4gICAgcHJvamVjdHNMaXN0Q29udGFpbmVyLnF1ZXJ5U2VsZWN0b3JBbGwoJy5wcm9qZWN0LWl0ZW0nKS5mb3JFYWNoKHByb2plY3RJdGVtID0+IHtcbiAgICAgICAgcHJvamVjdEl0ZW0uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB7XG4gICAgICAgICAgICBoYW5kbGVycy5vblByb2plY3RTZWxlY3QocHJvamVjdEl0ZW0uZGF0YXNldC5wcm9qZWN0SWQpO1xuICAgICAgICB9KTtcbiAgICB9KTtcbn1cblxuY29uc3QgdXBkYXRlQWN0aXZlVGFiID0gKHRhYikgPT4ge1xuICAgIC8vIGZvciBhbGwgb3RoZXIgcHJvamVjdHMsIGNoYW5nZSBkaXNwbGF5IHRvIG5vbmUsIHRvIGJyaW5nIGJhY2sgc2V0IGRpc3BsYXkgdG8gY29udGVudHMgIFxuICAgICAgICAvLyBpdGVtLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSdcbiAgICAvLyByZW1vdmUgYWN0aXZlIGNsYXNzIGZyb20gYW55IG90aGVyIHNpZGViYXIgZWxlbWVudFxuICAgIGNvbnN0IGN1cnJlbnRBY3RpdmVUYWIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuYWN0aXZlJyk7XG4gICAgaWYgKGN1cnJlbnRBY3RpdmVUYWIpIGN1cnJlbnRBY3RpdmVUYWIuY2xhc3NMaXN0LnJlbW92ZSgnYWN0aXZlJyk7XG4gICAgdGFiLmNsYXNzTGlzdC5hZGQoJ2FjdGl2ZScpO1xuICAgIGNvbnN0IHByb2plY3ROYW1lU3BhbiA9IHRhYi5jaGlsZHJlbi5pdGVtKDApOyAvLyBVcGRhdGUgbm90ZXBhZCBoZXJlP1xuICAgIC8vY29uc29sZS5sb2cocHJvamVjdE5hbWVTcGFuKTtcbn1cblxuZXhwb3J0IHsgYWRkUHJvamVjdFRvU2lkZWJhciwgYWRkUHJvamVjdFRvTm90ZXBhZCwgY3JlYXRlRWxlbWVudHMsIHVwZGF0ZVByb2plY3RMaXN0LCB1cGRhdGVBY3RpdmVUYWJ9OyIsImltcG9ydCB7IGFkZFByb2plY3RUb1NpZGViYXIsIGFkZFByb2plY3RUb05vdGVwYWQsIGNyZWF0ZUVsZW1lbnRzIH0gZnJvbSBcIi4vY3JlYXRlRE9NRWxlbWVudHNcIjtcbmltcG9ydCBoYW5kbGVycyBmcm9tIFwiLi9oYW5kbGVyc1wiO1xuaW1wb3J0IHVwZGF0ZVN0b3JhZ2UgZnJvbSBcIi4vc3RvcmFnZVwiXG5cbmNvbnN0IGF3YWl0aW5nSW5wdXQgPSAoKSA9PiB7XG4gICAgY29uc3QgdXNlcklucHV0ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignI3VzZXItaW5wdXQnKTtcbiAgICBpZiAodXNlcklucHV0ICE9IG51bGwpIHJldHVybiB0cnVlO1xuXG4gICAgcmV0dXJuIGZhbHNlO1xufVxuXG5jb25zdCBoYW5kbGVVc2VySW5wdXQgPSAoKSA9PiB7IFxuICAgIC8vIFRoaXMgaXMgRE9NIFN0dWZmXG4gICAgY29uc3QgdXNlcklucHV0ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignI3VzZXItaW5wdXQnKVxuICAgIGNvbnN0IGlucHV0Rm9ybSA9IHVzZXJJbnB1dC5wYXJlbnRFbGVtZW50O1xuICAgIGNvbnN0IHByb2plY3RJdGVtID0gaW5wdXRGb3JtLnBhcmVudEVsZW1lbnQ7XG4gICAgY29uc3QgcHJvamVjdFNwYW4gPSBjcmVhdGVFbGVtZW50cygpLmNyZWF0ZVNwYW5FbGVtZW50KCdwcm9qZWN0LW5hbWUnKTtcbiAgICBcbiAgICBjb25zdCBwcm9qZWN0TmFtZSA9IHVzZXJJbnB1dC52YWx1ZS50cmltKCk7XG4gICAgaWYgKCFwcm9qZWN0TmFtZSkgcmV0dXJuO1xuXG4gICAgcHJvamVjdFNwYW4udGV4dENvbnRlbnQgPSBwcm9qZWN0TmFtZTtcbiAgICB1c2VySW5wdXQucGFyZW50RWxlbWVudC5yZW1vdmUoKTtcbiAgICBwcm9qZWN0SXRlbS5pbnNlcnRCZWZvcmUocHJvamVjdFNwYW4sIHByb2plY3RJdGVtLmNoaWxkTm9kZXNbMF0pOyBcbn1cblxuY29uc3QgYWRkUHJvamVjdCA9ICgpID0+IHtcbiAgICBpZiAoYXdhaXRpbmdJbnB1dCgpKSByZXR1cm47XG4gICAgYWRkUHJvamVjdFRvU2lkZWJhcigpO1xuICAgIFxuICAgIGNvbnN0IHVzZXJJbnB1dCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJyN1c2VyLWlucHV0Jyk7XG4gICAgY29uc3QgaW5wdXRGb3JtID0gdXNlcklucHV0LnBhcmVudEVsZW1lbnQ7XG4gICAgY29uc3QgcHJvamVjdEl0ZW0gPSBpbnB1dEZvcm0ucGFyZW50RWxlbWVudDtcblxuICAgIHVzZXJJbnB1dC5hZGRFdmVudExpc3RlbmVyKCdibHVyJywgZnVuY3Rpb24gKCkge1xuICAgICAgICBpZiAodXNlcklucHV0LnZhbHVlLnRyaW0oKSA9PSAnJykge1xuICAgICAgICAgICAgcHJvamVjdEl0ZW0ucmVtb3ZlKCk7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgaGFuZGxlVXNlcklucHV0KCk7XG5cbiAgICAgICAgY29uc3QgcHJvamVjdE5hbWUgPSBwcm9qZWN0SXRlbS5maXJzdEVsZW1lbnRDaGlsZC50ZXh0Q29udGVudDtcbiAgICAgICAgaGFuZGxlcnMub25Qcm9qZWN0QWRkKHByb2plY3ROYW1lKTsgXG5cbiAgICAgICAgY29uc3QgcHJvamVjdExpc3QgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcucHJvamVjdC1saXN0Jyk7XG4gICAgICAgIC8vIFNlbGVjdCBsYXN0IHByb2plY3QgYWRkZWQgYW5kIGdldCBpZCBhdHRyaWJ1dGVcbiAgICAgICAgY29uc3QgcHJvamVjdElkID0gcHJvamVjdExpc3QuY2hpbGRyZW5bcHJvamVjdExpc3QuY2hpbGRFbGVtZW50Q291bnQgLSAyXS5nZXRBdHRyaWJ1dGUoJ2RhdGEtcHJvamVjdC1pZCcpO1xuICAgICAgICBpZiAoIWF3YWl0aW5nSW5wdXQoKSkgYWRkUHJvamVjdFRvTm90ZXBhZChwcm9qZWN0SWQpO1xuICAgIH0pO1xuXG4gICAgaW5wdXRGb3JtLmFkZEV2ZW50TGlzdGVuZXIoJ3N1Ym1pdCcsIGZ1bmN0aW9uIChlKSB7XG4gICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgaGFuZGxlVXNlcklucHV0KCk7XG4gICAgICAgIGNvbnN0IHByb2plY3ROYW1lID0gcHJvamVjdEl0ZW0uZmlyc3RFbGVtZW50Q2hpbGQudGV4dENvbnRlbnQ7XG4gICAgICAgIGhhbmRsZXJzLm9uUHJvamVjdEFkZChwcm9qZWN0TmFtZSk7IFxuICAgICAgICBjb25zdCBwcm9qZWN0TGlzdCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5wcm9qZWN0LWxpc3QnKTtcbiAgICAgICAgY29uc3QgcHJvamVjdElkID0gcHJvamVjdExpc3QuY2hpbGRyZW5bcHJvamVjdExpc3QuY2hpbGRFbGVtZW50Q291bnQgLSAyXS5nZXRBdHRyaWJ1dGUoJ2RhdGEtcHJvamVjdC1pZCcpO1xuICAgICAgICBpZiAoIWF3YWl0aW5nSW5wdXQoKSkgYWRkUHJvamVjdFRvTm90ZXBhZChwcm9qZWN0SWQpO1xuICAgIH0pO1xufVxuY29uc3QgZGVsZXRlUHJvamVjdCA9ICgpID0+IHtcbiAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIChlKSA9PiB7XG4gICAgICAgIGlmIChlLnRhcmdldC5jbG9zZXN0KCcuZGVsZXRlLXByb2plY3QnKSkge1xuICAgICAgICAgICAgY29uc3QgcHJvamVjdEl0ZW0gPSBlLnRhcmdldC5jbG9zZXN0KCcucHJvamVjdC1pdGVtJylcbiAgICAgICAgICAgIHByb2plY3RJdGVtLnJlbW92ZSgpO1xuICAgICAgICAgICAgY29uc3QgcHJvamVjdElkID0gcHJvamVjdEl0ZW0uZGF0YXNldC5wcm9qZWN0SWQ7XG4gICAgICAgICAgICB1cGRhdGVTdG9yYWdlLmRlbGV0ZVByb2plY3QocHJvamVjdElkKTtcbiAgICAgICAgfVxuICAgIH0pO1xuICAgIC8vIFRPRE86IFJlbW92ZSBwcm9qZWN0IGZyb20gbm90ZXBhZCBieSByZWxvYWRpbmcgbG9jYWxTdG9yYWdlIGl0ZW1zIGZvciBjdXJyZW50IHNlbGVjdGVkIHRhYiAoaS5lLiBUb2RheSkuIElmIGN1cnJlbnQgc2VsZWN0IHRhYiBpcyB0aGUgb25lIHRoYXQgaXMgZGVsZXRlZCBsb2FkIG5vdGVwYWQgd2l0aCBIb21lIHRhYiBcbn1cblxuLy8gVE9ETzogY3JlYXRlIGZ1bmN0aW9uIHRvIHVwZGF0ZSBwcm9qZWN0IG5hbWUgb24gbm90ZXBhZCB3aGVuIHVzZXIgZWRpdHMgaXRcbiBcbmNvbnN0IGVkaXRQcm9qZWN0ID0gKGUpID0+IHtcbiAgICBpZiAoYXdhaXRpbmdJbnB1dCgpKSByZXR1cm47XG4gICAgXG4gICAgLy8gVGhpcyBpcyBET00gU3R1ZmZcbiAgICBjb25zdCBpbnB1dEZvcm0gPSBjcmVhdGVFbGVtZW50cygpLmNyZWF0ZUZvcm0oKTtcbiAgICBjb25zdCBpbnB1dEZpZWxkID0gY3JlYXRlRWxlbWVudHMoKS5jcmVhdGVJbnB1dEZpZWxkKCdQcm9qZWN0IG5hbWUuLi4nKTtcbiAgICBjb25zdCBwcm9qZWN0TmFtZSA9IGUudGFyZ2V0LnBhcmVudEVsZW1lbnQucHJldmlvdXNFbGVtZW50U2libGluZztcblxuICAgIGlucHV0RmllbGQudmFsdWUgPSBwcm9qZWN0TmFtZS50ZXh0Q29udGVudDtcbiAgICBwcm9qZWN0TmFtZS5yZW1vdmUoKTtcbiAgICBpbnB1dEZvcm0uYXBwZW5kKGlucHV0RmllbGQpO1xuXG4gICAgY29uc3QgcHJvamVjdEl0ZW0gPSBlLnRhcmdldC5jbG9zZXN0KCcucHJvamVjdC1pdGVtJyk7XG4gICAgcHJvamVjdEl0ZW0uaW5zZXJ0QmVmb3JlKGlucHV0Rm9ybSwgcHJvamVjdEl0ZW0uY2hpbGROb2Rlc1swXSk7XG5cbiAgICBjb25zdCB1c2VySW5wdXQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcjdXNlci1pbnB1dCcpO1xuICAgIFxuICAgIGNvbnN0IHByb2plY3RJZCA9IHByb2plY3RJdGVtLmRhdGFzZXQucHJvamVjdElkO1xuXG4gICAgdXNlcklucHV0LmFkZEV2ZW50TGlzdGVuZXIoJ2JsdXInLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGlmICh1c2VySW5wdXQudmFsdWUgIT0gJycpIGhhbmRsZVVzZXJJbnB1dCgpO1xuICAgICAgICAvL2lmICghYXdhaXRpbmdJbnB1dCgpKSBlZGl0UHJvamVjdE9uTm90ZXBhZCgpO1xuICAgICAgICBjb25zdCBwcm9qZWN0TmFtZSA9IHByb2plY3RJdGVtLmZpcnN0RWxlbWVudENoaWxkLnRleHRDb250ZW50O1xuICAgICAgICBoYW5kbGVycy5vblByb2plY3RFZGl0KHByb2plY3RJZCwgcHJvamVjdE5hbWUsICdiZWFucycpOyAvLyBUT0RPOiBGaWd1cmUgb3V0IGhvdyB0byBzdG9yZSB0YXNrIGRhdGEsIHRoaXMgZG9lc24ndCB3b3JrXG4gICAgfSk7XG5cbiAgICBpbnB1dEZvcm0uYWRkRXZlbnRMaXN0ZW5lcignc3VibWl0JywgZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICBoYW5kbGVVc2VySW5wdXQoKTtcbiAgICAgICAgLy9pZiAoIWF3YWl0aW5nSW5wdXQoKSkgZWRpdFByb2plY3RPbk5vdGVwYWQoKTtcbiAgICAgICAgY29uc3QgcHJvamVjdE5hbWUgPSBwcm9qZWN0SXRlbS5maXJzdEVsZW1lbnRDaGlsZC50ZXh0Q29udGVudDtcbiAgICAgICAgaGFuZGxlcnMub25Qcm9qZWN0RWRpdChwcm9qZWN0SWQsIHByb2plY3ROYW1lLCAnYmVhbnMnKTsgLy8gVE9ETzogRmlndXJlIG91dCBob3cgdG8gc3RvcmUgdGFzayBkYXRhLCB0aGlzIGRvZXNuJ3Qgd29ya1xuICAgIH0pO1xufVxuXG5leHBvcnQgeyBcbiAgICBhZGRQcm9qZWN0LFxuICAgIGRlbGV0ZVByb2plY3QsXG4gICAgZWRpdFByb2plY3Rcbn0iLCJpbXBvcnQge2NyZWF0ZUVsZW1lbnRzfSBmcm9tIFwiLi9jcmVhdGVET01FbGVtZW50c1wiO1xuaW1wb3J0IHtmb3JtYXR9IGZyb20gXCJkYXRlLWZuc1wiO1xuaW1wb3J0IGhhbmRsZXJzIGZyb20gXCIuL2hhbmRsZXJzXCI7XG5pbXBvcnQgdXBkYXRlU3RvcmFnZSBmcm9tIFwiLi9zdG9yYWdlXCI7XG5cbmNvbnN0IHRvZ2dsZVRhc2sgPSAodGFza0VsZW1lbnQpID0+IHtcbiAgICB0YXNrRWxlbWVudC5jbGFzc0xpc3QudG9nZ2xlKCdjb21wbGV0ZWQnKTtcbn1cblxuY29uc3QgYWRkVGFza1RvRE9NID0gKGFkZFRhc2tCdG4pID0+IHtcbiAgICBpZiAoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3VzZXItaW5wdXQnKSkgcmV0dXJuO1xuICAgIGNvbnN0IHRhc2tMaXN0RWxlbWVudCA9IGNyZWF0ZUVsZW1lbnRzKCkuY3JlYXRlTGlzdEVsZW1lbnQoJ3Rhc2snKTtcbiAgICBjb25zdCB0YXNrU3BhbiA9IGNyZWF0ZUVsZW1lbnRzKCkuY3JlYXRlU3BhbkVsZW1lbnQoJ3Rhc2staXRlbScpO1xuICAgIGNvbnN0IGlucHV0Rm9ybSA9IGNyZWF0ZUVsZW1lbnRzKCkuY3JlYXRlRm9ybSgpO1xuICAgIGNvbnN0IGlucHV0RmllbGQgPSBjcmVhdGVFbGVtZW50cygpLmNyZWF0ZUlucHV0RmllbGQoJ0VudGVyIFRhc2suLi4nKTtcbiAgICBcbiAgICBpbnB1dEZvcm0uYXBwZW5kKGlucHV0RmllbGQpO1xuICAgIHRhc2tTcGFuLmFwcGVuZChpbnB1dEZvcm0pO1xuXG4gICAgY29uc3QgaWNvblNwYW4gPSBjcmVhdGVFbGVtZW50cygpLmNyZWF0ZVNwYW5FbGVtZW50KCdpY29ucycpO1xuICAgIGNvbnN0IGVkaXRJY29uID0gY3JlYXRlRWxlbWVudHMoKS5jcmVhdGVJbWFnZUVsZW1lbnQoJ2ltYWdlcy9lZGl0LWljb24uc3ZnJywgJ2VkaXQtaWNvbicpO1xuICAgIGNvbnN0IGRlbGV0ZUljb24gPSBjcmVhdGVFbGVtZW50cygpLmNyZWF0ZUltYWdlRWxlbWVudCgnaW1hZ2VzL2RlbGV0ZS1pY29uLnN2ZycsICdkZWxldGUtaWNvbicpO1xuXG4gICAgZWRpdEljb24uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB7XG4gICAgICAgIGlmICh0YXNrTGlzdEVsZW1lbnQuY2xhc3NMaXN0LmNvbnRhaW5zKCdjb21wbGV0ZWQnKSkgcmV0dXJuO1xuICAgICAgICBjb25zdCB0YXNrVGV4dFNwYW4gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcudGFzay10ZXh0Jyk7XG4gICAgICAgIGNvbnN0IHRhc2sgPSB0YXNrVGV4dFNwYW4udGV4dENvbnRlbnQ7XG4gICAgICAgIHRhc2tUZXh0U3Bhbi5yZW1vdmUoKTtcbiAgICAgICAgXG4gICAgICAgIGNvbnN0IGlucHV0Rm9ybSA9IGNyZWF0ZUVsZW1lbnRzKCkuY3JlYXRlRm9ybSgpO1xuICAgICAgICBjb25zdCBpbnB1dEZpZWxkID0gY3JlYXRlRWxlbWVudHMoKS5jcmVhdGVJbnB1dEZpZWxkKCdFbnRlciBUYXNrLi4uJyk7XG5cbiAgICAgICAgaW5wdXRGaWVsZC52YWx1ZSA9IHRhc2s7XG4gICAgICAgIFxuICAgICAgICBpbnB1dEZvcm0uYXBwZW5kKGlucHV0RmllbGQpO1xuICAgICAgICB0YXNrU3Bhbi5pbnNlcnRCZWZvcmUoaW5wdXRGb3JtLCBpY29uU3Bhbik7XG4gICAgICAgIHRhc2tMaXN0RWxlbWVudC5wcmVwZW5kKHRhc2tTcGFuKTtcbiAgICAgICAgYWRkVGFzaygpO1xuICAgICAgICAvLyBUT0RPOiBVcGRhdGUgdGFzayBpbiBsb2NhbCBzdG9yYWdlXG4gICAgfSk7XG5cbiAgICBkZWxldGVJY29uLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKGUpID0+IHtcbiAgICAgICAgY29uc3QgcHJvamVjdElkID0gZS50YXJnZXQuY2xvc2VzdCgnW2RhdGEtcHJvamVjdC1pZF0nKS5kYXRhc2V0LnByb2plY3RJZDtcbiAgICAgICAgY29uc3QgdGFza0lkID0gZS50YXJnZXQuY2xvc2VzdCgnW2RhdGEtdGFzay1pZF0nKS5kYXRhc2V0LnRhc2tJZDtcblxuICAgICAgICB0YXNrTGlzdEVsZW1lbnQucmVtb3ZlKCk7XG4gICAgICAgIHVwZGF0ZVN0b3JhZ2UuZGVsZXRlVGFzayhwcm9qZWN0SWQsIHRhc2tJZCk7XG4gICAgfSk7XG5cbiAgICBpY29uU3Bhbi5hcHBlbmQoZWRpdEljb24sIGRlbGV0ZUljb24pO1xuICAgIHRhc2tTcGFuLmFwcGVuZChpY29uU3Bhbik7XG4gICAgY29uc3QgZHVlRGF0ZSA9IGFkZER1ZURhdGVUb0RPTSgpO1xuICAgIHRhc2tMaXN0RWxlbWVudC5hcHBlbmQodGFza1NwYW4sIGR1ZURhdGUpO1xuICAgIFxuICAgIGNvbnN0IGNvbnRhaW5lciA9IGFkZFRhc2tCdG4uY2xvc2VzdCgnLnRvZG9zJyk7XG4gICAgY29uc3QgbnVtYmVyT2ZUYXNrcyA9IGNvbnRhaW5lci5jaGlsZEVsZW1lbnRDb3VudCAtIDI7XG5cbiAgICBjb250YWluZXIuaW5zZXJ0QmVmb3JlKHRhc2tMaXN0RWxlbWVudCwgY29udGFpbmVyLmNoaWxkcmVuW251bWJlck9mVGFza3NdKTtcblxuICAgIHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgICBpbnB1dEZpZWxkLmZvY3VzKCk7XG4gICAgfSwgMCk7XG5cbiAgICByZXR1cm4gdGFza1NwYW47XG59XG5cbmNvbnN0IGFkZER1ZURhdGVUb0RPTSA9ICgpID0+IHtcbiAgICBjb25zdCBkdWVEYXRlU3BhbiA9IGNyZWF0ZUVsZW1lbnRzKCkuY3JlYXRlU3BhbkVsZW1lbnQoJ2R1ZS1kYXRlJyk7XG5cbiAgICBjb25zdCBwcmlvcml0eUljb24gPSBjcmVhdGVFbGVtZW50cygpLmNyZWF0ZUltYWdlRWxlbWVudCgnaW1hZ2VzL3ByaW9yaXR5LWljb24uc3ZnJywgJ3ByaW9yaXR5LWljb24nKVxuICAgIHByaW9yaXR5SWNvbi5jbGFzc0xpc3QuYWRkKCdwcmlvcml0eS1sb3cnKTtcbiAgICBcbiAgICBjb25zdCBkYXRlTGFiZWwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdsYWJlbCcpO1xuICAgIGRhdGVMYWJlbC5jbGFzc0xpc3QuYWRkKCdkYXRlLWxhYmVsJyk7XG4gICAgXG4gICAgY29uc3QgZGF0ZUlucHV0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnaW5wdXQnKTtcbiAgICBkYXRlSW5wdXQuc2V0QXR0cmlidXRlKCd0eXBlJywgJ2RhdGUnKTtcbiAgICBkYXRlSW5wdXQucmVxdWlyZWQgPSB0cnVlO1xuXG4gICAgY29uc3QgY2FsZW5kYXJJY29uID0gY3JlYXRlRWxlbWVudHMoKS5jcmVhdGVJbWFnZUVsZW1lbnQoJ2ltYWdlcy9jYWxlbmRhci1pY29uLnN2ZycsICdjYWxlbmRhci1pY29uJyk7XG5cbiAgICBkYXRlTGFiZWwuYXBwZW5kKGRhdGVJbnB1dCwgY2FsZW5kYXJJY29uKTtcbiAgICBkdWVEYXRlU3Bhbi5hcHBlbmQocHJpb3JpdHlJY29uLCBkYXRlTGFiZWwpO1xuXG4gICAgcmV0dXJuIGR1ZURhdGVTcGFuO1xufVxuXG5jb25zdCBhZGRUYXNrID0gKCkgPT4ge1xuICAgIGNvbnN0IGlucHV0RmllbGQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcjdXNlci1pbnB1dCcpO1xuICAgIGNvbnN0IGlucHV0Rm9ybSA9IGlucHV0RmllbGQucGFyZW50RWxlbWVudDtcbiAgICBjb25zdCB0YXNrQ29udGFpbmVyID0gaW5wdXRGb3JtLnBhcmVudEVsZW1lbnQucGFyZW50RWxlbWVudDtcblxuICAgIGlucHV0RmllbGQuYWRkRXZlbnRMaXN0ZW5lcignYmx1cicsIGZ1bmN0aW9uIChlKSB7XG4gICAgICAgIGNvbnN0IHByb2plY3RJZCA9IGUudGFyZ2V0LmNsb3Nlc3QoJ1tkYXRhLXByb2plY3QtaWRdJykuZGF0YXNldC5wcm9qZWN0SWQ7XG4gICAgICAgIGNvbnN0IHRhc2sgPSBpbnB1dEZpZWxkLnZhbHVlO1xuICAgICAgICB2YWxpZGF0ZVVzZXJJbnB1dCgpO1xuICAgICAgICBpZiAodGFzaykgY3JlYXRlVGFzayh0YXNrLCBwcm9qZWN0SWQsIHRhc2tDb250YWluZXIpO1xuICAgIH0pO1xuICAgIFxuICAgIGlucHV0Rm9ybS5hZGRFdmVudExpc3RlbmVyKCdzdWJtaXQnLCBmdW5jdGlvbiAoZSkge1xuICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgIGNvbnN0IHByb2plY3RJZCA9IGUudGFyZ2V0LmNsb3Nlc3QoJ1tkYXRhLXByb2plY3QtaWRdJykuZGF0YXNldC5wcm9qZWN0SWQ7XG4gICAgICAgIGNvbnN0IHRhc2sgPSBpbnB1dEZpZWxkLnZhbHVlO1xuICAgICAgICB2YWxpZGF0ZVVzZXJJbnB1dCgpO1xuICAgICAgICBpZiAodGFzaykgY3JlYXRlVGFzayh0YXNrLCBwcm9qZWN0SWQsIHRhc2tDb250YWluZXIpO1xuICAgIH0pO1xufVxuXG5jb25zdCBjcmVhdGVUYXNrID0gKHRhc2ssIHByb2plY3RJZCwgdGFza0NvbnRhaW5lcikgPT4ge1xuICAgIGNvbnN0IHRhc2tPYmogPSBoYW5kbGVycy5vblRhc2tBZGQodGFzaywgcHJvamVjdElkKTtcbiAgICB0YXNrQ29udGFpbmVyLnNldEF0dHJpYnV0ZSgnZGF0YS10YXNrLWlkJywgdGFza09iai50YXNrLnRhc2tJZCk7XG59XG5cbmNvbnN0IHZhbGlkYXRlVXNlcklucHV0ID0gKCkgPT4ge1xuICAgIGNvbnN0IGlucHV0RmllbGQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcjdXNlci1pbnB1dCcpO1xuICAgIGNvbnN0IGlucHV0Rm9ybSA9IGlucHV0RmllbGQucGFyZW50RWxlbWVudDtcbiAgICBjb25zdCB0YXNrSXRlbSA9IGlucHV0Rm9ybS5wYXJlbnRFbGVtZW50O1xuICAgIGNvbnN0IHRhc2tDb250YWluZXIgPSB0YXNrSXRlbS5wYXJlbnRFbGVtZW50O1xuXG4gICAgY29uc3QgdXNlcklucHV0ID0gaW5wdXRGaWVsZC52YWx1ZS50cmltKCk7XG4gICAgY29uc3QgdGFza1RleHRTcGFuID0gY3JlYXRlRWxlbWVudHMoKS5jcmVhdGVTcGFuRWxlbWVudCgndGFzay10ZXh0Jyk7XG4gICAgdGFza1RleHRTcGFuLmFwcGVuZCh1c2VySW5wdXQpO1xuXG4gICAgICAgIGlmICh1c2VySW5wdXQgPT0gJycpIHtcbiAgICAgICAgICAgIHRhc2tDb250YWluZXIucmVtb3ZlKCk7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgaW5wdXRGb3JtLnJlbW92ZSgpO1xuICAgICAgICB0YXNrSXRlbS5wcmVwZW5kKHRhc2tUZXh0U3Bhbik7XG59XG5cbi8vIFRPRE86IFVwZGF0ZSBwcmlvcml0eSBpbiBsb2NhbFN0b3JhZ2VcbmNvbnN0IHVwZGF0ZVByaW9yaXR5ID0gKGV2ZW50VGFyZ2V0KSA9PiB7XG4gICAgY29uc3QgdGFza0l0ZW1DbGFzc0xpc3QgPSBldmVudFRhcmdldC5wYXJlbnRFbGVtZW50LnBhcmVudEVsZW1lbnQuY2xhc3NMaXN0O1xuICAgIGlmICh0YXNrSXRlbUNsYXNzTGlzdC5jb250YWlucygnY29tcGxldGVkJykpIHJldHVybjtcblxuICAgIGNvbnN0IHByaW9yaXR5Q2xhc3NMaXN0ID0gZXZlbnRUYXJnZXQuY2xhc3NMaXN0O1xuXG4gICAgaWYgKHByaW9yaXR5Q2xhc3NMaXN0LmNvbnRhaW5zKCdwcmlvcml0eS1sb3cnKSkge1xuICAgICAgICBwcmlvcml0eUNsYXNzTGlzdC5yZW1vdmUoJ3ByaW9yaXR5LWxvdycpO1xuICAgICAgICBwcmlvcml0eUNsYXNzTGlzdC5hZGQoJ3ByaW9yaXR5LW1lZGl1bScpO1xuICAgICAgICByZXR1cm47XG4gICAgfVxuICAgIGlmIChwcmlvcml0eUNsYXNzTGlzdC5jb250YWlucygncHJpb3JpdHktbWVkaXVtJykpIHtcbiAgICAgICAgcHJpb3JpdHlDbGFzc0xpc3QucmVtb3ZlKCdwcmlvcml0eS1tZWRpdW0nKTtcbiAgICAgICAgcHJpb3JpdHlDbGFzc0xpc3QuYWRkKCdwcmlvcml0eS1oaWdoJyk7XG4gICAgICAgIHJldHVybjtcbiAgICB9XG4gICAgaWYgKHByaW9yaXR5Q2xhc3NMaXN0LmNvbnRhaW5zKCdwcmlvcml0eS1oaWdoJykpIHtcbiAgICAgICAgcHJpb3JpdHlDbGFzc0xpc3QucmVtb3ZlKCdwcmlvcml0eS1oaWdoJyk7XG4gICAgICAgIHByaW9yaXR5Q2xhc3NMaXN0LmFkZCgncHJpb3JpdHktbG93Jyk7XG4gICAgICAgIHJldHVybjtcbiAgICB9XG59XG5cbmV4cG9ydCB7XG4gICAgdG9nZ2xlVGFzayxcbiAgICBhZGRUYXNrVG9ET00sXG4gICAgYWRkVGFzayxcbiAgICB1cGRhdGVQcmlvcml0eSxcbn0iLCJpbXBvcnQgeyBhZGRQcm9qZWN0LCBkZWxldGVQcm9qZWN0LCBlZGl0UHJvamVjdCB9IGZyb20gXCIuL3Byb2plY3RzXCI7XG5pbXBvcnQgdXBkYXRlU3RvcmFnZSBmcm9tIFwiLi9zdG9yYWdlXCI7XG5pbXBvcnQgeyB1cGRhdGVQcm9qZWN0TGlzdCB9IGZyb20gXCIuL2NyZWF0ZURPTUVsZW1lbnRzXCI7XG5pbXBvcnQgeyB0b2dnbGVUYXNrLCBhZGRUYXNrVG9ET00sIGFkZFRhc2ssIHVwZGF0ZVByaW9yaXR5IH0gZnJvbSBcIi4vdGFza3NcIjtcblxuLy8gTG9hZCBsb2NhbFN0b3JhZ2UgaXRlbXMgb24gcGFnZSBsb2FkXG53aW5kb3cub25sb2FkID0gKCkgPT4ge1xuICAgIGNvbnN0IHByb2plY3RzID0gdXBkYXRlU3RvcmFnZS5nZXRQcm9qZWN0cygpO1xuICAgIHVwZGF0ZVByb2plY3RMaXN0KHByb2plY3RzKTtcbn1cblxuLy8gU2lkZWJhciBNb2R1bGVcbmNvbnN0IHNpZGViYXJDb250cm9sbGVyID0gKCgpID0+IHtcblxuICAgIGNvbnN0IG1vYmlsZVRvZ2dsZUJ0biA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdiYXJzLWljb24tbW9iaWxlJyk7XG4gICAgaWYgKHdpbmRvdy5pbm5lcldpZHRoIDw9IDEwMjQgJiYgbW9iaWxlVG9nZ2xlQnRuLmNsYXNzTGlzdC5jb250YWlucygnaGlkZGVuJykpIHtcbiAgICAgICAgbW9iaWxlVG9nZ2xlQnRuLmNsYXNzTGlzdC50b2dnbGUoJ2hpZGRlbicpO1xuICAgIH1cblxuICAgIGNvbnN0IHNpZGViYXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc2lkZWJhcicpO1xuICAgIFxuICAgIGNvbnN0IHRvZ2dsZVNpZGViYXIgPSAoKSA9PiB7XG4gICAgICAgIHNpZGViYXIuY2xhc3NMaXN0LnRvZ2dsZSgndG9nZ2xlLXNpZGViYXInKTtcbiAgICAgICAgaWYgKHdpbmRvdy5pbm5lcldpZHRoIDw9IDEwMjQpIG1vYmlsZVRvZ2dsZUJ0bi5jbGFzc0xpc3QudG9nZ2xlKCdoaWRkZW4nKTtcbiAgICB9XG4gICAgXG4gICAgY29uc3QgdG9nZ2xlQnRuID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLmJhcnMtaWNvbicpO1xuICAgIHRvZ2dsZUJ0bi5mb3JFYWNoKGJ1dHRvbiA9PiB7XG4gICAgICAgIGJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIHRvZ2dsZVNpZGViYXIpO1xuICAgIH0pOyAgICAgICAgXG59KSgpO1xuXG5jb25zdCBwcm9qZWN0Q29udHJvbGxlciA9ICgoKSA9PiB7XG4gICAgZGVsZXRlUHJvamVjdCgpO1xuICAgIGNvbnN0IGFkZFByb2plY3RCdG4gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCdbZGF0YS1hZGQtcHJvamVjdF0nKTtcbiAgICBhZGRQcm9qZWN0QnRuLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgYWRkUHJvamVjdCk7XG5cbiAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIChlKSA9PiB7XG4gICAgICAgIGlmIChlLnRhcmdldC5jbGFzc0xpc3QuY29udGFpbnMoJ2VkaXQtcHJvamVjdCcpKSB7XG4gICAgICAgICAgICBlZGl0UHJvamVjdChlKTtcbiAgICAgICAgfVxuICAgIH0pO1xufSkoKTtcblxuY29uc3QgdGFza0NvbnRyb2xsZXIgPSAoKCkgPT4ge1xuICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKGUpID0+IHtcbiAgICAgICAgaWYgKGUudGFyZ2V0LmNsYXNzTGlzdC5jb250YWlucygndGFzay1pdGVtJykpIHtcbiAgICAgICAgICAgIGNvbnN0IHRhc2tFbGVtZW50ID0gZS50YXJnZXQucGFyZW50RWxlbWVudDtcbiAgICAgICAgICAgIHRvZ2dsZVRhc2sodGFza0VsZW1lbnQpO1xuICAgICAgICB9XG4gICAgICAgIGlmIChlLnRhcmdldC5jbGFzc0xpc3QuY29udGFpbnMoJ2FkZC10YXNrJykpIHtcbiAgICAgICAgICAgIGFkZFRhc2tUb0RPTShlLnRhcmdldCk7XG4gICAgICAgICAgICBhZGRUYXNrKCk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGUudGFyZ2V0LmNsYXNzTGlzdC5jb250YWlucygncHJpb3JpdHktaWNvbicpKSB7XG4gICAgICAgICAgICB1cGRhdGVQcmlvcml0eShlLnRhcmdldCk7XG4gICAgICAgIH1cbiAgICB9KTtcbn0pKCk7XG4vKlxudXBkYXRlU3RvcmFnZS5zYXZlUHJvamVjdCh7XG4gICAgcHJvamVjdE5hbWU6IFwiUHJvamVjdCAxXCIsXG4gICAgdGFza3M6IFtbXCJGaW5pc2ggdG9kbyBsaXN0XCIsIFwibG93XCIsIFwiZHVlRGF0ZVwiLCBmYWxzZV0sIFtcIkRvIHNvbWV0aGluZ1wiLCBcIm1lZGl1bVwiLCBcImR1ZURhdGVcIiwgdHJ1ZV0sIFtcIkRvIHNvbWV0aGluZyBlbHNlXCIsIFwiaGlnaFwiLCBcImR1ZURhdGVcIiwgZmFsc2VdXSxcbiAgICBpZDogODE2MDg5XG59KTtcbiovXG4vL3N0b3JhZ2UuZGVsZXRlUHJvamVjdCg1ODE4NDApOyJdLCJuYW1lcyI6WyJnZXRQcm9qZWN0cyIsIkpTT04iLCJwYXJzZSIsImxvY2FsU3RvcmFnZSIsImdldEl0ZW0iLCJzYXZlUHJvamVjdCIsInByb2plY3RUb1NhdmUiLCJwcm9qZWN0cyIsImV4aXN0aW5nIiwiZmluZCIsInByb2plY3QiLCJpZCIsInByb2plY3ROYW1lIiwidGFza3MiLCJNYXRoIiwiZmxvb3IiLCJyYW5kb20iLCJwdXNoIiwic2V0SXRlbSIsInN0cmluZ2lmeSIsImRlbGV0ZVByb2plY3QiLCJ1cGRhdGVkUHJvamVjdExpc3QiLCJmaWx0ZXIiLCJkZWxldGVUYXNrIiwidGFza0lkIiwicHJvamVjdFdpdGhUYXNrIiwidXBkYXRlZFRhc2tPYmoiLCJ0YXNrT2JqIiwidGFzayIsIl9yZWZyZXNoUHJvamVjdExpc3QiLCJfc2V0UHJvamVjdExpc3QiLCJ1cGRhdGVQcm9qZWN0TGlzdCIsIl9zZXRBY3RpdmVUYWIiLCJ0YWIiLCJ1cGRhdGVBY3RpdmVUYWIiLCJvblByb2plY3RTZWxlY3QiLCJwcm9qZWN0SWQiLCJwcm9qZWN0T2JqZWN0Iiwic2VsZWN0ZWRQcm9qZWN0IiwiZG9jdW1lbnQiLCJxdWVyeVNlbGVjdG9yIiwib25Qcm9qZWN0QWRkIiwibmV3UHJvamVjdCIsIm5ld1Byb2plY3RET01FbGVtZW50Iiwib25Qcm9qZWN0RWRpdCIsIm9uVGFza0FkZCIsIm5ld1Rhc2siLCJpdGVtIiwicHJpb3JpdHkiLCJkdWVEYXRlIiwiaXNDb21wbGV0ZSIsInByb2plY3RUb1VwZGF0ZSIsImNyZWF0ZUVsZW1lbnRzIiwiY3JlYXRlTGlzdEVsZW1lbnQiLCJodG1sQ2xhc3MiLCJsaSIsImNyZWF0ZUVsZW1lbnQiLCJzZXRBdHRyaWJ1dGUiLCJjcmVhdGVTcGFuRWxlbWVudCIsInNwYW4iLCJjbGFzc0xpc3QiLCJhZGQiLCJjcmVhdGVJbWFnZUVsZW1lbnQiLCJzcmMiLCJpbWciLCJjcmVhdGVJbnB1dEZpZWxkIiwicGxhY2Vob2xkZXJUZXh0IiwidXNlcklucHV0IiwicmVxdWlyZWQiLCJjcmVhdGVGb3JtIiwiY3JlYXRlRGl2IiwiZGl2IiwiY3JlYXRlSWNvblNwYW4iLCJ2aWV3IiwiaWNvblNwYW4iLCJlZGl0SWNvbiIsImRlbGV0ZUljb24iLCJhcHBlbmQiLCJhZGRQcm9qZWN0VG9Ob3RlcGFkIiwicHJvamVjdExpc3QiLCJjdXJyZW50UHJvamVjdE51bWJlciIsImNoaWxkRWxlbWVudENvdW50IiwiY2hpbGRyZW4iLCJ0ZXh0Q29udGVudCIsIm5vdGVwYWQiLCJwcm9qZWN0RGl2Iiwic2tpcExpbmUiLCJwcm9qZWN0SGVhZGluZyIsImgyIiwiaDMiLCJ0YXNrc0NvbnRhaW5lciIsImFkZFRhc2tMaXN0RWxlbWVudCIsImFkZFRhc2tTcGFuIiwiYWRkSWNvbiIsIl9jcmVhdGVQcm9qZWN0SXRlbUhUTUwiLCJuYW1lIiwicHJvamVjdEl0ZW0iLCJwcm9qZWN0c0xpc3RDb250YWluZXIiLCJhZGRQcm9qZWN0QnRuIiwic2xpY2UiLCJjYWxsIiwiZm9yRWFjaCIsImNvbnRhaW5zIiwicmVtb3ZlIiwiaHRtbCIsImluc2VydEJlZm9yZSIsInF1ZXJ5U2VsZWN0b3JBbGwiLCJhZGRFdmVudExpc3RlbmVyIiwiZGF0YXNldCIsImN1cnJlbnRBY3RpdmVUYWIiLCJhd2FpdGluZ0lucHV0IiwiaGFuZGxlVXNlcklucHV0IiwicGFyZW50RWxlbWVudCIsInByb2plY3RTcGFuIiwidmFsdWUiLCJ0cmltIiwiY2hpbGROb2RlcyIsImFkZFByb2plY3QiLCJwcm9qZWN0c0NvbnRhaW5lciIsInByb2plY3RMaXN0RWxlbWVudCIsInByb2plY3RJbnB1dEZvcm0iLCJwcm9qZWN0TmFtZUlucHV0IiwibGFzdEVsZW1lbnRDaGlsZCIsInNldFRpbWVvdXQiLCJmb2N1cyIsImFkZFByb2plY3RUb1NpZGViYXIiLCJpbnB1dEZvcm0iLCJmaXJzdEVsZW1lbnRDaGlsZCIsImdldEF0dHJpYnV0ZSIsImUiLCJwcmV2ZW50RGVmYXVsdCIsImFkZFRhc2siLCJpbnB1dEZpZWxkIiwidGFza0NvbnRhaW5lciIsInRhcmdldCIsImNsb3Nlc3QiLCJ2YWxpZGF0ZVVzZXJJbnB1dCIsImNyZWF0ZVRhc2siLCJ0YXNrSXRlbSIsInRhc2tUZXh0U3BhbiIsInByZXBlbmQiLCJ3aW5kb3ciLCJvbmxvYWQiLCJtb2JpbGVUb2dnbGVCdG4iLCJnZXRFbGVtZW50QnlJZCIsImlubmVyV2lkdGgiLCJ0b2dnbGUiLCJzaWRlYmFyIiwidG9nZ2xlU2lkZWJhciIsImJ1dHRvbiIsInByZXZpb3VzRWxlbWVudFNpYmxpbmciLCJlZGl0UHJvamVjdCIsImFkZFRhc2tCdG4iLCJ0YXNrTGlzdEVsZW1lbnQiLCJ0YXNrU3BhbiIsImR1ZURhdGVTcGFuIiwicHJpb3JpdHlJY29uIiwiZGF0ZUxhYmVsIiwiZGF0ZUlucHV0IiwiY2FsZW5kYXJJY29uIiwiYWRkRHVlRGF0ZVRvRE9NIiwiY29udGFpbmVyIiwibnVtYmVyT2ZUYXNrcyIsImFkZFRhc2tUb0RPTSIsImV2ZW50VGFyZ2V0IiwicHJpb3JpdHlDbGFzc0xpc3QiLCJ1cGRhdGVQcmlvcml0eSJdLCJzb3VyY2VSb290IjoiIn0=