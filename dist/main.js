(()=>{"use strict";const t=(()=>{const e=()=>JSON.parse(localStorage.getItem("projects")||"[]"),t=t=>{const n=e(),a=n.find((e=>e.id==t.id));a?(a.projectName=t.projectName,a.tasks=t.tasks):(t.id=Math.floor(1e6*Math.random()),n.push(t)),localStorage.setItem("projects",JSON.stringify(n))};return{getProjects:e,getTasks:t=>e().find((e=>e.id==t)).tasks,saveProject:t,deleteProject:t=>{const n=e().filter((e=>e.id!=t));localStorage.setItem("projects",JSON.stringify(n))},deleteTask:(n,a)=>{const s=e().find((e=>e.id==n)),o=s.tasks.filter((e=>e.taskId!=a));s.tasks=o,t(s)},findTaskToUpdate:(t,n)=>e().find((e=>e.id==t)).tasks.find((e=>e.taskId==n)),updateTask:(t,n)=>{const a=e(),s=a.find((e=>e.id==t)),o=s.tasks,r=o.findIndex((e=>e.taskId==n.taskId));o[r]=n,s.tasks=o,localStorage.setItem("projects",JSON.stringify(a))}}})(),n=(()=>{const e=()=>{const e=t.getProjects();n(e)},n=e=>{c(e)},a=e=>{d(e)};return{onProjectSelect:e=>{const n=t.getProjects().find((t=>t.id==e)),s=document.querySelector(`[data-project-id='${n.id}']`);a(s)},onProjectAdd:n=>{const s={projectName:n,tasks:[]};t.saveProject(s),e();const o=document.querySelector(`[data-project-id='${s.id}']`);a(o)},onProjectNameEdit:(n,a,s=t.getTasks(n))=>{t.saveProject({id:n,projectName:a,tasks:s}),e()},onTaskAdd:(e,n)=>{const a={item:e,taskId:Math.floor(1e6*Math.random()),priority:"low",dueDate:null,isComplete:!1},s=t.getProjects().find((e=>e.id==n));return s.tasks.push(a),t.saveProject(s),a},onTaskNameEdit:(e,n,a)=>{const s=t.findTaskToUpdate(e,n);t.updateTask(e,{item:a,taskId:s.taskId,priority:s.priority,dueDate:s.dueDate,isComplete:s.isComplete})},onTaskPriorityEdit:(e,n,a)=>{const s=t.findTaskToUpdate(e,n);t.updateTask(e,{item:s.item,taskId:s.taskId,priority:a,dueDate:s.dueDate,isComplete:s.isComplete})},onTaskDueDateEdit:(e,n,a)=>{const s=t.findTaskToUpdate(e,n);t.updateTask(e,{item:s.item,taskId:s.taskId,priority:s.priority,dueDate:a,isComplete:s.isComplete})},onTaskCompleteEdit:(e,n,a)=>{const s=t.findTaskToUpdate(e,n);t.updateTask(e,{item:s.item,taskId:s.taskId,priority:s.priority,dueDate:s.dueDate,isComplete:a})}}})(),a=()=>({createListElement:e=>{const t=document.createElement("li");return t.setAttribute("class",e),t},createSpanElement:e=>{const t=document.createElement("span");return t.classList.add(e),t},createImageElement:(e,t)=>{const n=document.createElement("img");return n.classList.add(t),n.setAttribute("src",e),n.setAttribute("draggable","false"),n},createInputField:e=>{const t=document.createElement("input");return t.setAttribute("type","text"),t.setAttribute("placeholder",e),t.setAttribute("id","user-input"),t.required=!0,t},createForm:()=>document.createElement("form"),createDiv:e=>{const t=document.createElement("div");return t.setAttribute("class",e),t}}),s=()=>{const e=a(),t=e.createSpanElement("icons"),n=e.createImageElement("images/edit-icon.svg","edit-icon"),s=e.createImageElement("images/delete-icon.svg","delete-icon");return n.classList.add("edit-project"),s.classList.add("delete-project"),t.append(n,s),t},o=e=>{const n=a(),s=t.getProjects().find((t=>t.id==e)).projectName,o=document.querySelector("#writing-area"),r=n.createDiv("project");r.setAttribute("data-project-id",e);const c=n.createDiv("skip-line"),d=n.createDiv("project-heading"),i=document.createElement("h2");i.setAttribute("class","notepad-text"),i.textContent=s;const l=document.createElement("h3");l.setAttribute("class","notepad-text"),l.textContent="Due Date";const m=document.createElement("ul");m.classList.add("notepad-text","todos");const p=n.createListElement("task"),u=n.createSpanElement("add-task"),E=n.createImageElement("images/add-icon.svg","add-icon");u.append(E,"Add Task"),p.append(u),m.append(p,c),d.append(i,l),r.append(d,m),o.append(r)},r=(e,t)=>{const n=a(),o=n.createListElement("project-item");o.setAttribute("data-project-id",e);const r=n.createSpanElement("project-name");r.textContent=t;const c=s();return o.append(r,c),o},c=e=>{const t=document.querySelector(".project-list"),a=document.querySelector("[data-add-project]");[].slice.call(t.children).forEach((e=>{e.classList.contains("project-item")&&e.remove()}));for(const n of e){const e=r(n.id,n.projectName);t.insertBefore(e,a)}t.querySelectorAll(".project-item").forEach((e=>{e.addEventListener("click",(()=>{n.onProjectSelect(e.dataset.projectId)}))}))},d=e=>{const t=document.querySelector(".active");t&&t.classList.remove("active"),e.classList.add("active"),e.children.item(0)},i=()=>null!=document.querySelector("#user-input"),l=()=>{const e=document.querySelector("#user-input"),t=e.parentElement.parentElement,n=a().createSpanElement("project-name"),s=e.value.trim();s&&(n.textContent=s,e.parentElement.remove(),t.insertBefore(n,t.childNodes[0]))},m=()=>{if(i())return;(()=>{const e=a(),t=document.querySelector(".project-list"),n=e.createListElement("project-item"),o=e.createForm(),r=e.createInputField("Project name...");o.append(r);const c=s();n.append(o,c),t.insertBefore(n,t.lastElementChild),setTimeout((()=>{r.focus()}),0)})();const e=document.querySelector("#user-input"),t=e.parentElement,r=t.parentElement;e.addEventListener("blur",(function(){if(""==e.value.trim())return void r.remove();l();const t=r.firstElementChild.textContent;n.onProjectAdd(t);const a=document.querySelector(".project-list"),s=a.children[a.childElementCount-2].getAttribute("data-project-id");i()||o(s)})),t.addEventListener("submit",(function(e){e.preventDefault(),l();const t=r.firstElementChild.textContent;n.onProjectAdd(t);const a=document.querySelector(".project-list"),s=a.children[a.childElementCount-2].getAttribute("data-project-id");i()||o(s)}))},p=()=>{const t=document.querySelector("#user-input"),n=t.parentElement,a=n.parentElement.parentElement;t.addEventListener("blur",(function(){const e=a.closest("[data-project-id]").dataset.projectId,n=t.value;E(),n&&u(n,e,a)})),n.addEventListener("submit",(function(){e.preventDefault();const n=a.closest("[data-project-id]").dataset.projectId,s=t.value;E(),s&&u(s,n,a)}))},u=(e,t,a)=>{if(a.dataset.taskId)return n.onTaskNameEdit(t,a.dataset.taskId,e);const s=n.onTaskAdd(e,t);a.setAttribute("data-task-id",s.taskId)},E=()=>{const e=document.querySelector("#user-input"),t=e.parentElement,n=t.parentElement,s=n.parentElement,o=e.value.trim(),r=a().createSpanElement("task-text");r.append(o),""!=o||s.dataset.taskId?""==o&&s.dataset.taskId||(t.remove(),n.prepend(r)):s.remove()};window.onload=()=>{const e=t.getProjects();c(e),(e=>{e.forEach((e=>{o(e.id)}))})(e)},(()=>{const e=document.getElementById("bars-icon-mobile");window.innerWidth<=1024&&e.classList.contains("hidden")&&e.classList.toggle("hidden");const t=document.getElementById("sidebar"),n=()=>{t.classList.toggle("toggle-sidebar"),window.innerWidth<=1024&&e.classList.toggle("hidden")};document.querySelectorAll(".bars-icon").forEach((e=>{e.addEventListener("click",n)}))})(),document.addEventListener("click",(e=>{if(e.target.closest(".delete-project")){const n=e.target.closest(".project-item");n.remove();const a=n.dataset.projectId;t.deleteProject(a)}})),document.querySelector("[data-add-project]").addEventListener("click",m),document.addEventListener("click",(e=>{e.target.classList.contains("edit-project")&&(e=>{if(i())return;const t=a().createForm(),s=a().createInputField("Project name..."),o=e.target.parentElement.previousElementSibling;s.value=o.textContent,o.remove(),t.append(s);const r=e.target.closest(".project-item");r.insertBefore(t,r.childNodes[0]);const c=document.querySelector("#user-input");c.focus();const d=r.dataset.projectId;c.addEventListener("blur",(function(){""!=c.value&&l();const e=r.firstElementChild.textContent;m(d,e),n.onProjectNameEdit(d,e)})),t.addEventListener("submit",(function(e){e.preventDefault(),l();const t=r.firstElementChild.textContent;m(d,t),n.onProjectNameEdit(d,t)}));const m=(e,t)=>{const n=document.querySelector(".notepad").querySelector(`[data-project-id="${e}"]`);n&&(n.childNodes[0].childNodes[0].textContent=t)}})(e)})),document.addEventListener("click",(e=>{e.target.classList.contains("task-text")&&(e=>{e.classList.toggle("completed");let t=!1;e.classList.contains("completed")&&(t=!0);const a=e.closest(".project").dataset.projectId,s=e.dataset.taskId;n.onTaskCompleteEdit(a,s,t)})(e.target.closest(".task")),e.target.classList.contains("add-task")&&((e=>{if(document.getElementById("user-input"))return;const s=a().createListElement("task"),o=a().createSpanElement("task-item"),r=a().createForm(),c=a().createInputField("Enter Task...");r.append(c),o.append(r);const d=a().createSpanElement("icons"),i=a().createImageElement("images/edit-icon.svg","edit-icon"),l=a().createImageElement("images/delete-icon.svg","delete-icon");i.addEventListener("click",(()=>{if(s.classList.contains("completed"))return;const e=document.querySelector(".task-text"),t=e.textContent;e.remove();const n=a().createForm(),r=a().createInputField("Enter Task...");r.value=t,n.append(r),o.insertBefore(n,d),s.prepend(o),r.focus(),p()})),l.addEventListener("click",(e=>{const n=e.target.closest("[data-project-id]").dataset.projectId,a=e.target.closest("[data-task-id]").dataset.taskId;s.remove(),t.deleteTask(n,a)})),d.append(i,l),o.append(d);const m=(()=>{const e=a().createSpanElement("due-date"),t=a().createImageElement("images/priority-icon.svg","priority-icon");t.classList.add("priority-low");const s=document.createElement("label");s.classList.add("date-label");const o=document.createElement("input");o.setAttribute("type","date"),o.required=!0;const r=a().createImageElement("images/calendar-icon.svg","calendar-icon");return s.append(o,r),e.append(t,s),o.addEventListener("change",(()=>{const e=o.closest([".project"]).dataset.projectId,t=o.closest("[data-task-id").dataset.taskId,a=o.value;return n.onTaskDueDateEdit(e,t,a)})),e})();s.append(o,m);const u=e.closest(".todos"),E=u.childElementCount-2;u.insertBefore(s,u.children[E]),setTimeout((()=>{c.focus()}),0)})(e.target),p()),e.target.classList.contains("priority-icon")&&(e=>{if(e.parentElement.parentElement.classList.contains("completed"))return;const t=e.closest(".project").dataset.projectId,a=e.closest("[data-task-id]").dataset.taskId,s=e.classList;s.contains("priority-low")?(s.remove("priority-low"),s.add("priority-medium"),n.onTaskPriorityEdit(t,a,"medium")):s.contains("priority-medium")?(s.remove("priority-medium"),s.add("priority-high"),n.onTaskPriorityEdit(t,a,"high")):s.contains("priority-high")&&(s.remove("priority-high"),s.add("priority-low"),n.onTaskPriorityEdit(t,a,"low"))})(e.target)}))})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QUFhdUQsRUFBaUJTLEVBQVVyRSxTQUFTc0UsSUFFM0QvQyxZQUFXLEtBQ1BXLEVBQVdWLFVBQ1osSUNsQksrQyxDQUFheEMsRUFBRXFCLFFBQ2ZuQixLQUVBRixFQUFFcUIsT0FBT3pGLFVBQVV1QyxTQUFTLGtCRHFHakIsQ0FBQ3NFLElBRXBCLEdBRDBCQSxFQUFZNUQsY0FBY0EsY0FBY2pELFVBQzVDdUMsU0FBUyxhQUFjLE9BQzdDLE1BQU05RixFQUFZb0ssRUFBWXBDLFFBQVEsWUFBWTVCLFFBQVFwRyxVQUNwREssRUFBUytKLEVBQVlwQyxRQUFRLGtCQUFrQjVCLFFBQVEvRixPQUV2RGdLLEVBQW9CRCxFQUFZN0csVUFFbEM4RyxFQUFrQnZFLFNBQVMsaUJBQzNCdUUsRUFBa0J0RSxPQUFPLGdCQUN6QnNFLEVBQWtCN0csSUFBSSxtQkFDZixxQkFBNEJ4RCxFQUFXSyxFQUFRLFdBRXREZ0ssRUFBa0J2RSxTQUFTLG9CQUMzQnVFLEVBQWtCdEUsT0FBTyxtQkFDekJzRSxFQUFrQjdHLElBQUksaUJBQ2YscUJBQTRCeEQsRUFBV0ssRUFBUSxTQUV0RGdLLEVBQWtCdkUsU0FBUyxtQkFDM0J1RSxFQUFrQnRFLE9BQU8saUJBQ3pCc0UsRUFBa0I3RyxJQUFJLGdCQUNmLHFCQUE0QnhELEVBQVdLLEVBQVEsU0N6SGxEaUssQ0FBZTNDLEVBQUVxQixZIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vdG9kby1saXN0Ly4vc3JjL3N0b3JhZ2UuanMiLCJ3ZWJwYWNrOi8vdG9kby1saXN0Ly4vc3JjL2hhbmRsZXJzLmpzIiwid2VicGFjazovL3RvZG8tbGlzdC8uL3NyYy9jcmVhdGVET01FbGVtZW50cy5qcyIsIndlYnBhY2s6Ly90b2RvLWxpc3QvLi9zcmMvcHJvamVjdHMuanMiLCJ3ZWJwYWNrOi8vdG9kby1saXN0Ly4vc3JjL3Rhc2tzLmpzIiwid2VicGFjazovL3RvZG8tbGlzdC8uL3NyYy9pbmRleC5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJjb25zdCB1cGRhdGVTdG9yYWdlID0gKCkgPT4ge1xuICAgIFxuICAgIGNvbnN0IGdldFByb2plY3RzID0gKCkgPT4ge1xuICAgICAgICAvLyBjcmVhdGVzIGFuIGFycmF5IG9mIG9iamVjdHMgXG4gICAgICAgIGNvbnN0IHByb2plY3RzID0gSlNPTi5wYXJzZShsb2NhbFN0b3JhZ2UuZ2V0SXRlbSgncHJvamVjdHMnKSB8fCAnW10nKTtcbiAgICAgICAgcmV0dXJuIHByb2plY3RzO1xuICAgIH1cblxuICAgIGNvbnN0IGdldFRhc2tzID0gKHByb2plY3RJZCkgPT4ge1xuICAgICAgICBjb25zdCBwcm9qZWN0cyA9IGdldFByb2plY3RzKCk7XG4gICAgICAgIGNvbnN0IGN1cnJlbnRQcm9qZWN0ID0gcHJvamVjdHMuZmluZChwcm9qZWN0ID0+IHByb2plY3QuaWQgPT0gcHJvamVjdElkKTtcbiAgICAgICAgY29uc3QgdGFza3MgPSBjdXJyZW50UHJvamVjdC50YXNrcztcbiAgICAgICAgcmV0dXJuIHRhc2tzO1xuICAgIH1cblxuICAgIGNvbnN0IHNhdmVQcm9qZWN0ID0gKHByb2plY3RUb1NhdmUpID0+IHtcbiAgICAgICAgY29uc3QgcHJvamVjdHMgPSBnZXRQcm9qZWN0cygpO1xuXG4gICAgICAgIC8vIGZpbmQgbWV0aG9kIHJldHVybnMgdGhlIGZpcnN0IG9iamVjdCB0aGF0IG1hdGNoZXMgdGhlIGlkXG4gICAgICAgIGNvbnN0IGV4aXN0aW5nID0gcHJvamVjdHMuZmluZChwcm9qZWN0ID0+IHByb2plY3QuaWQgPT0gcHJvamVjdFRvU2F2ZS5pZCk7XG4gICAgICAgIFxuICAgICAgICBpZiAoZXhpc3RpbmcpIHtcbiAgICAgICAgICAgIGV4aXN0aW5nLnByb2plY3ROYW1lID0gcHJvamVjdFRvU2F2ZS5wcm9qZWN0TmFtZTtcbiAgICAgICAgICAgIGV4aXN0aW5nLnRhc2tzID0gcHJvamVjdFRvU2F2ZS50YXNrcztcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHByb2plY3RUb1NhdmUuaWQgPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAxMDAwMDAwKTtcbiAgICAgICAgICAgIC8vIEFkZCBwcm9qZWN0TmFtZVxuICAgICAgICAgICAgLy8gQWRkIFRhc2tzIGFycmF5IGNvbnRhaW5pbmcgYW5vdGhlciBhcnJheSB3aGljaCBpbmNsdWRlcyB0YXNrLCBwcmlvcml0eSwgZHVlRGF0ZSwgYW5kIHRydWUvZmFsc2UgZm9yIGNvbXBsZXRlZCBvciBub3RcbiAgICAgICAgICAgIHByb2plY3RzLnB1c2gocHJvamVjdFRvU2F2ZSk7XG4gICAgICAgIH1cblxuICAgICAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbSgncHJvamVjdHMnLCBKU09OLnN0cmluZ2lmeShwcm9qZWN0cykpO1xuICAgIH1cblxuICAgIGNvbnN0IHVwZGF0ZVRhc2sgPSAocHJvamVjdElkLCB1cGRhdGVkVGFzaykgPT4ge1xuICAgICAgICAvLyB0YXNrcyBmb3IgY3VycmVudCBwcm9qZWN0XG4gICAgICAgIGNvbnN0IHByb2plY3RzID0gZ2V0UHJvamVjdHMoKTtcbiAgICAgICAgY29uc3QgcHJvamVjdFRvVXBkYXRlID0gcHJvamVjdHMuZmluZChwcm9qZWN0ID0+IHByb2plY3QuaWQgPT0gcHJvamVjdElkKTtcbiAgICAgICAgY29uc3QgdGFza3NBcnJheSA9IHByb2plY3RUb1VwZGF0ZS50YXNrcztcbiAgICAgICAgXG4gICAgICAgIC8vIGZpbmQgdGFzayBpbmRleCBhbmQgcmVwbGFjZSB0aGUgdGFzayBhdCB0aGF0IGluZGV4IHRvIHVwZGF0ZVxuICAgICAgICBjb25zdCBpbmRleE9mVXBkYXRlZFRhc2sgPSB0YXNrc0FycmF5LmZpbmRJbmRleCgodGFza09iaikgPT4ge1xuICAgICAgICAgICAgcmV0dXJuIHRhc2tPYmoudGFza0lkID09IHVwZGF0ZWRUYXNrLnRhc2tJZDtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgdGFza3NBcnJheVtpbmRleE9mVXBkYXRlZFRhc2tdID0gdXBkYXRlZFRhc2s7XG4gICAgICAgIC8vIFNhdmUgdXBkYXRlZCB0YXNrcyBhcnJheSB0byB0aGUgcHJvamVjdCBvYmplY3RcbiAgICAgICAgcHJvamVjdFRvVXBkYXRlLnRhc2tzID0gdGFza3NBcnJheTtcbiAgICAgICAgbG9jYWxTdG9yYWdlLnNldEl0ZW0oJ3Byb2plY3RzJywgSlNPTi5zdHJpbmdpZnkocHJvamVjdHMpKTtcbiAgICB9XG5cbiAgICBjb25zdCBmaW5kVGFza1RvVXBkYXRlID0gKHByb2plY3RJZCwgZXhpc3RpbmdUYXNrSWQpID0+IHtcbiAgICAgICAgY29uc3QgcHJvamVjdHMgPSBnZXRQcm9qZWN0cygpOyAgICAgXG4gICAgICAgIGNvbnN0IHByb2plY3RUb1VwZGF0ZSA9IHByb2plY3RzLmZpbmQocHJvamVjdCA9PiBwcm9qZWN0LmlkID09IHByb2plY3RJZCk7XG4gICAgICAgIGNvbnN0IHRhc2tzQXJyYXkgPSBwcm9qZWN0VG9VcGRhdGUudGFza3NcbiAgICAgICAgY29uc3QgZXhpc3RpbmdUYXNrID0gdGFza3NBcnJheS5maW5kKHRhc2sgPT4gdGFzay50YXNrSWQgPT0gZXhpc3RpbmdUYXNrSWQpO1xuICAgICAgICByZXR1cm4gZXhpc3RpbmdUYXNrO1xuICAgIH1cblxuICAgIGNvbnN0IGRlbGV0ZVByb2plY3QgPSAoaWQpID0+IHtcbiAgICAgICAgY29uc3QgcHJvamVjdHMgPSBnZXRQcm9qZWN0cygpO1xuICAgICAgICBjb25zdCB1cGRhdGVkUHJvamVjdExpc3QgPSBwcm9qZWN0cy5maWx0ZXIocHJvamVjdCA9PiBwcm9qZWN0LmlkICE9IGlkKTtcblxuICAgICAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbSgncHJvamVjdHMnLCBKU09OLnN0cmluZ2lmeSh1cGRhdGVkUHJvamVjdExpc3QpKTtcbiAgICB9XG5cbiAgICBjb25zdCBkZWxldGVUYXNrID0gKGlkLCB0YXNrSWQpID0+IHtcbiAgICAgICAgY29uc3QgcHJvamVjdHMgPSBnZXRQcm9qZWN0cygpO1xuICAgICAgICBjb25zdCBwcm9qZWN0V2l0aFRhc2sgPSBwcm9qZWN0cy5maW5kKHByb2plY3QgPT4gcHJvamVjdC5pZCA9PSBpZCk7XG4gICAgICAgIGNvbnN0IGFsbFRhc2tzID0gcHJvamVjdFdpdGhUYXNrLnRhc2tzO1xuICAgICAgICAvLyBFYWNoIHRhc2sgaXMgYW4gb2JqZWN0XG4gICAgICAgIGNvbnN0IHVwZGF0ZWRUYXNrT2JqID0gYWxsVGFza3MuZmlsdGVyKHRhc2tPYmogPT4gdGFza09iai50YXNrSWQgIT0gdGFza0lkKTtcbiAgICAgICAgcHJvamVjdFdpdGhUYXNrLnRhc2tzID0gdXBkYXRlZFRhc2tPYmo7XG5cbiAgICAgICAgc2F2ZVByb2plY3QocHJvamVjdFdpdGhUYXNrKTtcbiAgICB9XG5cbiAgICByZXR1cm4geyBnZXRQcm9qZWN0cywgZ2V0VGFza3MsIHNhdmVQcm9qZWN0LCBkZWxldGVQcm9qZWN0LCBkZWxldGVUYXNrLCBmaW5kVGFza1RvVXBkYXRlLCB1cGRhdGVUYXNrIH1cbn1cblxuZXhwb3J0IGRlZmF1bHQgdXBkYXRlU3RvcmFnZSgpOyIsImltcG9ydCB7IHVwZGF0ZVByb2plY3RMaXN0LCB1cGRhdGVBY3RpdmVUYWIgfSBmcm9tIFwiLi9jcmVhdGVET01FbGVtZW50c1wiO1xuaW1wb3J0IHVwZGF0ZVN0b3JhZ2UgZnJvbSBcIi4vc3RvcmFnZVwiO1xuaW1wb3J0IHtmb3JtYXR9IGZyb20gXCJkYXRlLWZuc1wiO1xuXG5jb25zdCBoYW5kbGVycyA9ICgpID0+IHtcbiAgICBcbiAgICBjb25zdCBfcmVmcmVzaFByb2plY3RMaXN0ID0gKCkgPT4ge1xuICAgICAgICBjb25zdCBwcm9qZWN0cyA9IHVwZGF0ZVN0b3JhZ2UuZ2V0UHJvamVjdHMoKTsgLy8gVXBkYXRlIHByb2plY3RzIGluIHN0b3JhZ2UgICAgICAgIFxuICAgICAgICBfc2V0UHJvamVjdExpc3QocHJvamVjdHMpOyAvLyBVcGRhdGUgcHJvamVjdHMgb24gRE9NXG4gICAgfVxuXG4gICAgY29uc3QgX3NldFByb2plY3RMaXN0ID0gKHByb2plY3RzKSA9PiB7XG4gICAgICAgIHVwZGF0ZVByb2plY3RMaXN0KHByb2plY3RzKTtcbiAgICB9XG5cbiAgICBjb25zdCBfc2V0QWN0aXZlVGFiID0gKHRhYikgPT4ge1xuICAgICAgICB1cGRhdGVBY3RpdmVUYWIodGFiKTtcbiAgICB9XG5cbiAgICAvLyBIZXJlIGJlIGhhbmRsZXJzXG4gICAgY29uc3Qgb25Qcm9qZWN0U2VsZWN0ID0gKHByb2plY3RJZCkgPT4ge1xuICAgICAgICBjb25zdCBwcm9qZWN0cyA9IHVwZGF0ZVN0b3JhZ2UuZ2V0UHJvamVjdHMoKTtcbiAgICAgICAgY29uc3QgcHJvamVjdE9iamVjdCA9IHByb2plY3RzLmZpbmQocHJvamVjdCA9PiBwcm9qZWN0LmlkID09IHByb2plY3RJZCk7XG4gICAgICAgIGNvbnN0IHNlbGVjdGVkUHJvamVjdCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoYFtkYXRhLXByb2plY3QtaWQ9JyR7cHJvamVjdE9iamVjdC5pZH0nXWApO1xuICAgICAgICBfc2V0QWN0aXZlVGFiKHNlbGVjdGVkUHJvamVjdCk7XG4gICAgfVxuXG4gICAgY29uc3Qgb25Qcm9qZWN0QWRkID0gKHByb2plY3ROYW1lKSA9PiB7XG4gICAgICAgIC8vIHBhc3MgdXNlciBpbnB1dCBpbnRvIGZ1bmN0aW9uXG4gICAgICAgIGNvbnN0IG5ld1Byb2plY3QgPSAge1xuICAgICAgICAgICAgcHJvamVjdE5hbWU6IHByb2plY3ROYW1lLFxuICAgICAgICAgICAgdGFza3M6IFtdXG4gICAgICAgIH1cbiAgICAgICAgdXBkYXRlU3RvcmFnZS5zYXZlUHJvamVjdChuZXdQcm9qZWN0KTtcbiAgICAgICAgLy8gYWRkIGlucHV0IHRvIHBhZ2VcbiAgICAgICAgX3JlZnJlc2hQcm9qZWN0TGlzdCgpO1xuICAgICAgICBjb25zdCBuZXdQcm9qZWN0RE9NRWxlbWVudCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoYFtkYXRhLXByb2plY3QtaWQ9JyR7bmV3UHJvamVjdC5pZH0nXWApO1xuICAgICAgICBfc2V0QWN0aXZlVGFiKG5ld1Byb2plY3RET01FbGVtZW50KTtcbiAgICB9XG4gICAgXG4gICAgY29uc3Qgb25UYXNrQWRkID0gKHRhc2ssIGlkKSA9PiB7XG4gICAgICAgIGNvbnN0IG5ld1Rhc2sgPSB7XG4gICAgICAgICAgICBpdGVtOiB0YXNrLCBcbiAgICAgICAgICAgIHRhc2tJZDogTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogMTAwMDAwMCksXG4gICAgICAgICAgICBwcmlvcml0eTogJ2xvdycsXG4gICAgICAgICAgICBkdWVEYXRlOiBudWxsLFxuICAgICAgICAgICAgaXNDb21wbGV0ZTogZmFsc2VcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBwcm9qZWN0cyA9IHVwZGF0ZVN0b3JhZ2UuZ2V0UHJvamVjdHMoKTtcbiAgICAgICAgY29uc3QgcHJvamVjdFRvVXBkYXRlID0gcHJvamVjdHMuZmluZChwcm9qZWN0ID0+IHByb2plY3QuaWQgPT0gaWQpO1xuICAgICAgICBwcm9qZWN0VG9VcGRhdGUudGFza3MucHVzaChuZXdUYXNrKTtcbiAgICAgICAgdXBkYXRlU3RvcmFnZS5zYXZlUHJvamVjdChwcm9qZWN0VG9VcGRhdGUpO1xuICAgICAgICBcbiAgICAgICAgcmV0dXJuIG5ld1Rhc2s7XG4gICAgfVxuICAgIFxuICAgIGNvbnN0IG9uUHJvamVjdE5hbWVFZGl0ID0gKHByb2plY3RJZCwgcHJvamVjdE5hbWUsIHRhc2tzID0gdXBkYXRlU3RvcmFnZS5nZXRUYXNrcyhwcm9qZWN0SWQpKSA9PiB7XG4gICAgICAgIHVwZGF0ZVN0b3JhZ2Uuc2F2ZVByb2plY3Qoe1xuICAgICAgICAgICAgaWQ6IHByb2plY3RJZCxcbiAgICAgICAgICAgIHByb2plY3ROYW1lOiBwcm9qZWN0TmFtZSxcbiAgICAgICAgICAgIHRhc2tzOiB0YXNrc1xuICAgICAgICB9KTtcblxuICAgICAgICBfcmVmcmVzaFByb2plY3RMaXN0KCk7XG4gICAgfVxuXG4gICAgY29uc3Qgb25UYXNrTmFtZUVkaXQgPSAocHJvamVjdElkLCB0YXNrSWQsIG5ld1Rhc2tOYW1lKSA9PiB7XG4gICAgICAgIGNvbnN0IGV4aXN0aW5nVGFzayA9IHVwZGF0ZVN0b3JhZ2UuZmluZFRhc2tUb1VwZGF0ZShwcm9qZWN0SWQsIHRhc2tJZCk7XG4gICAgICAgIHVwZGF0ZVN0b3JhZ2UudXBkYXRlVGFzayhwcm9qZWN0SWQsIHtcbiAgICAgICAgICAgICAgICBpdGVtOiBuZXdUYXNrTmFtZSxcbiAgICAgICAgICAgICAgICB0YXNrSWQ6IGV4aXN0aW5nVGFzay50YXNrSWQsXG4gICAgICAgICAgICAgICAgcHJpb3JpdHk6IGV4aXN0aW5nVGFzay5wcmlvcml0eSxcbiAgICAgICAgICAgICAgICBkdWVEYXRlOiBleGlzdGluZ1Rhc2suZHVlRGF0ZSxcbiAgICAgICAgICAgICAgICBpc0NvbXBsZXRlOiBleGlzdGluZ1Rhc2suaXNDb21wbGV0ZVxuICAgICAgICAgICAgfSk7ICBcbiAgICB9XG5cbiAgICBjb25zdCBvblRhc2tQcmlvcml0eUVkaXQgPSAocHJvamVjdElkLCB0YXNrSWQsIG5ld1ByaW9yaXR5KSA9PiB7XG4gICAgICAgIGNvbnN0IGV4aXN0aW5nVGFzayA9IHVwZGF0ZVN0b3JhZ2UuZmluZFRhc2tUb1VwZGF0ZShwcm9qZWN0SWQsIHRhc2tJZCk7XG4gICAgICAgIHVwZGF0ZVN0b3JhZ2UudXBkYXRlVGFzayhwcm9qZWN0SWQsIHtcbiAgICAgICAgICAgICAgICBpdGVtOiBleGlzdGluZ1Rhc2suaXRlbSxcbiAgICAgICAgICAgICAgICB0YXNrSWQ6IGV4aXN0aW5nVGFzay50YXNrSWQsXG4gICAgICAgICAgICAgICAgcHJpb3JpdHk6IG5ld1ByaW9yaXR5LFxuICAgICAgICAgICAgICAgIGR1ZURhdGU6IGV4aXN0aW5nVGFzay5kdWVEYXRlLFxuICAgICAgICAgICAgICAgIGlzQ29tcGxldGU6IGV4aXN0aW5nVGFzay5pc0NvbXBsZXRlXG4gICAgICAgICAgICB9KTsgIFxuICAgIH1cblxuICAgIGNvbnN0IG9uVGFza0R1ZURhdGVFZGl0ID0gKHByb2plY3RJZCwgdGFza0lkLCBuZXdEdWVEYXRlKSA9PiB7XG4gICAgICAgIGNvbnN0IGV4aXN0aW5nVGFzayA9IHVwZGF0ZVN0b3JhZ2UuZmluZFRhc2tUb1VwZGF0ZShwcm9qZWN0SWQsIHRhc2tJZCk7XG4gICAgICAgIHVwZGF0ZVN0b3JhZ2UudXBkYXRlVGFzayhwcm9qZWN0SWQsIHtcbiAgICAgICAgICAgICAgICBpdGVtOiBleGlzdGluZ1Rhc2suaXRlbSxcbiAgICAgICAgICAgICAgICB0YXNrSWQ6IGV4aXN0aW5nVGFzay50YXNrSWQsXG4gICAgICAgICAgICAgICAgcHJpb3JpdHk6IGV4aXN0aW5nVGFzay5wcmlvcml0eSxcbiAgICAgICAgICAgICAgICBkdWVEYXRlOiBuZXdEdWVEYXRlLFxuICAgICAgICAgICAgICAgIGlzQ29tcGxldGU6IGV4aXN0aW5nVGFzay5pc0NvbXBsZXRlXG4gICAgICAgICAgICB9KTsgIFxuICAgIH1cblxuICAgIGNvbnN0IG9uVGFza0NvbXBsZXRlRWRpdCA9IChwcm9qZWN0SWQsIHRhc2tJZCwgaXNDb21wbGV0ZSkgPT4ge1xuICAgICAgICBjb25zdCBleGlzdGluZ1Rhc2sgPSB1cGRhdGVTdG9yYWdlLmZpbmRUYXNrVG9VcGRhdGUocHJvamVjdElkLCB0YXNrSWQpO1xuICAgICAgICB1cGRhdGVTdG9yYWdlLnVwZGF0ZVRhc2socHJvamVjdElkLCB7XG4gICAgICAgICAgICAgICAgaXRlbTogZXhpc3RpbmdUYXNrLml0ZW0sXG4gICAgICAgICAgICAgICAgdGFza0lkOiBleGlzdGluZ1Rhc2sudGFza0lkLFxuICAgICAgICAgICAgICAgIHByaW9yaXR5OiBleGlzdGluZ1Rhc2sucHJpb3JpdHksXG4gICAgICAgICAgICAgICAgZHVlRGF0ZTogZXhpc3RpbmdUYXNrLmR1ZURhdGUsXG4gICAgICAgICAgICAgICAgaXNDb21wbGV0ZTogaXNDb21wbGV0ZVxuICAgICAgICAgICAgfSk7ICBcbiAgICB9XG5cbiAgICByZXR1cm4geyBvblByb2plY3RTZWxlY3QsIG9uUHJvamVjdEFkZCwgb25Qcm9qZWN0TmFtZUVkaXQsIG9uVGFza0FkZCwgb25UYXNrTmFtZUVkaXQsIG9uVGFza1ByaW9yaXR5RWRpdCwgb25UYXNrRHVlRGF0ZUVkaXQsIG9uVGFza0NvbXBsZXRlRWRpdCB9XG4gICAgXG59XG5cbmV4cG9ydCBkZWZhdWx0IGhhbmRsZXJzKCk7IiwiaW1wb3J0IGhhbmRsZXJzIGZyb20gXCIuL2hhbmRsZXJzXCJcbmltcG9ydCB1cGRhdGVTdG9yYWdlIGZyb20gXCIuL3N0b3JhZ2VcIjtcblxuLy8gRE9NIEVsZW1lbnRzIEZhY3RvcnkgRnVuY3Rpb25cbmNvbnN0IGNyZWF0ZUVsZW1lbnRzID0gKCkgPT4ge1xuICAgIFxuICAgIGNvbnN0IGNyZWF0ZUxpc3RFbGVtZW50ID0gKGh0bWxDbGFzcykgPT4ge1xuICAgICAgICBjb25zdCBsaSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2xpJyk7XG4gICAgICAgIGxpLnNldEF0dHJpYnV0ZSgnY2xhc3MnLCBodG1sQ2xhc3MpO1xuICAgICAgICByZXR1cm4gbGk7XG4gICAgfVxuXG4gICAgY29uc3QgY3JlYXRlU3BhbkVsZW1lbnQgPSAoaHRtbENsYXNzKSA9PiB7XG4gICAgICAgIGNvbnN0IHNwYW4gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdzcGFuJyk7XG4gICAgICAgIHNwYW4uY2xhc3NMaXN0LmFkZChodG1sQ2xhc3MpO1xuICAgICAgICByZXR1cm4gc3BhbjtcbiAgICB9XG5cbiAgICBjb25zdCBjcmVhdGVJbWFnZUVsZW1lbnQgPSAoc3JjLCBodG1sQ2xhc3MpID0+IHtcbiAgICAgICAgY29uc3QgaW1nID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnaW1nJyk7XG4gICAgICAgIGltZy5jbGFzc0xpc3QuYWRkKGh0bWxDbGFzcyk7XG4gICAgICAgIGltZy5zZXRBdHRyaWJ1dGUoJ3NyYycsIHNyYyk7XG4gICAgICAgIGltZy5zZXRBdHRyaWJ1dGUoJ2RyYWdnYWJsZScsICdmYWxzZScpO1xuICAgICAgICByZXR1cm4gaW1nO1xuICAgIH1cbiAgICBcbiAgICBjb25zdCBjcmVhdGVGb3JtID0gKCkgPT4ge1xuICAgICAgICBjb25zdCBpbnB1dEZvcm0gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdmb3JtJyk7XG4gICAgICAgIHJldHVybiBpbnB1dEZvcm07XG4gICAgfVxuXG4gICAgY29uc3QgY3JlYXRlSW5wdXRGaWVsZCA9IChwbGFjZWhvbGRlclRleHQpID0+IHtcbiAgICAgICAgY29uc3QgdXNlcklucHV0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnaW5wdXQnKTtcbiAgICAgICAgdXNlcklucHV0LnNldEF0dHJpYnV0ZSgndHlwZScsICd0ZXh0Jyk7XG4gICAgICAgIHVzZXJJbnB1dC5zZXRBdHRyaWJ1dGUoJ3BsYWNlaG9sZGVyJywgcGxhY2Vob2xkZXJUZXh0KTtcbiAgICAgICAgdXNlcklucHV0LnNldEF0dHJpYnV0ZSgnaWQnLCAndXNlci1pbnB1dCcpO1xuICAgICAgICB1c2VySW5wdXQucmVxdWlyZWQgPSB0cnVlO1xuXG4gICAgICAgIHJldHVybiB1c2VySW5wdXQ7XG4gICAgfVxuXG4gICAgY29uc3QgY3JlYXRlRGl2ID0gKGh0bWxDbGFzcykgPT4ge1xuICAgICAgICBjb25zdCBkaXYgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICAgICAgZGl2LnNldEF0dHJpYnV0ZSgnY2xhc3MnLCBodG1sQ2xhc3MpO1xuICAgICAgICByZXR1cm4gZGl2O1xuICAgIH1cblxuICAgIHJldHVybiB7Y3JlYXRlTGlzdEVsZW1lbnQsIGNyZWF0ZVNwYW5FbGVtZW50LCBjcmVhdGVJbWFnZUVsZW1lbnQsIGNyZWF0ZUlucHV0RmllbGQsIGNyZWF0ZUZvcm0sIGNyZWF0ZURpdn1cbn1cblxuY29uc3QgY3JlYXRlSWNvblNwYW4gPSAoKSA9PiB7XG4gICAgY29uc3QgdmlldyA9IGNyZWF0ZUVsZW1lbnRzKCk7XG5cbiAgICBjb25zdCBpY29uU3BhbiA9IHZpZXcuY3JlYXRlU3BhbkVsZW1lbnQoJ2ljb25zJyk7XG4gICAgY29uc3QgZWRpdEljb24gPSB2aWV3LmNyZWF0ZUltYWdlRWxlbWVudCgnaW1hZ2VzL2VkaXQtaWNvbi5zdmcnLCAnZWRpdC1pY29uJyk7XG4gICAgY29uc3QgZGVsZXRlSWNvbiA9IHZpZXcuY3JlYXRlSW1hZ2VFbGVtZW50KCdpbWFnZXMvZGVsZXRlLWljb24uc3ZnJywgJ2RlbGV0ZS1pY29uJyk7XG4gICAgXG4gICAgZWRpdEljb24uY2xhc3NMaXN0LmFkZCgnZWRpdC1wcm9qZWN0Jyk7XG4gICAgZGVsZXRlSWNvbi5jbGFzc0xpc3QuYWRkKCdkZWxldGUtcHJvamVjdCcpO1xuICAgIFxuICAgIGljb25TcGFuLmFwcGVuZChlZGl0SWNvbiwgZGVsZXRlSWNvbik7XG4gICAgXG4gICAgcmV0dXJuIGljb25TcGFuO1xufVxuXG5jb25zdCBhZGRQcm9qZWN0VG9TaWRlYmFyID0gKCkgPT4ge1xuICAgIGNvbnN0IHZpZXcgPSBjcmVhdGVFbGVtZW50cygpO1xuICAgIGNvbnN0IHByb2plY3RzQ29udGFpbmVyID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnByb2plY3QtbGlzdCcpO1xuXG4gICAgY29uc3QgcHJvamVjdExpc3RFbGVtZW50ID0gIHZpZXcuY3JlYXRlTGlzdEVsZW1lbnQoJ3Byb2plY3QtaXRlbScpO1xuICAgIFxuICAgIGNvbnN0IHByb2plY3RJbnB1dEZvcm0gPSB2aWV3LmNyZWF0ZUZvcm0oKTtcbiAgICBjb25zdCBwcm9qZWN0TmFtZUlucHV0ID0gdmlldy5jcmVhdGVJbnB1dEZpZWxkKCdQcm9qZWN0IG5hbWUuLi4nKTtcbiAgICBwcm9qZWN0SW5wdXRGb3JtLmFwcGVuZChwcm9qZWN0TmFtZUlucHV0KTtcblxuICAgIGNvbnN0IGljb25TcGFuID0gY3JlYXRlSWNvblNwYW4oKTtcbiAgICBwcm9qZWN0TGlzdEVsZW1lbnQuYXBwZW5kKHByb2plY3RJbnB1dEZvcm0sIGljb25TcGFuKTtcbiAgICBwcm9qZWN0c0NvbnRhaW5lci5pbnNlcnRCZWZvcmUocHJvamVjdExpc3RFbGVtZW50LCBwcm9qZWN0c0NvbnRhaW5lci5sYXN0RWxlbWVudENoaWxkKTtcblxuICAgIHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgICBwcm9qZWN0TmFtZUlucHV0LmZvY3VzKCk7XG4gICAgfSwgMCk7XG59XG5cbmNvbnN0IGFkZFByb2plY3RUb05vdGVwYWQgPSAocHJvamVjdElkKSA9PiB7XG4gICAgY29uc3QgdmlldyA9IGNyZWF0ZUVsZW1lbnRzKCk7XG4gICAgLy9jb25zdCBwcm9qZWN0TGlzdCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5wcm9qZWN0LWxpc3QnKTtcblxuICAgIGNvbnN0IHByb2plY3RzID0gdXBkYXRlU3RvcmFnZS5nZXRQcm9qZWN0cygpO1xuICAgIGNvbnN0IHByb2plY3RUb0FkZCA9IHByb2plY3RzLmZpbmQocHJvamVjdCA9PiBwcm9qZWN0LmlkID09IHByb2plY3RJZCk7XG4gICAgY29uc3QgcHJvamVjdE5hbWUgPSBwcm9qZWN0VG9BZGQucHJvamVjdE5hbWU7XG4gICAgLy9jb25zdCBjdXJyZW50UHJvamVjdE51bWJlciA9IHByb2plY3RMaXN0LmNoaWxkRWxlbWVudENvdW50IC0gMjtcbiAgICAvL2NvbnN0IHByb2plY3ROYW1lID0gcHJvamVjdExpc3QuY2hpbGRyZW5bY3VycmVudFByb2plY3ROdW1iZXJdLnRleHRDb250ZW50O1xuXG4gICAgY29uc3Qgbm90ZXBhZCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJyN3cml0aW5nLWFyZWEnKTtcbiAgICBjb25zdCBwcm9qZWN0RGl2ID0gdmlldy5jcmVhdGVEaXYoJ3Byb2plY3QnKTtcbiAgICBwcm9qZWN0RGl2LnNldEF0dHJpYnV0ZSgnZGF0YS1wcm9qZWN0LWlkJywgcHJvamVjdElkKTtcbiAgICBjb25zdCBza2lwTGluZSA9IHZpZXcuY3JlYXRlRGl2KCdza2lwLWxpbmUnKTtcbiAgICBcbiAgICBjb25zdCBwcm9qZWN0SGVhZGluZyA9IHZpZXcuY3JlYXRlRGl2KCdwcm9qZWN0LWhlYWRpbmcnKTtcbiAgICBjb25zdCBoMiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2gyJyk7XG4gICAgaDIuc2V0QXR0cmlidXRlKCdjbGFzcycsICdub3RlcGFkLXRleHQnKTtcbiAgICBoMi50ZXh0Q29udGVudCA9IHByb2plY3ROYW1lO1xuICAgIGNvbnN0IGgzID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnaDMnKTtcbiAgICBoMy5zZXRBdHRyaWJ1dGUoJ2NsYXNzJywgJ25vdGVwYWQtdGV4dCcpO1xuICAgIGgzLnRleHRDb250ZW50ID0gJ0R1ZSBEYXRlJztcbiAgICAgICAgXG4gICAgY29uc3QgdGFza3NDb250YWluZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCd1bCcpO1xuICAgIHRhc2tzQ29udGFpbmVyLmNsYXNzTGlzdC5hZGQoJ25vdGVwYWQtdGV4dCcsICd0b2RvcycpO1xuXG4gICAgY29uc3QgYWRkVGFza0xpc3RFbGVtZW50ID0gdmlldy5jcmVhdGVMaXN0RWxlbWVudCgndGFzaycpO1xuICAgIGNvbnN0IGFkZFRhc2tTcGFuID0gdmlldy5jcmVhdGVTcGFuRWxlbWVudCgnYWRkLXRhc2snKTtcbiAgICBjb25zdCBhZGRJY29uID0gdmlldy5jcmVhdGVJbWFnZUVsZW1lbnQoJ2ltYWdlcy9hZGQtaWNvbi5zdmcnLCAnYWRkLWljb24nKTtcbiAgICBhZGRUYXNrU3Bhbi5hcHBlbmQoYWRkSWNvbiwgJ0FkZCBUYXNrJyk7XG5cbiAgICBhZGRUYXNrTGlzdEVsZW1lbnQuYXBwZW5kKGFkZFRhc2tTcGFuKTtcbiAgICB0YXNrc0NvbnRhaW5lci5hcHBlbmQoYWRkVGFza0xpc3RFbGVtZW50LCBza2lwTGluZSk7XG4gICAgcHJvamVjdEhlYWRpbmcuYXBwZW5kKGgyLCBoMyk7XG4gICAgcHJvamVjdERpdi5hcHBlbmQocHJvamVjdEhlYWRpbmcsIHRhc2tzQ29udGFpbmVyKTtcbiAgICBub3RlcGFkLmFwcGVuZChwcm9qZWN0RGl2KTtcbn1cblxuLy8gY3JlYXRlcyBIVE1MIGZvciBwcm9qZWN0IGl0ZW1zIGluIHNpZGViYXIgZnJvbSBsb2NhbFN0b3JhZ2UgaXRlbVxuY29uc3QgX2NyZWF0ZVByb2plY3RJdGVtSFRNTCA9IChpZCwgbmFtZSkgPT4ge1xuICAgIGNvbnN0IHZpZXcgPSBjcmVhdGVFbGVtZW50cygpO1xuXG4gICAgY29uc3QgcHJvamVjdEl0ZW0gPSB2aWV3LmNyZWF0ZUxpc3RFbGVtZW50KCdwcm9qZWN0LWl0ZW0nKTtcbiAgICBwcm9qZWN0SXRlbS5zZXRBdHRyaWJ1dGUoJ2RhdGEtcHJvamVjdC1pZCcsIGlkKTtcbiAgICBjb25zdCBwcm9qZWN0TmFtZSA9IHZpZXcuY3JlYXRlU3BhbkVsZW1lbnQoJ3Byb2plY3QtbmFtZScpO1xuICAgIHByb2plY3ROYW1lLnRleHRDb250ZW50ID0gbmFtZTtcbiAgICBjb25zdCBpY29uU3BhbiA9IGNyZWF0ZUljb25TcGFuKCk7XG5cbiAgICBwcm9qZWN0SXRlbS5hcHBlbmQocHJvamVjdE5hbWUsIGljb25TcGFuKTtcblxuICAgIHJldHVybiBwcm9qZWN0SXRlbTtcbn1cbi8vIFVwZGF0ZXMgcHJvamVjdCBsaXN0IGluIHRoZSBzaWRlYmFyIFxuY29uc3QgdXBkYXRlUHJvamVjdExpc3QgPSAocHJvamVjdHMpID0+IHtcbiAgICBjb25zdCBwcm9qZWN0c0xpc3RDb250YWluZXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcucHJvamVjdC1saXN0Jyk7XG4gICAgY29uc3QgYWRkUHJvamVjdEJ0biA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJ1tkYXRhLWFkZC1wcm9qZWN0XScpO1xuICAgIFxuICAgIC8vIENsZWFyIGFsbCBlbGVtZW50cyBvZiBjbGFzcyAnLnByb2plY3QtaXRlbSdcbiAgICBjb25zdCBwcm9qZWN0c0FycmF5ID0gW10uc2xpY2UuY2FsbChwcm9qZWN0c0xpc3RDb250YWluZXIuY2hpbGRyZW4pO1xuICAgIHByb2plY3RzQXJyYXkuZm9yRWFjaChpdGVtID0+IHtcbiAgICAgICAgaWYgKGl0ZW0uY2xhc3NMaXN0LmNvbnRhaW5zKCdwcm9qZWN0LWl0ZW0nKSkgaXRlbS5yZW1vdmUoKTtcbiAgICB9KTtcblxuICAgIGZvciAoY29uc3QgcHJvamVjdCBvZiBwcm9qZWN0cykge1xuICAgICAgICBjb25zdCBodG1sID0gX2NyZWF0ZVByb2plY3RJdGVtSFRNTChwcm9qZWN0LmlkLCBwcm9qZWN0LnByb2plY3ROYW1lKTtcbiAgICAgICAgcHJvamVjdHNMaXN0Q29udGFpbmVyLmluc2VydEJlZm9yZShodG1sLCBhZGRQcm9qZWN0QnRuKTtcbiAgICB9XG5cbiAgICAvLyBBZGQgbGlzdGVuZXJzIGZvciBlZGl0LCBkZWxldGUgPz8/P1xuICAgIHByb2plY3RzTGlzdENvbnRhaW5lci5xdWVyeVNlbGVjdG9yQWxsKCcucHJvamVjdC1pdGVtJykuZm9yRWFjaChwcm9qZWN0SXRlbSA9PiB7XG4gICAgICAgIHByb2plY3RJdGVtLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4ge1xuICAgICAgICAgICAgaGFuZGxlcnMub25Qcm9qZWN0U2VsZWN0KHByb2plY3RJdGVtLmRhdGFzZXQucHJvamVjdElkKTtcbiAgICAgICAgfSk7XG4gICAgfSk7XG59XG5cbmNvbnN0IGxvYWRBbGxQcm9qZWN0cyA9IChwcm9qZWN0cykgPT4ge1xuICAgIHByb2plY3RzLmZvckVhY2gocHJvamVjdCA9PiB7XG4gICAgICAgIGFkZFByb2plY3RUb05vdGVwYWQocHJvamVjdC5pZCk7XG4gICAgfSk7XG59XG5cbmNvbnN0IHVwZGF0ZUFjdGl2ZVRhYiA9ICh0YWIpID0+IHtcbiAgICAvLyBmb3IgYWxsIG90aGVyIHByb2plY3RzLCBjaGFuZ2UgZGlzcGxheSB0byBub25lLCB0byBicmluZyBiYWNrIHNldCBkaXNwbGF5IHRvIGNvbnRlbnRzICBcbiAgICAgICAgLy8gaXRlbS5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnXG4gICAgLy8gcmVtb3ZlIGFjdGl2ZSBjbGFzcyBmcm9tIGFueSBvdGhlciBzaWRlYmFyIGVsZW1lbnRcbiAgICBjb25zdCBjdXJyZW50QWN0aXZlVGFiID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLmFjdGl2ZScpO1xuICAgIGlmIChjdXJyZW50QWN0aXZlVGFiKSBjdXJyZW50QWN0aXZlVGFiLmNsYXNzTGlzdC5yZW1vdmUoJ2FjdGl2ZScpO1xuICAgIHRhYi5jbGFzc0xpc3QuYWRkKCdhY3RpdmUnKTtcbiAgICBjb25zdCBwcm9qZWN0TmFtZVNwYW4gPSB0YWIuY2hpbGRyZW4uaXRlbSgwKTsgLy8gVXBkYXRlIG5vdGVwYWQgaGVyZT9cbiAgICAvL2NvbnNvbGUubG9nKHByb2plY3ROYW1lU3Bhbik7XG59XG5cbmV4cG9ydCB7IGFkZFByb2plY3RUb1NpZGViYXIsIGFkZFByb2plY3RUb05vdGVwYWQsIGNyZWF0ZUVsZW1lbnRzLCB1cGRhdGVQcm9qZWN0TGlzdCwgdXBkYXRlQWN0aXZlVGFiLCBsb2FkQWxsUHJvamVjdHMgfTsiLCJpbXBvcnQgeyBhZGRQcm9qZWN0VG9TaWRlYmFyLCBhZGRQcm9qZWN0VG9Ob3RlcGFkLCBjcmVhdGVFbGVtZW50cyB9IGZyb20gXCIuL2NyZWF0ZURPTUVsZW1lbnRzXCI7XG5pbXBvcnQgaGFuZGxlcnMgZnJvbSBcIi4vaGFuZGxlcnNcIjtcbmltcG9ydCB1cGRhdGVTdG9yYWdlIGZyb20gXCIuL3N0b3JhZ2VcIlxuXG5jb25zdCBhd2FpdGluZ0lucHV0ID0gKCkgPT4ge1xuICAgIGNvbnN0IHVzZXJJbnB1dCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJyN1c2VyLWlucHV0Jyk7XG4gICAgaWYgKHVzZXJJbnB1dCAhPSBudWxsKSByZXR1cm4gdHJ1ZTtcblxuICAgIHJldHVybiBmYWxzZTtcbn1cblxuY29uc3QgaGFuZGxlVXNlcklucHV0ID0gKCkgPT4geyBcbiAgICAvLyBUaGlzIGlzIERPTSBTdHVmZlxuICAgIGNvbnN0IHVzZXJJbnB1dCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJyN1c2VyLWlucHV0JylcbiAgICBjb25zdCBpbnB1dEZvcm0gPSB1c2VySW5wdXQucGFyZW50RWxlbWVudDtcbiAgICBjb25zdCBwcm9qZWN0SXRlbSA9IGlucHV0Rm9ybS5wYXJlbnRFbGVtZW50O1xuICAgIGNvbnN0IHByb2plY3RTcGFuID0gY3JlYXRlRWxlbWVudHMoKS5jcmVhdGVTcGFuRWxlbWVudCgncHJvamVjdC1uYW1lJyk7XG4gICAgXG4gICAgY29uc3QgcHJvamVjdE5hbWUgPSB1c2VySW5wdXQudmFsdWUudHJpbSgpO1xuICAgIGlmICghcHJvamVjdE5hbWUpIHJldHVybjtcblxuICAgIHByb2plY3RTcGFuLnRleHRDb250ZW50ID0gcHJvamVjdE5hbWU7XG4gICAgdXNlcklucHV0LnBhcmVudEVsZW1lbnQucmVtb3ZlKCk7XG4gICAgcHJvamVjdEl0ZW0uaW5zZXJ0QmVmb3JlKHByb2plY3RTcGFuLCBwcm9qZWN0SXRlbS5jaGlsZE5vZGVzWzBdKTsgXG59XG5cbmNvbnN0IGFkZFByb2plY3QgPSAoKSA9PiB7XG4gICAgaWYgKGF3YWl0aW5nSW5wdXQoKSkgcmV0dXJuO1xuICAgIGFkZFByb2plY3RUb1NpZGViYXIoKTtcbiAgICBcbiAgICBjb25zdCB1c2VySW5wdXQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcjdXNlci1pbnB1dCcpO1xuICAgIGNvbnN0IGlucHV0Rm9ybSA9IHVzZXJJbnB1dC5wYXJlbnRFbGVtZW50O1xuICAgIGNvbnN0IHByb2plY3RJdGVtID0gaW5wdXRGb3JtLnBhcmVudEVsZW1lbnQ7XG5cbiAgICB1c2VySW5wdXQuYWRkRXZlbnRMaXN0ZW5lcignYmx1cicsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgaWYgKHVzZXJJbnB1dC52YWx1ZS50cmltKCkgPT0gJycpIHtcbiAgICAgICAgICAgIHByb2plY3RJdGVtLnJlbW92ZSgpO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGhhbmRsZVVzZXJJbnB1dCgpO1xuXG4gICAgICAgIGNvbnN0IHByb2plY3ROYW1lID0gcHJvamVjdEl0ZW0uZmlyc3RFbGVtZW50Q2hpbGQudGV4dENvbnRlbnQ7XG4gICAgICAgIGhhbmRsZXJzLm9uUHJvamVjdEFkZChwcm9qZWN0TmFtZSk7IFxuXG4gICAgICAgIGNvbnN0IHByb2plY3RMaXN0ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnByb2plY3QtbGlzdCcpO1xuICAgICAgICAvLyBTZWxlY3QgbGFzdCBwcm9qZWN0IGFkZGVkIGFuZCBnZXQgaWQgYXR0cmlidXRlXG4gICAgICAgIGNvbnN0IHByb2plY3RJZCA9IHByb2plY3RMaXN0LmNoaWxkcmVuW3Byb2plY3RMaXN0LmNoaWxkRWxlbWVudENvdW50IC0gMl0uZ2V0QXR0cmlidXRlKCdkYXRhLXByb2plY3QtaWQnKTtcbiAgICAgICAgaWYgKCFhd2FpdGluZ0lucHV0KCkpIGFkZFByb2plY3RUb05vdGVwYWQocHJvamVjdElkKTtcbiAgICB9KTtcblxuICAgIGlucHV0Rm9ybS5hZGRFdmVudExpc3RlbmVyKCdzdWJtaXQnLCBmdW5jdGlvbiAoZSkge1xuICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgIGhhbmRsZVVzZXJJbnB1dCgpO1xuICAgICAgICBjb25zdCBwcm9qZWN0TmFtZSA9IHByb2plY3RJdGVtLmZpcnN0RWxlbWVudENoaWxkLnRleHRDb250ZW50O1xuICAgICAgICBoYW5kbGVycy5vblByb2plY3RBZGQocHJvamVjdE5hbWUpOyBcbiAgICAgICAgY29uc3QgcHJvamVjdExpc3QgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcucHJvamVjdC1saXN0Jyk7XG4gICAgICAgIGNvbnN0IHByb2plY3RJZCA9IHByb2plY3RMaXN0LmNoaWxkcmVuW3Byb2plY3RMaXN0LmNoaWxkRWxlbWVudENvdW50IC0gMl0uZ2V0QXR0cmlidXRlKCdkYXRhLXByb2plY3QtaWQnKTtcbiAgICAgICAgaWYgKCFhd2FpdGluZ0lucHV0KCkpIGFkZFByb2plY3RUb05vdGVwYWQocHJvamVjdElkKTtcbiAgICB9KTtcbn1cbmNvbnN0IGRlbGV0ZVByb2plY3QgPSAoKSA9PiB7XG4gICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoZSkgPT4ge1xuICAgICAgICBpZiAoZS50YXJnZXQuY2xvc2VzdCgnLmRlbGV0ZS1wcm9qZWN0JykpIHtcbiAgICAgICAgICAgIGNvbnN0IHByb2plY3RJdGVtID0gZS50YXJnZXQuY2xvc2VzdCgnLnByb2plY3QtaXRlbScpXG4gICAgICAgICAgICBwcm9qZWN0SXRlbS5yZW1vdmUoKTtcbiAgICAgICAgICAgIGNvbnN0IHByb2plY3RJZCA9IHByb2plY3RJdGVtLmRhdGFzZXQucHJvamVjdElkO1xuICAgICAgICAgICAgdXBkYXRlU3RvcmFnZS5kZWxldGVQcm9qZWN0KHByb2plY3RJZCk7XG4gICAgICAgIH1cbiAgICB9KTtcbiAgICAvLyBUT0RPOiBSZW1vdmUgcHJvamVjdCBmcm9tIG5vdGVwYWQgYnkgcmVsb2FkaW5nIGxvY2FsU3RvcmFnZSBpdGVtcyBmb3IgY3VycmVudCBzZWxlY3RlZCB0YWIgKGkuZS4gVG9kYXkpLiBJZiBjdXJyZW50IHNlbGVjdCB0YWIgaXMgdGhlIG9uZSB0aGF0IGlzIGRlbGV0ZWQgbG9hZCBub3RlcGFkIHdpdGggSG9tZSB0YWIgXG59XG5cbi8vIFRPRE86IGNyZWF0ZSBmdW5jdGlvbiB0byB1cGRhdGUgcHJvamVjdCBuYW1lIG9uIG5vdGVwYWQgd2hlbiB1c2VyIGVkaXRzIGl0XG4gXG5jb25zdCBlZGl0UHJvamVjdCA9IChlKSA9PiB7XG4gICAgaWYgKGF3YWl0aW5nSW5wdXQoKSkgcmV0dXJuO1xuICAgIFxuICAgIC8vIFRoaXMgaXMgRE9NIFN0dWZmXG4gICAgY29uc3QgaW5wdXRGb3JtID0gY3JlYXRlRWxlbWVudHMoKS5jcmVhdGVGb3JtKCk7XG4gICAgY29uc3QgaW5wdXRGaWVsZCA9IGNyZWF0ZUVsZW1lbnRzKCkuY3JlYXRlSW5wdXRGaWVsZCgnUHJvamVjdCBuYW1lLi4uJyk7XG4gICAgY29uc3QgcHJvamVjdE5hbWUgPSBlLnRhcmdldC5wYXJlbnRFbGVtZW50LnByZXZpb3VzRWxlbWVudFNpYmxpbmc7XG5cbiAgICBpbnB1dEZpZWxkLnZhbHVlID0gcHJvamVjdE5hbWUudGV4dENvbnRlbnQ7XG4gICAgcHJvamVjdE5hbWUucmVtb3ZlKCk7XG4gICAgaW5wdXRGb3JtLmFwcGVuZChpbnB1dEZpZWxkKTtcbiAgICBcbiAgICBjb25zdCBwcm9qZWN0SXRlbSA9IGUudGFyZ2V0LmNsb3Nlc3QoJy5wcm9qZWN0LWl0ZW0nKTtcbiAgICBwcm9qZWN0SXRlbS5pbnNlcnRCZWZvcmUoaW5wdXRGb3JtLCBwcm9qZWN0SXRlbS5jaGlsZE5vZGVzWzBdKTtcbiAgICBcbiAgICBjb25zdCB1c2VySW5wdXQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcjdXNlci1pbnB1dCcpO1xuICAgIHVzZXJJbnB1dC5mb2N1cygpO1xuICAgIFxuICAgIGNvbnN0IHByb2plY3RJZCA9IHByb2plY3RJdGVtLmRhdGFzZXQucHJvamVjdElkO1xuXG4gICAgdXNlcklucHV0LmFkZEV2ZW50TGlzdGVuZXIoJ2JsdXInLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGlmICh1c2VySW5wdXQudmFsdWUgIT0gJycpIGhhbmRsZVVzZXJJbnB1dCgpO1xuICAgICAgICAvL2lmICghYXdhaXRpbmdJbnB1dCgpKSBlZGl0UHJvamVjdE9uTm90ZXBhZCgpO1xuICAgICAgICBjb25zdCBwcm9qZWN0TmFtZSA9IHByb2plY3RJdGVtLmZpcnN0RWxlbWVudENoaWxkLnRleHRDb250ZW50O1xuICAgICAgICB1cGRhdGVOYW1lT25Ob3RlcGFkKHByb2plY3RJZCwgcHJvamVjdE5hbWUpO1xuICAgICAgICBoYW5kbGVycy5vblByb2plY3ROYW1lRWRpdChwcm9qZWN0SWQsIHByb2plY3ROYW1lKTtcbiAgICB9KTtcblxuICAgIGlucHV0Rm9ybS5hZGRFdmVudExpc3RlbmVyKCdzdWJtaXQnLCBmdW5jdGlvbiAoZSkge1xuICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgIGhhbmRsZVVzZXJJbnB1dCgpO1xuICAgICAgICAvL2lmICghYXdhaXRpbmdJbnB1dCgpKSBlZGl0UHJvamVjdE9uTm90ZXBhZCgpO1xuICAgICAgICBjb25zdCBwcm9qZWN0TmFtZSA9IHByb2plY3RJdGVtLmZpcnN0RWxlbWVudENoaWxkLnRleHRDb250ZW50O1xuICAgICAgICB1cGRhdGVOYW1lT25Ob3RlcGFkKHByb2plY3RJZCwgcHJvamVjdE5hbWUpO1xuICAgICAgICBoYW5kbGVycy5vblByb2plY3ROYW1lRWRpdChwcm9qZWN0SWQsIHByb2plY3ROYW1lKTtcbiAgICB9KTtcblxuICAgIGNvbnN0IHVwZGF0ZU5hbWVPbk5vdGVwYWQgPSAocHJvamVjdElkLCBwcm9qZWN0TmFtZSkgPT4ge1xuICAgICAgICBjb25zdCBub3RlcGFkID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLm5vdGVwYWQnKTtcbiAgICAgICAgY29uc3QgcHJvamVjdFRhc2tzQ29udGFpbmVyID0gbm90ZXBhZC5xdWVyeVNlbGVjdG9yKGBbZGF0YS1wcm9qZWN0LWlkPVwiJHtwcm9qZWN0SWR9XCJdYCk7XG4gICAgICAgIGlmIChwcm9qZWN0VGFza3NDb250YWluZXIpIHtcbiAgICAgICAgICAgIHByb2plY3RUYXNrc0NvbnRhaW5lci5jaGlsZE5vZGVzWzBdLmNoaWxkTm9kZXNbMF0udGV4dENvbnRlbnQgPSBwcm9qZWN0TmFtZTtcbiAgICAgICAgfVxuICAgIH1cbn1cblxuZXhwb3J0IHsgXG4gICAgYWRkUHJvamVjdCxcbiAgICBkZWxldGVQcm9qZWN0LFxuICAgIGVkaXRQcm9qZWN0XG59IiwiaW1wb3J0IHtjcmVhdGVFbGVtZW50c30gZnJvbSBcIi4vY3JlYXRlRE9NRWxlbWVudHNcIjtcbmltcG9ydCB7Zm9ybWF0fSBmcm9tIFwiZGF0ZS1mbnNcIjtcbmltcG9ydCBoYW5kbGVycyBmcm9tIFwiLi9oYW5kbGVyc1wiO1xuaW1wb3J0IHVwZGF0ZVN0b3JhZ2UgZnJvbSBcIi4vc3RvcmFnZVwiO1xuXG5jb25zdCB0b2dnbGVUYXNrID0gKHRhc2tFbGVtZW50KSA9PiB7XG4gICAgdGFza0VsZW1lbnQuY2xhc3NMaXN0LnRvZ2dsZSgnY29tcGxldGVkJyk7XG4gICAgbGV0IGlzQ29tcGxldGUgPSBmYWxzZTtcblxuICAgIGlmICh0YXNrRWxlbWVudC5jbGFzc0xpc3QuY29udGFpbnMoJ2NvbXBsZXRlZCcpKSB7XG4gICAgICAgIGlzQ29tcGxldGUgPSB0cnVlO1xuICAgIH1cbiAgICBjb25zdCBwcm9qZWN0SWQgPSB0YXNrRWxlbWVudC5jbG9zZXN0KCcucHJvamVjdCcpLmRhdGFzZXQucHJvamVjdElkO1xuICAgIGNvbnN0IHRhc2tJZCA9IHRhc2tFbGVtZW50LmRhdGFzZXQudGFza0lkO1xuXG4gICAgcmV0dXJuIGhhbmRsZXJzLm9uVGFza0NvbXBsZXRlRWRpdChwcm9qZWN0SWQsIHRhc2tJZCwgaXNDb21wbGV0ZSk7XG59XG5cbmNvbnN0IGFkZFRhc2tUb0RPTSA9IChhZGRUYXNrQnRuKSA9PiB7XG4gICAgaWYgKGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd1c2VyLWlucHV0JykpIHJldHVybjtcbiAgICBjb25zdCB0YXNrTGlzdEVsZW1lbnQgPSBjcmVhdGVFbGVtZW50cygpLmNyZWF0ZUxpc3RFbGVtZW50KCd0YXNrJyk7XG4gICAgY29uc3QgdGFza1NwYW4gPSBjcmVhdGVFbGVtZW50cygpLmNyZWF0ZVNwYW5FbGVtZW50KCd0YXNrLWl0ZW0nKTtcbiAgICBjb25zdCBpbnB1dEZvcm0gPSBjcmVhdGVFbGVtZW50cygpLmNyZWF0ZUZvcm0oKTtcbiAgICBjb25zdCBpbnB1dEZpZWxkID0gY3JlYXRlRWxlbWVudHMoKS5jcmVhdGVJbnB1dEZpZWxkKCdFbnRlciBUYXNrLi4uJyk7XG4gICAgXG4gICAgaW5wdXRGb3JtLmFwcGVuZChpbnB1dEZpZWxkKTtcbiAgICB0YXNrU3Bhbi5hcHBlbmQoaW5wdXRGb3JtKTtcblxuICAgIGNvbnN0IGljb25TcGFuID0gY3JlYXRlRWxlbWVudHMoKS5jcmVhdGVTcGFuRWxlbWVudCgnaWNvbnMnKTtcbiAgICBjb25zdCBlZGl0SWNvbiA9IGNyZWF0ZUVsZW1lbnRzKCkuY3JlYXRlSW1hZ2VFbGVtZW50KCdpbWFnZXMvZWRpdC1pY29uLnN2ZycsICdlZGl0LWljb24nKTtcbiAgICBjb25zdCBkZWxldGVJY29uID0gY3JlYXRlRWxlbWVudHMoKS5jcmVhdGVJbWFnZUVsZW1lbnQoJ2ltYWdlcy9kZWxldGUtaWNvbi5zdmcnLCAnZGVsZXRlLWljb24nKTtcblxuICAgIGVkaXRJY29uLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4ge1xuICAgICAgICBpZiAodGFza0xpc3RFbGVtZW50LmNsYXNzTGlzdC5jb250YWlucygnY29tcGxldGVkJykpIHJldHVybjtcbiAgICAgICAgY29uc3QgdGFza1RleHRTcGFuID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnRhc2stdGV4dCcpO1xuICAgICAgICBjb25zdCB0YXNrTmFtZSA9IHRhc2tUZXh0U3Bhbi50ZXh0Q29udGVudDtcbiAgICAgICAgdGFza1RleHRTcGFuLnJlbW92ZSgpO1xuICAgICAgICBcbiAgICAgICAgY29uc3QgaW5wdXRGb3JtID0gY3JlYXRlRWxlbWVudHMoKS5jcmVhdGVGb3JtKCk7XG4gICAgICAgIGNvbnN0IGlucHV0RmllbGQgPSBjcmVhdGVFbGVtZW50cygpLmNyZWF0ZUlucHV0RmllbGQoJ0VudGVyIFRhc2suLi4nKTtcblxuICAgICAgICBpbnB1dEZpZWxkLnZhbHVlID0gdGFza05hbWU7XG4gICAgICAgIFxuICAgICAgICBpbnB1dEZvcm0uYXBwZW5kKGlucHV0RmllbGQpO1xuICAgICAgICB0YXNrU3Bhbi5pbnNlcnRCZWZvcmUoaW5wdXRGb3JtLCBpY29uU3Bhbik7XG4gICAgICAgIHRhc2tMaXN0RWxlbWVudC5wcmVwZW5kKHRhc2tTcGFuKTtcbiAgICAgICAgaW5wdXRGaWVsZC5mb2N1cygpO1xuICAgICAgICBhZGRUYXNrKCk7XG4gICAgfSk7XG5cbiAgICBkZWxldGVJY29uLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKGUpID0+IHtcbiAgICAgICAgY29uc3QgcHJvamVjdElkID0gZS50YXJnZXQuY2xvc2VzdCgnW2RhdGEtcHJvamVjdC1pZF0nKS5kYXRhc2V0LnByb2plY3RJZDtcbiAgICAgICAgY29uc3QgdGFza0lkID0gZS50YXJnZXQuY2xvc2VzdCgnW2RhdGEtdGFzay1pZF0nKS5kYXRhc2V0LnRhc2tJZDtcblxuICAgICAgICB0YXNrTGlzdEVsZW1lbnQucmVtb3ZlKCk7XG4gICAgICAgIHVwZGF0ZVN0b3JhZ2UuZGVsZXRlVGFzayhwcm9qZWN0SWQsIHRhc2tJZCk7XG4gICAgfSk7XG5cbiAgICBpY29uU3Bhbi5hcHBlbmQoZWRpdEljb24sIGRlbGV0ZUljb24pO1xuICAgIHRhc2tTcGFuLmFwcGVuZChpY29uU3Bhbik7XG4gICAgY29uc3QgZHVlRGF0ZSA9IGFkZER1ZURhdGVUb0RPTSgpO1xuICAgIHRhc2tMaXN0RWxlbWVudC5hcHBlbmQodGFza1NwYW4sIGR1ZURhdGUpO1xuICAgIFxuICAgIGNvbnN0IGNvbnRhaW5lciA9IGFkZFRhc2tCdG4uY2xvc2VzdCgnLnRvZG9zJyk7XG4gICAgY29uc3QgbnVtYmVyT2ZUYXNrcyA9IGNvbnRhaW5lci5jaGlsZEVsZW1lbnRDb3VudCAtIDI7XG5cbiAgICBjb250YWluZXIuaW5zZXJ0QmVmb3JlKHRhc2tMaXN0RWxlbWVudCwgY29udGFpbmVyLmNoaWxkcmVuW251bWJlck9mVGFza3NdKTtcblxuICAgIHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgICBpbnB1dEZpZWxkLmZvY3VzKCk7XG4gICAgfSwgMCk7XG5cbiAgICByZXR1cm4gdGFza1NwYW47XG59XG5cbmNvbnN0IGFkZER1ZURhdGVUb0RPTSA9ICgpID0+IHtcbiAgICBjb25zdCBkdWVEYXRlU3BhbiA9IGNyZWF0ZUVsZW1lbnRzKCkuY3JlYXRlU3BhbkVsZW1lbnQoJ2R1ZS1kYXRlJyk7XG5cbiAgICBjb25zdCBwcmlvcml0eUljb24gPSBjcmVhdGVFbGVtZW50cygpLmNyZWF0ZUltYWdlRWxlbWVudCgnaW1hZ2VzL3ByaW9yaXR5LWljb24uc3ZnJywgJ3ByaW9yaXR5LWljb24nKVxuICAgIHByaW9yaXR5SWNvbi5jbGFzc0xpc3QuYWRkKCdwcmlvcml0eS1sb3cnKTtcbiAgICBcbiAgICBjb25zdCBkYXRlTGFiZWwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdsYWJlbCcpO1xuICAgIGRhdGVMYWJlbC5jbGFzc0xpc3QuYWRkKCdkYXRlLWxhYmVsJyk7XG4gICAgXG4gICAgY29uc3QgZGF0ZUlucHV0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnaW5wdXQnKTtcbiAgICBkYXRlSW5wdXQuc2V0QXR0cmlidXRlKCd0eXBlJywgJ2RhdGUnKTtcbiAgICBkYXRlSW5wdXQucmVxdWlyZWQgPSB0cnVlO1xuXG4gICAgY29uc3QgY2FsZW5kYXJJY29uID0gY3JlYXRlRWxlbWVudHMoKS5jcmVhdGVJbWFnZUVsZW1lbnQoJ2ltYWdlcy9jYWxlbmRhci1pY29uLnN2ZycsICdjYWxlbmRhci1pY29uJyk7XG5cbiAgICBkYXRlTGFiZWwuYXBwZW5kKGRhdGVJbnB1dCwgY2FsZW5kYXJJY29uKTtcbiAgICBkdWVEYXRlU3Bhbi5hcHBlbmQocHJpb3JpdHlJY29uLCBkYXRlTGFiZWwpO1xuICAgIFxuICAgIC8vIHVwZGF0ZSBsb2NhbFN0b3JhZ2Ugb24gZHVlIGRhdGUgY2hhbmdlXG4gICAgZGF0ZUlucHV0LmFkZEV2ZW50TGlzdGVuZXIoJ2NoYW5nZScsICgpID0+IHtcbiAgICAgICAgY29uc3QgcHJvamVjdElkID0gZGF0ZUlucHV0LmNsb3Nlc3QoWycucHJvamVjdCddKS5kYXRhc2V0LnByb2plY3RJZDtcbiAgICAgICAgY29uc3QgdGFza0lkID0gZGF0ZUlucHV0LmNsb3Nlc3QoJ1tkYXRhLXRhc2staWQnKS5kYXRhc2V0LnRhc2tJZDtcbiAgICAgICAgY29uc3QgbmV3RHVlRGF0ZSA9IGRhdGVJbnB1dC52YWx1ZTtcblxuICAgICAgICByZXR1cm4gaGFuZGxlcnMub25UYXNrRHVlRGF0ZUVkaXQocHJvamVjdElkLCB0YXNrSWQsIG5ld0R1ZURhdGUpO1xuICAgIH0pO1xuXG4gICAgcmV0dXJuIGR1ZURhdGVTcGFuO1xufVxuXG5cblxuY29uc3QgYWRkVGFzayA9ICgpID0+IHtcbiAgICBjb25zdCBpbnB1dEZpZWxkID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignI3VzZXItaW5wdXQnKTtcbiAgICBjb25zdCBpbnB1dEZvcm0gPSBpbnB1dEZpZWxkLnBhcmVudEVsZW1lbnQ7XG4gICAgY29uc3QgdGFza0NvbnRhaW5lciA9IGlucHV0Rm9ybS5wYXJlbnRFbGVtZW50LnBhcmVudEVsZW1lbnQ7XG4gICAgXG4gICAgaW5wdXRGaWVsZC5hZGRFdmVudExpc3RlbmVyKCdibHVyJywgZnVuY3Rpb24gKCkge1xuICAgICAgICBjb25zdCBwcm9qZWN0SWQgPSB0YXNrQ29udGFpbmVyLmNsb3Nlc3QoJ1tkYXRhLXByb2plY3QtaWRdJykuZGF0YXNldC5wcm9qZWN0SWQ7XG4gICAgICAgIGNvbnN0IHRhc2sgPSBpbnB1dEZpZWxkLnZhbHVlO1xuICAgICAgICB2YWxpZGF0ZVVzZXJJbnB1dCgpO1xuICAgICAgICBpZiAodGFzaykgY3JlYXRlVGFzayh0YXNrLCBwcm9qZWN0SWQsIHRhc2tDb250YWluZXIpO1xuICAgIH0pO1xuICAgIFxuICAgIGlucHV0Rm9ybS5hZGRFdmVudExpc3RlbmVyKCdzdWJtaXQnLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgY29uc3QgcHJvamVjdElkID0gdGFza0NvbnRhaW5lci5jbG9zZXN0KCdbZGF0YS1wcm9qZWN0LWlkXScpLmRhdGFzZXQucHJvamVjdElkO1xuICAgICAgICBjb25zdCB0YXNrID0gaW5wdXRGaWVsZC52YWx1ZTtcbiAgICAgICAgdmFsaWRhdGVVc2VySW5wdXQoKTtcbiAgICAgICAgaWYgKHRhc2spIGNyZWF0ZVRhc2sodGFzaywgcHJvamVjdElkLCB0YXNrQ29udGFpbmVyKTtcbiAgICB9KTtcbn1cblxuY29uc3QgY3JlYXRlVGFzayA9ICh0YXNrLCBwcm9qZWN0SWQsIHRhc2tDb250YWluZXIpID0+IHtcbiAgICBpZiAodGFza0NvbnRhaW5lci5kYXRhc2V0LnRhc2tJZCkge1xuICAgICAgICByZXR1cm4gaGFuZGxlcnMub25UYXNrTmFtZUVkaXQocHJvamVjdElkLCB0YXNrQ29udGFpbmVyLmRhdGFzZXQudGFza0lkLCB0YXNrKTtcbiAgICB9XG4gICAgY29uc3QgdGFza09iaiA9IGhhbmRsZXJzLm9uVGFza0FkZCh0YXNrLCBwcm9qZWN0SWQpO1xuICAgIHRhc2tDb250YWluZXIuc2V0QXR0cmlidXRlKCdkYXRhLXRhc2staWQnLCB0YXNrT2JqLnRhc2tJZCk7XG59XG5cbmNvbnN0IHZhbGlkYXRlVXNlcklucHV0ID0gKCkgPT4ge1xuICAgIGNvbnN0IGlucHV0RmllbGQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcjdXNlci1pbnB1dCcpO1xuICAgIGNvbnN0IGlucHV0Rm9ybSA9IGlucHV0RmllbGQucGFyZW50RWxlbWVudDtcbiAgICBjb25zdCB0YXNrSXRlbSA9IGlucHV0Rm9ybS5wYXJlbnRFbGVtZW50O1xuICAgIGNvbnN0IHRhc2tDb250YWluZXIgPSB0YXNrSXRlbS5wYXJlbnRFbGVtZW50O1xuXG4gICAgY29uc3QgdXNlcklucHV0ID0gaW5wdXRGaWVsZC52YWx1ZS50cmltKCk7XG4gICAgY29uc3QgdGFza1RleHRTcGFuID0gY3JlYXRlRWxlbWVudHMoKS5jcmVhdGVTcGFuRWxlbWVudCgndGFzay10ZXh0Jyk7XG4gICAgdGFza1RleHRTcGFuLmFwcGVuZCh1c2VySW5wdXQpO1xuXG4gICAgLy8gUmVtb3ZlcyB0YXNrIGNvbnRhaW5lciBpZiB0YXNrIGlzbid0IHlldCBpbiBsb2NhbFN0b3JhZ2UgKGhhcyBhIHRhc2tJZCBkYXRhIGF0dHJpYnV0ZSlcbiAgICBpZiAodXNlcklucHV0ID09ICcnICYmICF0YXNrQ29udGFpbmVyLmRhdGFzZXQudGFza0lkKSB7XG4gICAgICAgIHRhc2tDb250YWluZXIucmVtb3ZlKCk7XG4gICAgICAgIHJldHVybjtcbiAgICB9IFxuICAgIGVsc2UgaWYgKHVzZXJJbnB1dCA9PSAnJyAmJiB0YXNrQ29udGFpbmVyLmRhdGFzZXQudGFza0lkKSByZXR1cm47XG4gICAgaW5wdXRGb3JtLnJlbW92ZSgpO1xuICAgIHRhc2tJdGVtLnByZXBlbmQodGFza1RleHRTcGFuKTtcbn1cblxuY29uc3QgdXBkYXRlUHJpb3JpdHkgPSAoZXZlbnRUYXJnZXQpID0+IHtcbiAgICBjb25zdCB0YXNrSXRlbUNsYXNzTGlzdCA9IGV2ZW50VGFyZ2V0LnBhcmVudEVsZW1lbnQucGFyZW50RWxlbWVudC5jbGFzc0xpc3Q7XG4gICAgaWYgKHRhc2tJdGVtQ2xhc3NMaXN0LmNvbnRhaW5zKCdjb21wbGV0ZWQnKSkgcmV0dXJuO1xuICAgIGNvbnN0IHByb2plY3RJZCA9IGV2ZW50VGFyZ2V0LmNsb3Nlc3QoJy5wcm9qZWN0JykuZGF0YXNldC5wcm9qZWN0SWQ7XG4gICAgY29uc3QgdGFza0lkID0gZXZlbnRUYXJnZXQuY2xvc2VzdCgnW2RhdGEtdGFzay1pZF0nKS5kYXRhc2V0LnRhc2tJZDtcblxuICAgIGNvbnN0IHByaW9yaXR5Q2xhc3NMaXN0ID0gZXZlbnRUYXJnZXQuY2xhc3NMaXN0O1xuXG4gICAgaWYgKHByaW9yaXR5Q2xhc3NMaXN0LmNvbnRhaW5zKCdwcmlvcml0eS1sb3cnKSkge1xuICAgICAgICBwcmlvcml0eUNsYXNzTGlzdC5yZW1vdmUoJ3ByaW9yaXR5LWxvdycpO1xuICAgICAgICBwcmlvcml0eUNsYXNzTGlzdC5hZGQoJ3ByaW9yaXR5LW1lZGl1bScpO1xuICAgICAgICByZXR1cm4gaGFuZGxlcnMub25UYXNrUHJpb3JpdHlFZGl0KHByb2plY3RJZCwgdGFza0lkLCAnbWVkaXVtJyk7IFxuICAgIH1cbiAgICBpZiAocHJpb3JpdHlDbGFzc0xpc3QuY29udGFpbnMoJ3ByaW9yaXR5LW1lZGl1bScpKSB7XG4gICAgICAgIHByaW9yaXR5Q2xhc3NMaXN0LnJlbW92ZSgncHJpb3JpdHktbWVkaXVtJyk7XG4gICAgICAgIHByaW9yaXR5Q2xhc3NMaXN0LmFkZCgncHJpb3JpdHktaGlnaCcpO1xuICAgICAgICByZXR1cm4gaGFuZGxlcnMub25UYXNrUHJpb3JpdHlFZGl0KHByb2plY3RJZCwgdGFza0lkLCAnaGlnaCcpO1xuICAgIH1cbiAgICBpZiAocHJpb3JpdHlDbGFzc0xpc3QuY29udGFpbnMoJ3ByaW9yaXR5LWhpZ2gnKSkge1xuICAgICAgICBwcmlvcml0eUNsYXNzTGlzdC5yZW1vdmUoJ3ByaW9yaXR5LWhpZ2gnKTtcbiAgICAgICAgcHJpb3JpdHlDbGFzc0xpc3QuYWRkKCdwcmlvcml0eS1sb3cnKTtcbiAgICAgICAgcmV0dXJuIGhhbmRsZXJzLm9uVGFza1ByaW9yaXR5RWRpdChwcm9qZWN0SWQsIHRhc2tJZCwgJ2xvdycpO1xuICAgIH1cbn1cblxuZXhwb3J0IHtcbiAgICB0b2dnbGVUYXNrLFxuICAgIGFkZFRhc2tUb0RPTSxcbiAgICBhZGRUYXNrLFxuICAgIHVwZGF0ZVByaW9yaXR5LFxufSIsImltcG9ydCB7IGFkZFByb2plY3QsIGRlbGV0ZVByb2plY3QsIGVkaXRQcm9qZWN0IH0gZnJvbSBcIi4vcHJvamVjdHNcIjtcbmltcG9ydCB1cGRhdGVTdG9yYWdlIGZyb20gXCIuL3N0b3JhZ2VcIjtcbmltcG9ydCB7IHVwZGF0ZVByb2plY3RMaXN0LCBsb2FkQWxsUHJvamVjdHMgfSBmcm9tIFwiLi9jcmVhdGVET01FbGVtZW50c1wiO1xuaW1wb3J0IHsgdG9nZ2xlVGFzaywgYWRkVGFza1RvRE9NLCBhZGRUYXNrLCB1cGRhdGVQcmlvcml0eSB9IGZyb20gXCIuL3Rhc2tzXCI7XG5cbi8vIExvYWQgbG9jYWxTdG9yYWdlIGl0ZW1zIG9uIHBhZ2UgbG9hZFxud2luZG93Lm9ubG9hZCA9ICgpID0+IHtcbiAgICBjb25zdCBwcm9qZWN0cyA9IHVwZGF0ZVN0b3JhZ2UuZ2V0UHJvamVjdHMoKTtcbiAgICB1cGRhdGVQcm9qZWN0TGlzdChwcm9qZWN0cyk7XG4gICAgbG9hZEFsbFByb2plY3RzKHByb2plY3RzKTtcbn1cblxuLy8gU2lkZWJhciBNb2R1bGVcbmNvbnN0IHNpZGViYXJDb250cm9sbGVyID0gKCgpID0+IHtcblxuICAgIGNvbnN0IG1vYmlsZVRvZ2dsZUJ0biA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdiYXJzLWljb24tbW9iaWxlJyk7XG4gICAgaWYgKHdpbmRvdy5pbm5lcldpZHRoIDw9IDEwMjQgJiYgbW9iaWxlVG9nZ2xlQnRuLmNsYXNzTGlzdC5jb250YWlucygnaGlkZGVuJykpIHtcbiAgICAgICAgbW9iaWxlVG9nZ2xlQnRuLmNsYXNzTGlzdC50b2dnbGUoJ2hpZGRlbicpO1xuICAgIH1cblxuICAgIGNvbnN0IHNpZGViYXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc2lkZWJhcicpO1xuICAgIFxuICAgIGNvbnN0IHRvZ2dsZVNpZGViYXIgPSAoKSA9PiB7XG4gICAgICAgIHNpZGViYXIuY2xhc3NMaXN0LnRvZ2dsZSgndG9nZ2xlLXNpZGViYXInKTtcbiAgICAgICAgaWYgKHdpbmRvdy5pbm5lcldpZHRoIDw9IDEwMjQpIG1vYmlsZVRvZ2dsZUJ0bi5jbGFzc0xpc3QudG9nZ2xlKCdoaWRkZW4nKTtcbiAgICB9XG4gICAgXG4gICAgY29uc3QgdG9nZ2xlQnRuID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLmJhcnMtaWNvbicpO1xuICAgIHRvZ2dsZUJ0bi5mb3JFYWNoKGJ1dHRvbiA9PiB7XG4gICAgICAgIGJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIHRvZ2dsZVNpZGViYXIpO1xuICAgIH0pOyAgICAgICAgXG59KSgpO1xuXG5jb25zdCBwcm9qZWN0Q29udHJvbGxlciA9ICgoKSA9PiB7XG4gICAgZGVsZXRlUHJvamVjdCgpO1xuICAgIGNvbnN0IGFkZFByb2plY3RCdG4gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCdbZGF0YS1hZGQtcHJvamVjdF0nKTtcbiAgICBhZGRQcm9qZWN0QnRuLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgYWRkUHJvamVjdCk7XG5cbiAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIChlKSA9PiB7XG4gICAgICAgIGlmIChlLnRhcmdldC5jbGFzc0xpc3QuY29udGFpbnMoJ2VkaXQtcHJvamVjdCcpKSB7XG4gICAgICAgICAgICBlZGl0UHJvamVjdChlKTtcbiAgICAgICAgfVxuICAgIH0pO1xufSkoKTtcblxuY29uc3QgdGFza0NvbnRyb2xsZXIgPSAoKCkgPT4ge1xuICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKGUpID0+IHtcbiAgICAgICAgaWYgKGUudGFyZ2V0LmNsYXNzTGlzdC5jb250YWlucygndGFzay10ZXh0JykpIHtcbiAgICAgICAgICAgIGNvbnN0IHRhc2tFbGVtZW50ID0gZS50YXJnZXQuY2xvc2VzdCgnLnRhc2snKTtcbiAgICAgICAgICAgIHRvZ2dsZVRhc2sodGFza0VsZW1lbnQpO1xuICAgICAgICB9XG4gICAgICAgIGlmIChlLnRhcmdldC5jbGFzc0xpc3QuY29udGFpbnMoJ2FkZC10YXNrJykpIHtcbiAgICAgICAgICAgIGFkZFRhc2tUb0RPTShlLnRhcmdldCk7XG4gICAgICAgICAgICBhZGRUYXNrKCk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGUudGFyZ2V0LmNsYXNzTGlzdC5jb250YWlucygncHJpb3JpdHktaWNvbicpKSB7XG4gICAgICAgICAgICB1cGRhdGVQcmlvcml0eShlLnRhcmdldCk7XG4gICAgICAgIH1cbiAgICB9KTtcbn0pKCk7Il0sIm5hbWVzIjpbImdldFByb2plY3RzIiwiSlNPTiIsInBhcnNlIiwibG9jYWxTdG9yYWdlIiwiZ2V0SXRlbSIsInNhdmVQcm9qZWN0IiwicHJvamVjdFRvU2F2ZSIsInByb2plY3RzIiwiZXhpc3RpbmciLCJmaW5kIiwicHJvamVjdCIsImlkIiwicHJvamVjdE5hbWUiLCJ0YXNrcyIsIk1hdGgiLCJmbG9vciIsInJhbmRvbSIsInB1c2giLCJzZXRJdGVtIiwic3RyaW5naWZ5IiwiZ2V0VGFza3MiLCJwcm9qZWN0SWQiLCJkZWxldGVQcm9qZWN0IiwidXBkYXRlZFByb2plY3RMaXN0IiwiZmlsdGVyIiwiZGVsZXRlVGFzayIsInRhc2tJZCIsInByb2plY3RXaXRoVGFzayIsInVwZGF0ZWRUYXNrT2JqIiwidGFza09iaiIsImZpbmRUYXNrVG9VcGRhdGUiLCJleGlzdGluZ1Rhc2tJZCIsInRhc2siLCJ1cGRhdGVUYXNrIiwidXBkYXRlZFRhc2siLCJwcm9qZWN0VG9VcGRhdGUiLCJ0YXNrc0FycmF5IiwiaW5kZXhPZlVwZGF0ZWRUYXNrIiwiZmluZEluZGV4IiwiX3JlZnJlc2hQcm9qZWN0TGlzdCIsIl9zZXRQcm9qZWN0TGlzdCIsInVwZGF0ZVByb2plY3RMaXN0IiwiX3NldEFjdGl2ZVRhYiIsInRhYiIsInVwZGF0ZUFjdGl2ZVRhYiIsIm9uUHJvamVjdFNlbGVjdCIsInByb2plY3RPYmplY3QiLCJzZWxlY3RlZFByb2plY3QiLCJkb2N1bWVudCIsInF1ZXJ5U2VsZWN0b3IiLCJvblByb2plY3RBZGQiLCJuZXdQcm9qZWN0IiwibmV3UHJvamVjdERPTUVsZW1lbnQiLCJvblByb2plY3ROYW1lRWRpdCIsIm9uVGFza0FkZCIsIm5ld1Rhc2siLCJpdGVtIiwicHJpb3JpdHkiLCJkdWVEYXRlIiwiaXNDb21wbGV0ZSIsIm9uVGFza05hbWVFZGl0IiwibmV3VGFza05hbWUiLCJleGlzdGluZ1Rhc2siLCJvblRhc2tQcmlvcml0eUVkaXQiLCJuZXdQcmlvcml0eSIsIm9uVGFza0R1ZURhdGVFZGl0IiwibmV3RHVlRGF0ZSIsIm9uVGFza0NvbXBsZXRlRWRpdCIsImNyZWF0ZUVsZW1lbnRzIiwiY3JlYXRlTGlzdEVsZW1lbnQiLCJodG1sQ2xhc3MiLCJsaSIsImNyZWF0ZUVsZW1lbnQiLCJzZXRBdHRyaWJ1dGUiLCJjcmVhdGVTcGFuRWxlbWVudCIsInNwYW4iLCJjbGFzc0xpc3QiLCJhZGQiLCJjcmVhdGVJbWFnZUVsZW1lbnQiLCJzcmMiLCJpbWciLCJjcmVhdGVJbnB1dEZpZWxkIiwicGxhY2Vob2xkZXJUZXh0IiwidXNlcklucHV0IiwicmVxdWlyZWQiLCJjcmVhdGVGb3JtIiwiY3JlYXRlRGl2IiwiZGl2IiwiY3JlYXRlSWNvblNwYW4iLCJ2aWV3IiwiaWNvblNwYW4iLCJlZGl0SWNvbiIsImRlbGV0ZUljb24iLCJhcHBlbmQiLCJhZGRQcm9qZWN0VG9Ob3RlcGFkIiwibm90ZXBhZCIsInByb2plY3REaXYiLCJza2lwTGluZSIsInByb2plY3RIZWFkaW5nIiwiaDIiLCJ0ZXh0Q29udGVudCIsImgzIiwidGFza3NDb250YWluZXIiLCJhZGRUYXNrTGlzdEVsZW1lbnQiLCJhZGRUYXNrU3BhbiIsImFkZEljb24iLCJfY3JlYXRlUHJvamVjdEl0ZW1IVE1MIiwibmFtZSIsInByb2plY3RJdGVtIiwicHJvamVjdHNMaXN0Q29udGFpbmVyIiwiYWRkUHJvamVjdEJ0biIsInNsaWNlIiwiY2FsbCIsImNoaWxkcmVuIiwiZm9yRWFjaCIsImNvbnRhaW5zIiwicmVtb3ZlIiwiaHRtbCIsImluc2VydEJlZm9yZSIsInF1ZXJ5U2VsZWN0b3JBbGwiLCJhZGRFdmVudExpc3RlbmVyIiwiZGF0YXNldCIsImN1cnJlbnRBY3RpdmVUYWIiLCJhd2FpdGluZ0lucHV0IiwiaGFuZGxlVXNlcklucHV0IiwicGFyZW50RWxlbWVudCIsInByb2plY3RTcGFuIiwidmFsdWUiLCJ0cmltIiwiY2hpbGROb2RlcyIsImFkZFByb2plY3QiLCJwcm9qZWN0c0NvbnRhaW5lciIsInByb2plY3RMaXN0RWxlbWVudCIsInByb2plY3RJbnB1dEZvcm0iLCJwcm9qZWN0TmFtZUlucHV0IiwibGFzdEVsZW1lbnRDaGlsZCIsInNldFRpbWVvdXQiLCJmb2N1cyIsImFkZFByb2plY3RUb1NpZGViYXIiLCJpbnB1dEZvcm0iLCJmaXJzdEVsZW1lbnRDaGlsZCIsInByb2plY3RMaXN0IiwiY2hpbGRFbGVtZW50Q291bnQiLCJnZXRBdHRyaWJ1dGUiLCJlIiwicHJldmVudERlZmF1bHQiLCJhZGRUYXNrIiwiaW5wdXRGaWVsZCIsInRhc2tDb250YWluZXIiLCJjbG9zZXN0IiwidmFsaWRhdGVVc2VySW5wdXQiLCJjcmVhdGVUYXNrIiwidGFza0l0ZW0iLCJ0YXNrVGV4dFNwYW4iLCJwcmVwZW5kIiwid2luZG93Iiwib25sb2FkIiwibG9hZEFsbFByb2plY3RzIiwibW9iaWxlVG9nZ2xlQnRuIiwiZ2V0RWxlbWVudEJ5SWQiLCJpbm5lcldpZHRoIiwidG9nZ2xlIiwic2lkZWJhciIsInRvZ2dsZVNpZGViYXIiLCJidXR0b24iLCJ0YXJnZXQiLCJwcmV2aW91c0VsZW1lbnRTaWJsaW5nIiwidXBkYXRlTmFtZU9uTm90ZXBhZCIsInByb2plY3RUYXNrc0NvbnRhaW5lciIsImVkaXRQcm9qZWN0IiwidGFza0VsZW1lbnQiLCJ0b2dnbGVUYXNrIiwiYWRkVGFza0J0biIsInRhc2tMaXN0RWxlbWVudCIsInRhc2tTcGFuIiwidGFza05hbWUiLCJkdWVEYXRlU3BhbiIsInByaW9yaXR5SWNvbiIsImRhdGVMYWJlbCIsImRhdGVJbnB1dCIsImNhbGVuZGFySWNvbiIsImFkZER1ZURhdGVUb0RPTSIsImNvbnRhaW5lciIsIm51bWJlck9mVGFza3MiLCJhZGRUYXNrVG9ET00iLCJldmVudFRhcmdldCIsInByaW9yaXR5Q2xhc3NMaXN0IiwidXBkYXRlUHJpb3JpdHkiXSwic291cmNlUm9vdCI6IiJ9