(()=>{"use strict";const e=(()=>{const e=()=>JSON.parse(localStorage.getItem("projects")||"[]"),t=t=>{const n=e(),r=n.find((e=>e.id==t.id));r?(r.projectName=t.projectName,r.tasks=t.tasks):(t.id=Math.floor(1e6*Math.random()),n.push(t)),localStorage.setItem("projects",JSON.stringify(n))};return{getProjects:e,getTasks:t=>e().find((e=>e.id==t)).tasks,saveProject:t,deleteProject:t=>{const n=e().filter((e=>e.id!=t));localStorage.setItem("projects",JSON.stringify(n))},deleteTask:(n,r)=>{const a=e().find((e=>e.id==n)),o=a.tasks.filter((e=>e.taskId!=r));a.tasks=o,t(a)},findTaskToUpdate:(t,n)=>e().find((e=>e.id==t)).tasks.find((e=>e.taskId==n)),updateTask:(t,n)=>{const r=e(),a=r.find((e=>e.id==t)),o=a.tasks,c=o.findIndex((e=>e.taskId==n.taskId));o[c]=n,a.tasks=o,localStorage.setItem("projects",JSON.stringify(r))}}})(),t=(()=>{const t=()=>{const t=e.getProjects();n(t)},n=e=>{c(e)},r=e=>{s(e)};return{onProjectSelect:t=>{const n=e.getProjects().find((e=>e.id==t)),a=document.querySelector(`[data-project-id='${n.id}']`);r(a)},onProjectAdd:n=>{const a={projectName:n,tasks:[]};e.saveProject(a),t();const o=document.querySelector(`[data-project-id='${a.id}']`);r(o)},onProjectNameEdit:(n,r,a=e.getTasks(n))=>{e.saveProject({id:n,projectName:r,tasks:a}),t()},onTaskAdd:(t,n)=>{const r={item:t,taskId:Math.floor(1e6*Math.random()),priority:"low",dueDate:null,isComplete:!1},a=e.getProjects().find((e=>e.id==n));return a.tasks.push(r),e.saveProject(a),r},onTaskNameEdit:(t,n,r)=>{const a=e.findTaskToUpdate(t,n);e.updateTask(t,{item:r,taskId:a.taskId,priority:a.priority,dueDate:a.dueDate,isComplete:a.isComplete})}}})(),n=()=>({createListElement:e=>{const t=document.createElement("li");return t.setAttribute("class",e),t},createSpanElement:e=>{const t=document.createElement("span");return t.classList.add(e),t},createImageElement:(e,t)=>{const n=document.createElement("img");return n.classList.add(t),n.setAttribute("src",e),n.setAttribute("draggable","false"),n},createInputField:e=>{const t=document.createElement("input");return t.setAttribute("type","text"),t.setAttribute("placeholder",e),t.setAttribute("id","user-input"),t.required=!0,t},createForm:()=>document.createElement("form"),createDiv:e=>{const t=document.createElement("div");return t.setAttribute("class",e),t}}),r=()=>{const e=n(),t=e.createSpanElement("icons"),r=e.createImageElement("images/edit-icon.svg","edit-icon"),a=e.createImageElement("images/delete-icon.svg","delete-icon");return r.classList.add("edit-project"),a.classList.add("delete-project"),t.append(r,a),t},a=e=>{const t=n(),r=document.querySelector(".project-list"),a=r.childElementCount-2,o=r.children[a].textContent,c=document.querySelector("#writing-area"),s=t.createDiv("project");s.setAttribute("data-project-id",e);const i=t.createDiv("skip-line"),d=t.createDiv("project-heading"),l=document.createElement("h2");l.setAttribute("class","notepad-text"),l.textContent=o;const m=document.createElement("h3");m.setAttribute("class","notepad-text"),m.textContent="Due Date";const p=document.createElement("ul");p.classList.add("notepad-text","todos");const u=t.createListElement("task"),E=t.createSpanElement("add-task"),g=t.createImageElement("images/add-icon.svg","add-icon");E.append(g,"Add Task"),u.append(E),p.append(u,i),d.append(l,m),s.append(d,p),c.append(s)},o=(e,t)=>{const a=n(),o=a.createListElement("project-item");o.setAttribute("data-project-id",e);const c=a.createSpanElement("project-name");c.textContent=t;const s=r();return o.append(c,s),o},c=e=>{const n=document.querySelector(".project-list"),r=document.querySelector("[data-add-project]");[].slice.call(n.children).forEach((e=>{e.classList.contains("project-item")&&e.remove()}));for(const t of e){const e=o(t.id,t.projectName);n.insertBefore(e,r)}n.querySelectorAll(".project-item").forEach((e=>{e.addEventListener("click",(()=>{t.onProjectSelect(e.dataset.projectId)}))}))},s=e=>{const t=document.querySelector(".active");t&&t.classList.remove("active"),e.classList.add("active"),e.children.item(0)},i=()=>null!=document.querySelector("#user-input"),d=()=>{const e=document.querySelector("#user-input"),t=e.parentElement.parentElement,r=n().createSpanElement("project-name"),a=e.value.trim();a&&(r.textContent=a,e.parentElement.remove(),t.insertBefore(r,t.childNodes[0]))},l=()=>{if(i())return;(()=>{const e=n(),t=document.querySelector(".project-list"),a=e.createListElement("project-item"),o=e.createForm(),c=e.createInputField("Project name...");o.append(c);const s=r();a.append(o,s),t.insertBefore(a,t.lastElementChild),setTimeout((()=>{c.focus()}),0)})();const e=document.querySelector("#user-input"),o=e.parentElement,c=o.parentElement;e.addEventListener("blur",(function(){if(""==e.value.trim())return void c.remove();d();const n=c.firstElementChild.textContent;t.onProjectAdd(n);const r=document.querySelector(".project-list"),o=r.children[r.childElementCount-2].getAttribute("data-project-id");i()||a(o)})),o.addEventListener("submit",(function(e){e.preventDefault(),d();const n=c.firstElementChild.textContent;t.onProjectAdd(n);const r=document.querySelector(".project-list"),o=r.children[r.childElementCount-2].getAttribute("data-project-id");i()||a(o)}))},m=()=>{const e=document.querySelector("#user-input"),t=e.parentElement,n=t.parentElement.parentElement;e.addEventListener("blur",(function(t){const r=t.target.closest("[data-project-id]").dataset.projectId,a=e.value;u(),a&&p(a,r,n)})),t.addEventListener("submit",(function(t){t.preventDefault();const r=t.target.closest("[data-project-id]").dataset.projectId,a=e.value;u(),a&&p(a,r,n)}))},p=(e,n,r)=>{if(r.dataset.taskId)return t.onTaskNameEdit(n,r.dataset.taskId,e);const a=t.onTaskAdd(e,n);r.setAttribute("data-task-id",a.taskId)},u=()=>{const e=document.querySelector("#user-input"),t=e.parentElement,r=t.parentElement,a=r.parentElement,o=e.value.trim(),c=n().createSpanElement("task-text");c.append(o),""!=o?(t.remove(),r.prepend(c)):a.remove()};window.onload=()=>{const t=e.getProjects();c(t)},(()=>{const e=document.getElementById("bars-icon-mobile");window.innerWidth<=1024&&e.classList.contains("hidden")&&e.classList.toggle("hidden");const t=document.getElementById("sidebar"),n=()=>{t.classList.toggle("toggle-sidebar"),window.innerWidth<=1024&&e.classList.toggle("hidden")};document.querySelectorAll(".bars-icon").forEach((e=>{e.addEventListener("click",n)}))})(),document.addEventListener("click",(t=>{if(t.target.closest(".delete-project")){const n=t.target.closest(".project-item");n.remove();const r=n.dataset.projectId;e.deleteProject(r)}})),document.querySelector("[data-add-project]").addEventListener("click",l),document.addEventListener("click",(e=>{e.target.classList.contains("edit-project")&&(e=>{if(i())return;const r=n().createForm(),a=n().createInputField("Project name..."),o=e.target.parentElement.previousElementSibling;a.value=o.textContent,o.remove(),r.append(a);const c=e.target.closest(".project-item");c.insertBefore(r,c.childNodes[0]);const s=document.querySelector("#user-input"),l=c.dataset.projectId;s.addEventListener("blur",(function(){""!=s.value&&d();const e=c.firstElementChild.textContent;t.onProjectNameEdit(l,e)})),r.addEventListener("submit",(function(e){e.preventDefault(),d();const n=c.firstElementChild.textContent;t.onProjectNameEdit(l,n)}))})(e)})),document.addEventListener("click",(t=>{t.target.classList.contains("task-item")&&t.target.parentElement.classList.toggle("completed"),t.target.classList.contains("add-task")&&((t=>{if(document.getElementById("user-input"))return;const r=n().createListElement("task"),a=n().createSpanElement("task-item"),o=n().createForm(),c=n().createInputField("Enter Task...");o.append(c),a.append(o);const s=n().createSpanElement("icons"),i=n().createImageElement("images/edit-icon.svg","edit-icon"),d=n().createImageElement("images/delete-icon.svg","delete-icon");i.addEventListener("click",(()=>{if(r.classList.contains("completed"))return;const e=document.querySelector(".task-text"),t=e.textContent;e.remove();const o=n().createForm(),c=n().createInputField("Enter Task...");c.value=t,o.append(c),a.insertBefore(o,s),r.prepend(a),m()})),d.addEventListener("click",(t=>{const n=t.target.closest("[data-project-id]").dataset.projectId,a=t.target.closest("[data-task-id]").dataset.taskId;r.remove(),e.deleteTask(n,a)})),s.append(i,d),a.append(s);const l=(()=>{const e=n().createSpanElement("due-date"),t=n().createImageElement("images/priority-icon.svg","priority-icon");t.classList.add("priority-low");const r=document.createElement("label");r.classList.add("date-label");const a=document.createElement("input");a.setAttribute("type","date"),a.required=!0;const o=n().createImageElement("images/calendar-icon.svg","calendar-icon");return r.append(a,o),e.append(t,r),e})();r.append(a,l);const p=t.closest(".todos"),u=p.childElementCount-2;p.insertBefore(r,p.children[u]),setTimeout((()=>{c.focus()}),0)})(t.target),m()),t.target.classList.contains("priority-icon")&&(e=>{if(e.parentElement.parentElement.classList.contains("completed"))return;const t=e.classList;t.contains("priority-low")?(t.remove("priority-low"),t.add("priority-medium")):t.contains("priority-medium")?(t.remove("priority-medium"),t.add("priority-high")):t.contains("priority-high")&&(t.remove("priority-high"),t.add("priority-low"))})(t.target)}))})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QVMsb0JBQzNCZ0UsRUFBa0IvRCxPQUFPLG1CQUN6QitELEVBQWtCekcsSUFBSSxrQkFHdEJ5RyxFQUFrQmhFLFNBQVMsbUJBQzNCZ0UsRUFBa0IvRCxPQUFPLGlCQUN6QitELEVBQWtCekcsSUFBSSxrQkNqR2xCMEcsQ0FBZXRDLEVBQUVLLFkiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly90b2RvLWxpc3QvLi9zcmMvc3RvcmFnZS5qcyIsIndlYnBhY2s6Ly90b2RvLWxpc3QvLi9zcmMvaGFuZGxlcnMuanMiLCJ3ZWJwYWNrOi8vdG9kby1saXN0Ly4vc3JjL2NyZWF0ZURPTUVsZW1lbnRzLmpzIiwid2VicGFjazovL3RvZG8tbGlzdC8uL3NyYy9wcm9qZWN0cy5qcyIsIndlYnBhY2s6Ly90b2RvLWxpc3QvLi9zcmMvdGFza3MuanMiLCJ3ZWJwYWNrOi8vdG9kby1saXN0Ly4vc3JjL2luZGV4LmpzIl0sInNvdXJjZXNDb250ZW50IjpbImNvbnN0IHVwZGF0ZVN0b3JhZ2UgPSAoKSA9PiB7XG4gICAgXG4gICAgY29uc3QgZ2V0UHJvamVjdHMgPSAoKSA9PiB7XG4gICAgICAgIC8vIGNyZWF0ZXMgYW4gYXJyYXkgb2Ygb2JqZWN0cyBcbiAgICAgICAgY29uc3QgcHJvamVjdHMgPSBKU09OLnBhcnNlKGxvY2FsU3RvcmFnZS5nZXRJdGVtKCdwcm9qZWN0cycpIHx8ICdbXScpO1xuICAgICAgICByZXR1cm4gcHJvamVjdHM7XG4gICAgfVxuXG4gICAgY29uc3QgZ2V0VGFza3MgPSAocHJvamVjdElkKSA9PiB7XG4gICAgICAgIGNvbnN0IHByb2plY3RzID0gZ2V0UHJvamVjdHMoKTtcbiAgICAgICAgY29uc3QgY3VycmVudFByb2plY3QgPSBwcm9qZWN0cy5maW5kKHByb2plY3QgPT4gcHJvamVjdC5pZCA9PSBwcm9qZWN0SWQpO1xuICAgICAgICBjb25zdCB0YXNrcyA9IGN1cnJlbnRQcm9qZWN0LnRhc2tzO1xuICAgICAgICByZXR1cm4gdGFza3M7XG4gICAgfVxuXG4gICAgY29uc3Qgc2F2ZVByb2plY3QgPSAocHJvamVjdFRvU2F2ZSkgPT4ge1xuICAgICAgICBjb25zdCBwcm9qZWN0cyA9IGdldFByb2plY3RzKCk7XG5cbiAgICAgICAgLy8gZmluZCBtZXRob2QgcmV0dXJucyB0aGUgZmlyc3Qgb2JqZWN0IHRoYXQgbWF0Y2hlcyB0aGUgaWRcbiAgICAgICAgY29uc3QgZXhpc3RpbmcgPSBwcm9qZWN0cy5maW5kKHByb2plY3QgPT4gcHJvamVjdC5pZCA9PSBwcm9qZWN0VG9TYXZlLmlkKTtcbiAgICAgICAgXG4gICAgICAgIGlmIChleGlzdGluZykge1xuICAgICAgICAgICAgZXhpc3RpbmcucHJvamVjdE5hbWUgPSBwcm9qZWN0VG9TYXZlLnByb2plY3ROYW1lO1xuICAgICAgICAgICAgZXhpc3RpbmcudGFza3MgPSBwcm9qZWN0VG9TYXZlLnRhc2tzO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgcHJvamVjdFRvU2F2ZS5pZCA9IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIDEwMDAwMDApO1xuICAgICAgICAgICAgLy8gQWRkIHByb2plY3ROYW1lXG4gICAgICAgICAgICAvLyBBZGQgVGFza3MgYXJyYXkgY29udGFpbmluZyBhbm90aGVyIGFycmF5IHdoaWNoIGluY2x1ZGVzIHRhc2ssIHByaW9yaXR5LCBkdWVEYXRlLCBhbmQgdHJ1ZS9mYWxzZSBmb3IgY29tcGxldGVkIG9yIG5vdFxuICAgICAgICAgICAgcHJvamVjdHMucHVzaChwcm9qZWN0VG9TYXZlKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKCdwcm9qZWN0cycsIEpTT04uc3RyaW5naWZ5KHByb2plY3RzKSk7XG4gICAgfVxuXG4gICAgY29uc3QgdXBkYXRlVGFzayA9IChwcm9qZWN0SWQsIHVwZGF0ZWRUYXNrKSA9PiB7XG4gICAgICAgIC8vIHRhc2tzIGZvciBjdXJyZW50IHByb2plY3RcbiAgICAgICAgY29uc3QgcHJvamVjdHMgPSBnZXRQcm9qZWN0cygpO1xuICAgICAgICBjb25zdCBwcm9qZWN0VG9VcGRhdGUgPSBwcm9qZWN0cy5maW5kKHByb2plY3QgPT4gcHJvamVjdC5pZCA9PSBwcm9qZWN0SWQpO1xuICAgICAgICBjb25zdCB0YXNrc0FycmF5ID0gcHJvamVjdFRvVXBkYXRlLnRhc2tzO1xuICAgICAgICBcbiAgICAgICAgLy8gZmluZCB0YXNrIGluZGV4IGFuZCByZXBsYWNlIHRoZSB0YXNrIGF0IHRoYXQgaW5kZXggdG8gdXBkYXRlXG4gICAgICAgIGNvbnN0IGluZGV4T2ZVcGRhdGVkVGFzayA9IHRhc2tzQXJyYXkuZmluZEluZGV4KCh0YXNrT2JqKSA9PiB7XG4gICAgICAgICAgICByZXR1cm4gdGFza09iai50YXNrSWQgPT0gdXBkYXRlZFRhc2sudGFza0lkO1xuICAgICAgICB9KTtcblxuICAgICAgICB0YXNrc0FycmF5W2luZGV4T2ZVcGRhdGVkVGFza10gPSB1cGRhdGVkVGFzaztcbiAgICAgICAgLy8gU2F2ZSB1cGRhdGVkIHRhc2tzIGFycmF5IHRvIHRoZSBwcm9qZWN0IG9iamVjdFxuICAgICAgICBwcm9qZWN0VG9VcGRhdGUudGFza3MgPSB0YXNrc0FycmF5O1xuICAgICAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbSgncHJvamVjdHMnLCBKU09OLnN0cmluZ2lmeShwcm9qZWN0cykpO1xuICAgIH1cblxuICAgIGNvbnN0IGZpbmRUYXNrVG9VcGRhdGUgPSAocHJvamVjdElkLCBleGlzdGluZ1Rhc2tJZCkgPT4ge1xuICAgICAgICBjb25zdCBwcm9qZWN0cyA9IGdldFByb2plY3RzKCk7ICAgICBcbiAgICAgICAgY29uc3QgcHJvamVjdFRvVXBkYXRlID0gcHJvamVjdHMuZmluZChwcm9qZWN0ID0+IHByb2plY3QuaWQgPT0gcHJvamVjdElkKTtcbiAgICAgICAgY29uc3QgdGFza3NBcnJheSA9IHByb2plY3RUb1VwZGF0ZS50YXNrc1xuICAgICAgICBjb25zdCBleGlzdGluZ1Rhc2sgPSB0YXNrc0FycmF5LmZpbmQodGFzayA9PiB0YXNrLnRhc2tJZCA9PSBleGlzdGluZ1Rhc2tJZCk7XG4gICAgICAgIHJldHVybiBleGlzdGluZ1Rhc2s7XG4gICAgfVxuXG4gICAgY29uc3QgZGVsZXRlUHJvamVjdCA9IChpZCkgPT4ge1xuICAgICAgICBjb25zdCBwcm9qZWN0cyA9IGdldFByb2plY3RzKCk7XG4gICAgICAgIGNvbnN0IHVwZGF0ZWRQcm9qZWN0TGlzdCA9IHByb2plY3RzLmZpbHRlcihwcm9qZWN0ID0+IHByb2plY3QuaWQgIT0gaWQpO1xuXG4gICAgICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKCdwcm9qZWN0cycsIEpTT04uc3RyaW5naWZ5KHVwZGF0ZWRQcm9qZWN0TGlzdCkpO1xuICAgIH1cblxuICAgIGNvbnN0IGRlbGV0ZVRhc2sgPSAoaWQsIHRhc2tJZCkgPT4ge1xuICAgICAgICBjb25zdCBwcm9qZWN0cyA9IGdldFByb2plY3RzKCk7XG4gICAgICAgIGNvbnN0IHByb2plY3RXaXRoVGFzayA9IHByb2plY3RzLmZpbmQocHJvamVjdCA9PiBwcm9qZWN0LmlkID09IGlkKTtcbiAgICAgICAgY29uc3QgYWxsVGFza3MgPSBwcm9qZWN0V2l0aFRhc2sudGFza3M7XG4gICAgICAgIC8vIEVhY2ggdGFzayBpcyBhbiBvYmplY3RcbiAgICAgICAgY29uc3QgdXBkYXRlZFRhc2tPYmogPSBhbGxUYXNrcy5maWx0ZXIodGFza09iaiA9PiB0YXNrT2JqLnRhc2tJZCAhPSB0YXNrSWQpO1xuICAgICAgICBwcm9qZWN0V2l0aFRhc2sudGFza3MgPSB1cGRhdGVkVGFza09iajtcblxuICAgICAgICBzYXZlUHJvamVjdChwcm9qZWN0V2l0aFRhc2spO1xuICAgIH1cblxuICAgIHJldHVybiB7IGdldFByb2plY3RzLCBnZXRUYXNrcywgc2F2ZVByb2plY3QsIGRlbGV0ZVByb2plY3QsIGRlbGV0ZVRhc2ssIGZpbmRUYXNrVG9VcGRhdGUsIHVwZGF0ZVRhc2sgfVxufVxuXG5leHBvcnQgZGVmYXVsdCB1cGRhdGVTdG9yYWdlKCk7IiwiaW1wb3J0IHsgdXBkYXRlUHJvamVjdExpc3QsIHVwZGF0ZUFjdGl2ZVRhYiB9IGZyb20gXCIuL2NyZWF0ZURPTUVsZW1lbnRzXCI7XG5pbXBvcnQgdXBkYXRlU3RvcmFnZSBmcm9tIFwiLi9zdG9yYWdlXCI7XG5pbXBvcnQge2Zvcm1hdH0gZnJvbSBcImRhdGUtZm5zXCI7XG5cbmNvbnN0IGhhbmRsZXJzID0gKCkgPT4ge1xuICAgIFxuICAgIGNvbnN0IF9yZWZyZXNoUHJvamVjdExpc3QgPSAoKSA9PiB7XG4gICAgICAgIGNvbnN0IHByb2plY3RzID0gdXBkYXRlU3RvcmFnZS5nZXRQcm9qZWN0cygpOyAvLyBVcGRhdGUgcHJvamVjdHMgaW4gc3RvcmFnZSAgICAgICAgXG4gICAgICAgIF9zZXRQcm9qZWN0TGlzdChwcm9qZWN0cyk7IC8vIFVwZGF0ZSBwcm9qZWN0cyBvbiBET01cbiAgICB9XG5cbiAgICBjb25zdCBfc2V0UHJvamVjdExpc3QgPSAocHJvamVjdHMpID0+IHtcbiAgICAgICAgdXBkYXRlUHJvamVjdExpc3QocHJvamVjdHMpO1xuICAgIH1cblxuICAgIGNvbnN0IF9zZXRBY3RpdmVUYWIgPSAodGFiKSA9PiB7XG4gICAgICAgIHVwZGF0ZUFjdGl2ZVRhYih0YWIpO1xuICAgIH1cblxuICAgIC8vIEhlcmUgYmUgaGFuZGxlcnNcbiAgICBjb25zdCBvblByb2plY3RTZWxlY3QgPSAocHJvamVjdElkKSA9PiB7XG4gICAgICAgIGNvbnN0IHByb2plY3RzID0gdXBkYXRlU3RvcmFnZS5nZXRQcm9qZWN0cygpO1xuICAgICAgICBjb25zdCBwcm9qZWN0T2JqZWN0ID0gcHJvamVjdHMuZmluZChwcm9qZWN0ID0+IHByb2plY3QuaWQgPT0gcHJvamVjdElkKTtcbiAgICAgICAgY29uc3Qgc2VsZWN0ZWRQcm9qZWN0ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihgW2RhdGEtcHJvamVjdC1pZD0nJHtwcm9qZWN0T2JqZWN0LmlkfSddYCk7XG4gICAgICAgIF9zZXRBY3RpdmVUYWIoc2VsZWN0ZWRQcm9qZWN0KTtcbiAgICB9XG5cbiAgICBjb25zdCBvblByb2plY3RBZGQgPSAocHJvamVjdE5hbWUpID0+IHtcbiAgICAgICAgLy8gcGFzcyB1c2VyIGlucHV0IGludG8gZnVuY3Rpb25cbiAgICAgICAgY29uc3QgbmV3UHJvamVjdCA9ICB7XG4gICAgICAgICAgICBwcm9qZWN0TmFtZTogcHJvamVjdE5hbWUsXG4gICAgICAgICAgICB0YXNrczogW11cbiAgICAgICAgfVxuICAgICAgICB1cGRhdGVTdG9yYWdlLnNhdmVQcm9qZWN0KG5ld1Byb2plY3QpO1xuICAgICAgICAvLyBhZGQgaW5wdXQgdG8gcGFnZVxuICAgICAgICBfcmVmcmVzaFByb2plY3RMaXN0KCk7XG4gICAgICAgIGNvbnN0IG5ld1Byb2plY3RET01FbGVtZW50ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihgW2RhdGEtcHJvamVjdC1pZD0nJHtuZXdQcm9qZWN0LmlkfSddYCk7XG4gICAgICAgIF9zZXRBY3RpdmVUYWIobmV3UHJvamVjdERPTUVsZW1lbnQpO1xuICAgIH1cbiAgICBcbiAgICBjb25zdCBvblRhc2tBZGQgPSAodGFzaywgaWQpID0+IHtcbiAgICAgICAgY29uc3QgbmV3VGFzayA9IHtcbiAgICAgICAgICAgIGl0ZW06IHRhc2ssIFxuICAgICAgICAgICAgdGFza0lkOiBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAxMDAwMDAwKSxcbiAgICAgICAgICAgIHByaW9yaXR5OiAnbG93JyxcbiAgICAgICAgICAgIGR1ZURhdGU6IG51bGwsXG4gICAgICAgICAgICBpc0NvbXBsZXRlOiBmYWxzZVxuICAgICAgICB9XG4gICAgICAgIGNvbnN0IHByb2plY3RzID0gdXBkYXRlU3RvcmFnZS5nZXRQcm9qZWN0cygpO1xuICAgICAgICBjb25zdCBwcm9qZWN0VG9VcGRhdGUgPSBwcm9qZWN0cy5maW5kKHByb2plY3QgPT4gcHJvamVjdC5pZCA9PSBpZCk7XG4gICAgICAgIHByb2plY3RUb1VwZGF0ZS50YXNrcy5wdXNoKG5ld1Rhc2spO1xuICAgICAgICB1cGRhdGVTdG9yYWdlLnNhdmVQcm9qZWN0KHByb2plY3RUb1VwZGF0ZSk7XG4gICAgICAgIFxuICAgICAgICByZXR1cm4gbmV3VGFzaztcbiAgICB9XG4gICAgXG4gICAgY29uc3Qgb25Qcm9qZWN0TmFtZUVkaXQgPSAocHJvamVjdElkLCBwcm9qZWN0TmFtZSwgdGFza3MgPSB1cGRhdGVTdG9yYWdlLmdldFRhc2tzKHByb2plY3RJZCkpID0+IHtcbiAgICAgICAgdXBkYXRlU3RvcmFnZS5zYXZlUHJvamVjdCh7XG4gICAgICAgICAgICBpZDogcHJvamVjdElkLFxuICAgICAgICAgICAgcHJvamVjdE5hbWU6IHByb2plY3ROYW1lLFxuICAgICAgICAgICAgdGFza3M6IHRhc2tzXG4gICAgICAgIH0pO1xuXG4gICAgICAgIF9yZWZyZXNoUHJvamVjdExpc3QoKTtcbiAgICB9XG5cbiAgICBjb25zdCBvblRhc2tOYW1lRWRpdCA9IChwcm9qZWN0SWQsIHRhc2tJZCwgbmV3VGFza05hbWUpID0+IHtcbiAgICAgICAgY29uc3QgZXhpc3RpbmdUYXNrID0gdXBkYXRlU3RvcmFnZS5maW5kVGFza1RvVXBkYXRlKHByb2plY3RJZCwgdGFza0lkKTtcbiAgICAgICAgdXBkYXRlU3RvcmFnZS51cGRhdGVUYXNrKHByb2plY3RJZCwge1xuICAgICAgICAgICAgICAgIGl0ZW06IG5ld1Rhc2tOYW1lLFxuICAgICAgICAgICAgICAgIHRhc2tJZDogZXhpc3RpbmdUYXNrLnRhc2tJZCxcbiAgICAgICAgICAgICAgICBwcmlvcml0eTogZXhpc3RpbmdUYXNrLnByaW9yaXR5LFxuICAgICAgICAgICAgICAgIGR1ZURhdGU6IGV4aXN0aW5nVGFzay5kdWVEYXRlLFxuICAgICAgICAgICAgICAgIGlzQ29tcGxldGU6IGV4aXN0aW5nVGFzay5pc0NvbXBsZXRlXG4gICAgICAgICAgICB9KTtcbiAgICB9XG5cbiAgICByZXR1cm4geyBvblByb2plY3RTZWxlY3QsIG9uUHJvamVjdEFkZCwgb25Qcm9qZWN0TmFtZUVkaXQsIG9uVGFza0FkZCwgb25UYXNrTmFtZUVkaXQgfVxuICAgIFxufVxuXG5leHBvcnQgZGVmYXVsdCBoYW5kbGVycygpOyIsImltcG9ydCBoYW5kbGVycyBmcm9tIFwiLi9oYW5kbGVyc1wiXG5cbi8vIERPTSBFbGVtZW50cyBGYWN0b3J5IEZ1bmN0aW9uXG5jb25zdCBjcmVhdGVFbGVtZW50cyA9ICgpID0+IHtcbiAgICBcbiAgICBjb25zdCBjcmVhdGVMaXN0RWxlbWVudCA9IChodG1sQ2xhc3MpID0+IHtcbiAgICAgICAgY29uc3QgbGkgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdsaScpO1xuICAgICAgICBsaS5zZXRBdHRyaWJ1dGUoJ2NsYXNzJywgaHRtbENsYXNzKTtcbiAgICAgICAgcmV0dXJuIGxpO1xuICAgIH1cblxuICAgIGNvbnN0IGNyZWF0ZVNwYW5FbGVtZW50ID0gKGh0bWxDbGFzcykgPT4ge1xuICAgICAgICBjb25zdCBzcGFuID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnc3BhbicpO1xuICAgICAgICBzcGFuLmNsYXNzTGlzdC5hZGQoaHRtbENsYXNzKTtcbiAgICAgICAgcmV0dXJuIHNwYW47XG4gICAgfVxuXG4gICAgY29uc3QgY3JlYXRlSW1hZ2VFbGVtZW50ID0gKHNyYywgaHRtbENsYXNzKSA9PiB7XG4gICAgICAgIGNvbnN0IGltZyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2ltZycpO1xuICAgICAgICBpbWcuY2xhc3NMaXN0LmFkZChodG1sQ2xhc3MpO1xuICAgICAgICBpbWcuc2V0QXR0cmlidXRlKCdzcmMnLCBzcmMpO1xuICAgICAgICBpbWcuc2V0QXR0cmlidXRlKCdkcmFnZ2FibGUnLCAnZmFsc2UnKTtcbiAgICAgICAgcmV0dXJuIGltZztcbiAgICB9XG4gICAgXG4gICAgY29uc3QgY3JlYXRlRm9ybSA9ICgpID0+IHtcbiAgICAgICAgY29uc3QgaW5wdXRGb3JtID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZm9ybScpO1xuICAgICAgICByZXR1cm4gaW5wdXRGb3JtO1xuICAgIH1cblxuICAgIGNvbnN0IGNyZWF0ZUlucHV0RmllbGQgPSAocGxhY2Vob2xkZXJUZXh0KSA9PiB7XG4gICAgICAgIGNvbnN0IHVzZXJJbnB1dCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2lucHV0Jyk7XG4gICAgICAgIHVzZXJJbnB1dC5zZXRBdHRyaWJ1dGUoJ3R5cGUnLCAndGV4dCcpO1xuICAgICAgICB1c2VySW5wdXQuc2V0QXR0cmlidXRlKCdwbGFjZWhvbGRlcicsIHBsYWNlaG9sZGVyVGV4dCk7XG4gICAgICAgIHVzZXJJbnB1dC5zZXRBdHRyaWJ1dGUoJ2lkJywgJ3VzZXItaW5wdXQnKTtcbiAgICAgICAgdXNlcklucHV0LnJlcXVpcmVkID0gdHJ1ZTtcblxuICAgICAgICByZXR1cm4gdXNlcklucHV0O1xuICAgIH1cblxuICAgIGNvbnN0IGNyZWF0ZURpdiA9IChodG1sQ2xhc3MpID0+IHtcbiAgICAgICAgY29uc3QgZGl2ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gICAgICAgIGRpdi5zZXRBdHRyaWJ1dGUoJ2NsYXNzJywgaHRtbENsYXNzKTtcbiAgICAgICAgcmV0dXJuIGRpdjtcbiAgICB9XG5cbiAgICByZXR1cm4ge2NyZWF0ZUxpc3RFbGVtZW50LCBjcmVhdGVTcGFuRWxlbWVudCwgY3JlYXRlSW1hZ2VFbGVtZW50LCBjcmVhdGVJbnB1dEZpZWxkLCBjcmVhdGVGb3JtLCBjcmVhdGVEaXZ9XG59XG5cbmNvbnN0IGNyZWF0ZUljb25TcGFuID0gKCkgPT4ge1xuICAgIGNvbnN0IHZpZXcgPSBjcmVhdGVFbGVtZW50cygpO1xuXG4gICAgY29uc3QgaWNvblNwYW4gPSB2aWV3LmNyZWF0ZVNwYW5FbGVtZW50KCdpY29ucycpO1xuICAgIGNvbnN0IGVkaXRJY29uID0gdmlldy5jcmVhdGVJbWFnZUVsZW1lbnQoJ2ltYWdlcy9lZGl0LWljb24uc3ZnJywgJ2VkaXQtaWNvbicpO1xuICAgIGNvbnN0IGRlbGV0ZUljb24gPSB2aWV3LmNyZWF0ZUltYWdlRWxlbWVudCgnaW1hZ2VzL2RlbGV0ZS1pY29uLnN2ZycsICdkZWxldGUtaWNvbicpO1xuICAgIFxuICAgIGVkaXRJY29uLmNsYXNzTGlzdC5hZGQoJ2VkaXQtcHJvamVjdCcpO1xuICAgIGRlbGV0ZUljb24uY2xhc3NMaXN0LmFkZCgnZGVsZXRlLXByb2plY3QnKTtcbiAgICBcbiAgICBpY29uU3Bhbi5hcHBlbmQoZWRpdEljb24sIGRlbGV0ZUljb24pO1xuICAgIFxuICAgIHJldHVybiBpY29uU3Bhbjtcbn1cblxuY29uc3QgYWRkUHJvamVjdFRvU2lkZWJhciA9ICgpID0+IHtcbiAgICBjb25zdCB2aWV3ID0gY3JlYXRlRWxlbWVudHMoKTtcbiAgICBjb25zdCBwcm9qZWN0c0NvbnRhaW5lciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5wcm9qZWN0LWxpc3QnKTtcblxuICAgIGNvbnN0IHByb2plY3RMaXN0RWxlbWVudCA9ICB2aWV3LmNyZWF0ZUxpc3RFbGVtZW50KCdwcm9qZWN0LWl0ZW0nKTtcbiAgICBcbiAgICBjb25zdCBwcm9qZWN0SW5wdXRGb3JtID0gdmlldy5jcmVhdGVGb3JtKCk7XG4gICAgY29uc3QgcHJvamVjdE5hbWVJbnB1dCA9IHZpZXcuY3JlYXRlSW5wdXRGaWVsZCgnUHJvamVjdCBuYW1lLi4uJyk7XG4gICAgcHJvamVjdElucHV0Rm9ybS5hcHBlbmQocHJvamVjdE5hbWVJbnB1dCk7XG5cbiAgICBjb25zdCBpY29uU3BhbiA9IGNyZWF0ZUljb25TcGFuKCk7XG4gICAgcHJvamVjdExpc3RFbGVtZW50LmFwcGVuZChwcm9qZWN0SW5wdXRGb3JtLCBpY29uU3Bhbik7XG4gICAgcHJvamVjdHNDb250YWluZXIuaW5zZXJ0QmVmb3JlKHByb2plY3RMaXN0RWxlbWVudCwgcHJvamVjdHNDb250YWluZXIubGFzdEVsZW1lbnRDaGlsZCk7XG5cbiAgICBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgICAgcHJvamVjdE5hbWVJbnB1dC5mb2N1cygpO1xuICAgIH0sIDApO1xufVxuXG5jb25zdCBhZGRQcm9qZWN0VG9Ob3RlcGFkID0gKHByb2plY3RJZCkgPT4ge1xuICAgIGNvbnN0IHZpZXcgPSBjcmVhdGVFbGVtZW50cygpO1xuICAgIGNvbnN0IHByb2plY3RMaXN0ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnByb2plY3QtbGlzdCcpO1xuICAgIGNvbnN0IGN1cnJlbnRQcm9qZWN0TnVtYmVyID0gcHJvamVjdExpc3QuY2hpbGRFbGVtZW50Q291bnQgLSAyO1xuICAgIGNvbnN0IHByb2plY3ROYW1lID0gcHJvamVjdExpc3QuY2hpbGRyZW5bY3VycmVudFByb2plY3ROdW1iZXJdLnRleHRDb250ZW50O1xuXG4gICAgY29uc3Qgbm90ZXBhZCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJyN3cml0aW5nLWFyZWEnKTtcbiAgICBjb25zdCBwcm9qZWN0RGl2ID0gdmlldy5jcmVhdGVEaXYoJ3Byb2plY3QnKTtcbiAgICBwcm9qZWN0RGl2LnNldEF0dHJpYnV0ZSgnZGF0YS1wcm9qZWN0LWlkJywgcHJvamVjdElkKTtcbiAgICBjb25zdCBza2lwTGluZSA9IHZpZXcuY3JlYXRlRGl2KCdza2lwLWxpbmUnKTtcbiAgICBcbiAgICBjb25zdCBwcm9qZWN0SGVhZGluZyA9IHZpZXcuY3JlYXRlRGl2KCdwcm9qZWN0LWhlYWRpbmcnKTtcbiAgICBjb25zdCBoMiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2gyJyk7XG4gICAgaDIuc2V0QXR0cmlidXRlKCdjbGFzcycsICdub3RlcGFkLXRleHQnKTtcbiAgICBoMi50ZXh0Q29udGVudCA9IHByb2plY3ROYW1lO1xuICAgIGNvbnN0IGgzID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnaDMnKTtcbiAgICBoMy5zZXRBdHRyaWJ1dGUoJ2NsYXNzJywgJ25vdGVwYWQtdGV4dCcpO1xuICAgIGgzLnRleHRDb250ZW50ID0gJ0R1ZSBEYXRlJztcbiAgICAgICAgXG4gICAgY29uc3QgdGFza3NDb250YWluZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCd1bCcpO1xuICAgIHRhc2tzQ29udGFpbmVyLmNsYXNzTGlzdC5hZGQoJ25vdGVwYWQtdGV4dCcsICd0b2RvcycpO1xuXG4gICAgY29uc3QgYWRkVGFza0xpc3RFbGVtZW50ID0gdmlldy5jcmVhdGVMaXN0RWxlbWVudCgndGFzaycpO1xuICAgIGNvbnN0IGFkZFRhc2tTcGFuID0gdmlldy5jcmVhdGVTcGFuRWxlbWVudCgnYWRkLXRhc2snKTtcbiAgICBjb25zdCBhZGRJY29uID0gdmlldy5jcmVhdGVJbWFnZUVsZW1lbnQoJ2ltYWdlcy9hZGQtaWNvbi5zdmcnLCAnYWRkLWljb24nKTtcbiAgICBhZGRUYXNrU3Bhbi5hcHBlbmQoYWRkSWNvbiwgJ0FkZCBUYXNrJyk7XG5cbiAgICBhZGRUYXNrTGlzdEVsZW1lbnQuYXBwZW5kKGFkZFRhc2tTcGFuKTtcbiAgICB0YXNrc0NvbnRhaW5lci5hcHBlbmQoYWRkVGFza0xpc3RFbGVtZW50LCBza2lwTGluZSk7XG4gICAgcHJvamVjdEhlYWRpbmcuYXBwZW5kKGgyLCBoMyk7XG4gICAgcHJvamVjdERpdi5hcHBlbmQocHJvamVjdEhlYWRpbmcsIHRhc2tzQ29udGFpbmVyKTtcbiAgICBub3RlcGFkLmFwcGVuZChwcm9qZWN0RGl2KTtcbn1cblxuY29uc3QgX2NyZWF0ZVByb2plY3RJdGVtSFRNTCA9IChpZCwgbmFtZSkgPT4ge1xuICAgIC8vIGNyZWF0ZXMgSFRNTCBmb3IgcHJvamVjdCBpdGVtcyBpbiBzaWRlYmFyIGZyb20gbG9jYWxTdG9yYWdlIGl0ZW1cbiAgICBjb25zdCB2aWV3ID0gY3JlYXRlRWxlbWVudHMoKTtcblxuICAgIGNvbnN0IHByb2plY3RJdGVtID0gdmlldy5jcmVhdGVMaXN0RWxlbWVudCgncHJvamVjdC1pdGVtJyk7XG4gICAgcHJvamVjdEl0ZW0uc2V0QXR0cmlidXRlKCdkYXRhLXByb2plY3QtaWQnLCBpZCk7XG4gICAgY29uc3QgcHJvamVjdE5hbWUgPSB2aWV3LmNyZWF0ZVNwYW5FbGVtZW50KCdwcm9qZWN0LW5hbWUnKTtcbiAgICBwcm9qZWN0TmFtZS50ZXh0Q29udGVudCA9IG5hbWU7XG4gICAgY29uc3QgaWNvblNwYW4gPSBjcmVhdGVJY29uU3BhbigpO1xuXG4gICAgcHJvamVjdEl0ZW0uYXBwZW5kKHByb2plY3ROYW1lLCBpY29uU3Bhbik7XG5cbiAgICByZXR1cm4gcHJvamVjdEl0ZW07XG59XG5cbmNvbnN0IHVwZGF0ZVByb2plY3RMaXN0ID0gKHByb2plY3RzKSA9PiB7XG4gICAgY29uc3QgcHJvamVjdHNMaXN0Q29udGFpbmVyID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnByb2plY3QtbGlzdCcpO1xuICAgIGNvbnN0IGFkZFByb2plY3RCdG4gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCdbZGF0YS1hZGQtcHJvamVjdF0nKTtcbiAgICBcbiAgICAvLyBDbGVhciBhbGwgZWxlbWVudHMgb2YgY2xhc3MgJy5wcm9qZWN0LWl0ZW0nXG4gICAgY29uc3QgcHJvamVjdHNBcnJheSA9IFtdLnNsaWNlLmNhbGwocHJvamVjdHNMaXN0Q29udGFpbmVyLmNoaWxkcmVuKTtcbiAgICBwcm9qZWN0c0FycmF5LmZvckVhY2goaXRlbSA9PiB7XG4gICAgICAgIGlmIChpdGVtLmNsYXNzTGlzdC5jb250YWlucygncHJvamVjdC1pdGVtJykpIGl0ZW0ucmVtb3ZlKCk7XG4gICAgfSk7XG5cbiAgICBmb3IgKGNvbnN0IHByb2plY3Qgb2YgcHJvamVjdHMpIHtcbiAgICAgICAgY29uc3QgaHRtbCA9IF9jcmVhdGVQcm9qZWN0SXRlbUhUTUwocHJvamVjdC5pZCwgcHJvamVjdC5wcm9qZWN0TmFtZSk7XG4gICAgICAgIHByb2plY3RzTGlzdENvbnRhaW5lci5pbnNlcnRCZWZvcmUoaHRtbCwgYWRkUHJvamVjdEJ0bik7XG4gICAgfVxuXG4gICAgLy8gQWRkIGxpc3RlbmVycyBmb3IgZWRpdCwgZGVsZXRlID8/Pz9cbiAgICBwcm9qZWN0c0xpc3RDb250YWluZXIucXVlcnlTZWxlY3RvckFsbCgnLnByb2plY3QtaXRlbScpLmZvckVhY2gocHJvamVjdEl0ZW0gPT4ge1xuICAgICAgICBwcm9qZWN0SXRlbS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHtcbiAgICAgICAgICAgIGhhbmRsZXJzLm9uUHJvamVjdFNlbGVjdChwcm9qZWN0SXRlbS5kYXRhc2V0LnByb2plY3RJZCk7XG4gICAgICAgIH0pO1xuICAgIH0pO1xufVxuXG5jb25zdCB1cGRhdGVBY3RpdmVUYWIgPSAodGFiKSA9PiB7XG4gICAgLy8gZm9yIGFsbCBvdGhlciBwcm9qZWN0cywgY2hhbmdlIGRpc3BsYXkgdG8gbm9uZSwgdG8gYnJpbmcgYmFjayBzZXQgZGlzcGxheSB0byBjb250ZW50cyAgXG4gICAgICAgIC8vIGl0ZW0uc3R5bGUuZGlzcGxheSA9ICdub25lJ1xuICAgIC8vIHJlbW92ZSBhY3RpdmUgY2xhc3MgZnJvbSBhbnkgb3RoZXIgc2lkZWJhciBlbGVtZW50XG4gICAgY29uc3QgY3VycmVudEFjdGl2ZVRhYiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5hY3RpdmUnKTtcbiAgICBpZiAoY3VycmVudEFjdGl2ZVRhYikgY3VycmVudEFjdGl2ZVRhYi5jbGFzc0xpc3QucmVtb3ZlKCdhY3RpdmUnKTtcbiAgICB0YWIuY2xhc3NMaXN0LmFkZCgnYWN0aXZlJyk7XG4gICAgY29uc3QgcHJvamVjdE5hbWVTcGFuID0gdGFiLmNoaWxkcmVuLml0ZW0oMCk7IC8vIFVwZGF0ZSBub3RlcGFkIGhlcmU/XG4gICAgLy9jb25zb2xlLmxvZyhwcm9qZWN0TmFtZVNwYW4pO1xufVxuXG5leHBvcnQgeyBhZGRQcm9qZWN0VG9TaWRlYmFyLCBhZGRQcm9qZWN0VG9Ob3RlcGFkLCBjcmVhdGVFbGVtZW50cywgdXBkYXRlUHJvamVjdExpc3QsIHVwZGF0ZUFjdGl2ZVRhYn07IiwiaW1wb3J0IHsgYWRkUHJvamVjdFRvU2lkZWJhciwgYWRkUHJvamVjdFRvTm90ZXBhZCwgY3JlYXRlRWxlbWVudHMgfSBmcm9tIFwiLi9jcmVhdGVET01FbGVtZW50c1wiO1xuaW1wb3J0IGhhbmRsZXJzIGZyb20gXCIuL2hhbmRsZXJzXCI7XG5pbXBvcnQgdXBkYXRlU3RvcmFnZSBmcm9tIFwiLi9zdG9yYWdlXCJcblxuY29uc3QgYXdhaXRpbmdJbnB1dCA9ICgpID0+IHtcbiAgICBjb25zdCB1c2VySW5wdXQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcjdXNlci1pbnB1dCcpO1xuICAgIGlmICh1c2VySW5wdXQgIT0gbnVsbCkgcmV0dXJuIHRydWU7XG5cbiAgICByZXR1cm4gZmFsc2U7XG59XG5cbmNvbnN0IGhhbmRsZVVzZXJJbnB1dCA9ICgpID0+IHsgXG4gICAgLy8gVGhpcyBpcyBET00gU3R1ZmZcbiAgICBjb25zdCB1c2VySW5wdXQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcjdXNlci1pbnB1dCcpXG4gICAgY29uc3QgaW5wdXRGb3JtID0gdXNlcklucHV0LnBhcmVudEVsZW1lbnQ7XG4gICAgY29uc3QgcHJvamVjdEl0ZW0gPSBpbnB1dEZvcm0ucGFyZW50RWxlbWVudDtcbiAgICBjb25zdCBwcm9qZWN0U3BhbiA9IGNyZWF0ZUVsZW1lbnRzKCkuY3JlYXRlU3BhbkVsZW1lbnQoJ3Byb2plY3QtbmFtZScpO1xuICAgIFxuICAgIGNvbnN0IHByb2plY3ROYW1lID0gdXNlcklucHV0LnZhbHVlLnRyaW0oKTtcbiAgICBpZiAoIXByb2plY3ROYW1lKSByZXR1cm47XG5cbiAgICBwcm9qZWN0U3Bhbi50ZXh0Q29udGVudCA9IHByb2plY3ROYW1lO1xuICAgIHVzZXJJbnB1dC5wYXJlbnRFbGVtZW50LnJlbW92ZSgpO1xuICAgIHByb2plY3RJdGVtLmluc2VydEJlZm9yZShwcm9qZWN0U3BhbiwgcHJvamVjdEl0ZW0uY2hpbGROb2Rlc1swXSk7IFxufVxuXG5jb25zdCBhZGRQcm9qZWN0ID0gKCkgPT4ge1xuICAgIGlmIChhd2FpdGluZ0lucHV0KCkpIHJldHVybjtcbiAgICBhZGRQcm9qZWN0VG9TaWRlYmFyKCk7XG4gICAgXG4gICAgY29uc3QgdXNlcklucHV0ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignI3VzZXItaW5wdXQnKTtcbiAgICBjb25zdCBpbnB1dEZvcm0gPSB1c2VySW5wdXQucGFyZW50RWxlbWVudDtcbiAgICBjb25zdCBwcm9qZWN0SXRlbSA9IGlucHV0Rm9ybS5wYXJlbnRFbGVtZW50O1xuXG4gICAgdXNlcklucHV0LmFkZEV2ZW50TGlzdGVuZXIoJ2JsdXInLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGlmICh1c2VySW5wdXQudmFsdWUudHJpbSgpID09ICcnKSB7XG4gICAgICAgICAgICBwcm9qZWN0SXRlbS5yZW1vdmUoKTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBoYW5kbGVVc2VySW5wdXQoKTtcblxuICAgICAgICBjb25zdCBwcm9qZWN0TmFtZSA9IHByb2plY3RJdGVtLmZpcnN0RWxlbWVudENoaWxkLnRleHRDb250ZW50O1xuICAgICAgICBoYW5kbGVycy5vblByb2plY3RBZGQocHJvamVjdE5hbWUpOyBcblxuICAgICAgICBjb25zdCBwcm9qZWN0TGlzdCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5wcm9qZWN0LWxpc3QnKTtcbiAgICAgICAgLy8gU2VsZWN0IGxhc3QgcHJvamVjdCBhZGRlZCBhbmQgZ2V0IGlkIGF0dHJpYnV0ZVxuICAgICAgICBjb25zdCBwcm9qZWN0SWQgPSBwcm9qZWN0TGlzdC5jaGlsZHJlbltwcm9qZWN0TGlzdC5jaGlsZEVsZW1lbnRDb3VudCAtIDJdLmdldEF0dHJpYnV0ZSgnZGF0YS1wcm9qZWN0LWlkJyk7XG4gICAgICAgIGlmICghYXdhaXRpbmdJbnB1dCgpKSBhZGRQcm9qZWN0VG9Ob3RlcGFkKHByb2plY3RJZCk7XG4gICAgfSk7XG5cbiAgICBpbnB1dEZvcm0uYWRkRXZlbnRMaXN0ZW5lcignc3VibWl0JywgZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICBoYW5kbGVVc2VySW5wdXQoKTtcbiAgICAgICAgY29uc3QgcHJvamVjdE5hbWUgPSBwcm9qZWN0SXRlbS5maXJzdEVsZW1lbnRDaGlsZC50ZXh0Q29udGVudDtcbiAgICAgICAgaGFuZGxlcnMub25Qcm9qZWN0QWRkKHByb2plY3ROYW1lKTsgXG4gICAgICAgIGNvbnN0IHByb2plY3RMaXN0ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnByb2plY3QtbGlzdCcpO1xuICAgICAgICBjb25zdCBwcm9qZWN0SWQgPSBwcm9qZWN0TGlzdC5jaGlsZHJlbltwcm9qZWN0TGlzdC5jaGlsZEVsZW1lbnRDb3VudCAtIDJdLmdldEF0dHJpYnV0ZSgnZGF0YS1wcm9qZWN0LWlkJyk7XG4gICAgICAgIGlmICghYXdhaXRpbmdJbnB1dCgpKSBhZGRQcm9qZWN0VG9Ob3RlcGFkKHByb2plY3RJZCk7XG4gICAgfSk7XG59XG5jb25zdCBkZWxldGVQcm9qZWN0ID0gKCkgPT4ge1xuICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKGUpID0+IHtcbiAgICAgICAgaWYgKGUudGFyZ2V0LmNsb3Nlc3QoJy5kZWxldGUtcHJvamVjdCcpKSB7XG4gICAgICAgICAgICBjb25zdCBwcm9qZWN0SXRlbSA9IGUudGFyZ2V0LmNsb3Nlc3QoJy5wcm9qZWN0LWl0ZW0nKVxuICAgICAgICAgICAgcHJvamVjdEl0ZW0ucmVtb3ZlKCk7XG4gICAgICAgICAgICBjb25zdCBwcm9qZWN0SWQgPSBwcm9qZWN0SXRlbS5kYXRhc2V0LnByb2plY3RJZDtcbiAgICAgICAgICAgIHVwZGF0ZVN0b3JhZ2UuZGVsZXRlUHJvamVjdChwcm9qZWN0SWQpO1xuICAgICAgICB9XG4gICAgfSk7XG4gICAgLy8gVE9ETzogUmVtb3ZlIHByb2plY3QgZnJvbSBub3RlcGFkIGJ5IHJlbG9hZGluZyBsb2NhbFN0b3JhZ2UgaXRlbXMgZm9yIGN1cnJlbnQgc2VsZWN0ZWQgdGFiIChpLmUuIFRvZGF5KS4gSWYgY3VycmVudCBzZWxlY3QgdGFiIGlzIHRoZSBvbmUgdGhhdCBpcyBkZWxldGVkIGxvYWQgbm90ZXBhZCB3aXRoIEhvbWUgdGFiIFxufVxuXG4vLyBUT0RPOiBjcmVhdGUgZnVuY3Rpb24gdG8gdXBkYXRlIHByb2plY3QgbmFtZSBvbiBub3RlcGFkIHdoZW4gdXNlciBlZGl0cyBpdFxuIFxuY29uc3QgZWRpdFByb2plY3QgPSAoZSkgPT4ge1xuICAgIGlmIChhd2FpdGluZ0lucHV0KCkpIHJldHVybjtcbiAgICBcbiAgICAvLyBUaGlzIGlzIERPTSBTdHVmZlxuICAgIGNvbnN0IGlucHV0Rm9ybSA9IGNyZWF0ZUVsZW1lbnRzKCkuY3JlYXRlRm9ybSgpO1xuICAgIGNvbnN0IGlucHV0RmllbGQgPSBjcmVhdGVFbGVtZW50cygpLmNyZWF0ZUlucHV0RmllbGQoJ1Byb2plY3QgbmFtZS4uLicpO1xuICAgIGNvbnN0IHByb2plY3ROYW1lID0gZS50YXJnZXQucGFyZW50RWxlbWVudC5wcmV2aW91c0VsZW1lbnRTaWJsaW5nO1xuXG4gICAgaW5wdXRGaWVsZC52YWx1ZSA9IHByb2plY3ROYW1lLnRleHRDb250ZW50O1xuICAgIHByb2plY3ROYW1lLnJlbW92ZSgpO1xuICAgIGlucHV0Rm9ybS5hcHBlbmQoaW5wdXRGaWVsZCk7XG5cbiAgICBjb25zdCBwcm9qZWN0SXRlbSA9IGUudGFyZ2V0LmNsb3Nlc3QoJy5wcm9qZWN0LWl0ZW0nKTtcbiAgICBwcm9qZWN0SXRlbS5pbnNlcnRCZWZvcmUoaW5wdXRGb3JtLCBwcm9qZWN0SXRlbS5jaGlsZE5vZGVzWzBdKTtcblxuICAgIGNvbnN0IHVzZXJJbnB1dCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJyN1c2VyLWlucHV0Jyk7XG4gICAgXG4gICAgY29uc3QgcHJvamVjdElkID0gcHJvamVjdEl0ZW0uZGF0YXNldC5wcm9qZWN0SWQ7XG5cbiAgICB1c2VySW5wdXQuYWRkRXZlbnRMaXN0ZW5lcignYmx1cicsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgaWYgKHVzZXJJbnB1dC52YWx1ZSAhPSAnJykgaGFuZGxlVXNlcklucHV0KCk7XG4gICAgICAgIC8vaWYgKCFhd2FpdGluZ0lucHV0KCkpIGVkaXRQcm9qZWN0T25Ob3RlcGFkKCk7XG4gICAgICAgIGNvbnN0IHByb2plY3ROYW1lID0gcHJvamVjdEl0ZW0uZmlyc3RFbGVtZW50Q2hpbGQudGV4dENvbnRlbnQ7XG4gICAgICAgIGhhbmRsZXJzLm9uUHJvamVjdE5hbWVFZGl0KHByb2plY3RJZCwgcHJvamVjdE5hbWUpO1xuICAgIH0pO1xuXG4gICAgaW5wdXRGb3JtLmFkZEV2ZW50TGlzdGVuZXIoJ3N1Ym1pdCcsIGZ1bmN0aW9uIChlKSB7XG4gICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgaGFuZGxlVXNlcklucHV0KCk7XG4gICAgICAgIC8vaWYgKCFhd2FpdGluZ0lucHV0KCkpIGVkaXRQcm9qZWN0T25Ob3RlcGFkKCk7XG4gICAgICAgIGNvbnN0IHByb2plY3ROYW1lID0gcHJvamVjdEl0ZW0uZmlyc3RFbGVtZW50Q2hpbGQudGV4dENvbnRlbnQ7XG4gICAgICAgIGhhbmRsZXJzLm9uUHJvamVjdE5hbWVFZGl0KHByb2plY3RJZCwgcHJvamVjdE5hbWUpO1xuICAgIH0pO1xufVxuXG5leHBvcnQgeyBcbiAgICBhZGRQcm9qZWN0LFxuICAgIGRlbGV0ZVByb2plY3QsXG4gICAgZWRpdFByb2plY3Rcbn0iLCJpbXBvcnQge2NyZWF0ZUVsZW1lbnRzfSBmcm9tIFwiLi9jcmVhdGVET01FbGVtZW50c1wiO1xuaW1wb3J0IHtmb3JtYXR9IGZyb20gXCJkYXRlLWZuc1wiO1xuaW1wb3J0IGhhbmRsZXJzIGZyb20gXCIuL2hhbmRsZXJzXCI7XG5pbXBvcnQgdXBkYXRlU3RvcmFnZSBmcm9tIFwiLi9zdG9yYWdlXCI7XG5cbmNvbnN0IHRvZ2dsZVRhc2sgPSAodGFza0VsZW1lbnQpID0+IHtcbiAgICB0YXNrRWxlbWVudC5jbGFzc0xpc3QudG9nZ2xlKCdjb21wbGV0ZWQnKTtcbn1cblxuY29uc3QgYWRkVGFza1RvRE9NID0gKGFkZFRhc2tCdG4pID0+IHtcbiAgICBpZiAoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3VzZXItaW5wdXQnKSkgcmV0dXJuO1xuICAgIGNvbnN0IHRhc2tMaXN0RWxlbWVudCA9IGNyZWF0ZUVsZW1lbnRzKCkuY3JlYXRlTGlzdEVsZW1lbnQoJ3Rhc2snKTtcbiAgICBjb25zdCB0YXNrU3BhbiA9IGNyZWF0ZUVsZW1lbnRzKCkuY3JlYXRlU3BhbkVsZW1lbnQoJ3Rhc2staXRlbScpO1xuICAgIGNvbnN0IGlucHV0Rm9ybSA9IGNyZWF0ZUVsZW1lbnRzKCkuY3JlYXRlRm9ybSgpO1xuICAgIGNvbnN0IGlucHV0RmllbGQgPSBjcmVhdGVFbGVtZW50cygpLmNyZWF0ZUlucHV0RmllbGQoJ0VudGVyIFRhc2suLi4nKTtcbiAgICBcbiAgICBpbnB1dEZvcm0uYXBwZW5kKGlucHV0RmllbGQpO1xuICAgIHRhc2tTcGFuLmFwcGVuZChpbnB1dEZvcm0pO1xuXG4gICAgY29uc3QgaWNvblNwYW4gPSBjcmVhdGVFbGVtZW50cygpLmNyZWF0ZVNwYW5FbGVtZW50KCdpY29ucycpO1xuICAgIGNvbnN0IGVkaXRJY29uID0gY3JlYXRlRWxlbWVudHMoKS5jcmVhdGVJbWFnZUVsZW1lbnQoJ2ltYWdlcy9lZGl0LWljb24uc3ZnJywgJ2VkaXQtaWNvbicpO1xuICAgIGNvbnN0IGRlbGV0ZUljb24gPSBjcmVhdGVFbGVtZW50cygpLmNyZWF0ZUltYWdlRWxlbWVudCgnaW1hZ2VzL2RlbGV0ZS1pY29uLnN2ZycsICdkZWxldGUtaWNvbicpO1xuXG4gICAgZWRpdEljb24uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB7XG4gICAgICAgIGlmICh0YXNrTGlzdEVsZW1lbnQuY2xhc3NMaXN0LmNvbnRhaW5zKCdjb21wbGV0ZWQnKSkgcmV0dXJuO1xuICAgICAgICBjb25zdCB0YXNrVGV4dFNwYW4gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcudGFzay10ZXh0Jyk7XG4gICAgICAgIGNvbnN0IHRhc2tOYW1lID0gdGFza1RleHRTcGFuLnRleHRDb250ZW50O1xuICAgICAgICB0YXNrVGV4dFNwYW4ucmVtb3ZlKCk7XG4gICAgICAgIFxuICAgICAgICBjb25zdCBpbnB1dEZvcm0gPSBjcmVhdGVFbGVtZW50cygpLmNyZWF0ZUZvcm0oKTtcbiAgICAgICAgY29uc3QgaW5wdXRGaWVsZCA9IGNyZWF0ZUVsZW1lbnRzKCkuY3JlYXRlSW5wdXRGaWVsZCgnRW50ZXIgVGFzay4uLicpO1xuXG4gICAgICAgIGlucHV0RmllbGQudmFsdWUgPSB0YXNrTmFtZTtcbiAgICAgICAgXG4gICAgICAgIGlucHV0Rm9ybS5hcHBlbmQoaW5wdXRGaWVsZCk7XG4gICAgICAgIHRhc2tTcGFuLmluc2VydEJlZm9yZShpbnB1dEZvcm0sIGljb25TcGFuKTtcbiAgICAgICAgdGFza0xpc3RFbGVtZW50LnByZXBlbmQodGFza1NwYW4pO1xuICAgICAgICBhZGRUYXNrKCk7XG4gICAgfSk7XG5cbiAgICBkZWxldGVJY29uLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKGUpID0+IHtcbiAgICAgICAgY29uc3QgcHJvamVjdElkID0gZS50YXJnZXQuY2xvc2VzdCgnW2RhdGEtcHJvamVjdC1pZF0nKS5kYXRhc2V0LnByb2plY3RJZDtcbiAgICAgICAgY29uc3QgdGFza0lkID0gZS50YXJnZXQuY2xvc2VzdCgnW2RhdGEtdGFzay1pZF0nKS5kYXRhc2V0LnRhc2tJZDtcblxuICAgICAgICB0YXNrTGlzdEVsZW1lbnQucmVtb3ZlKCk7XG4gICAgICAgIHVwZGF0ZVN0b3JhZ2UuZGVsZXRlVGFzayhwcm9qZWN0SWQsIHRhc2tJZCk7XG4gICAgfSk7XG5cbiAgICBpY29uU3Bhbi5hcHBlbmQoZWRpdEljb24sIGRlbGV0ZUljb24pO1xuICAgIHRhc2tTcGFuLmFwcGVuZChpY29uU3Bhbik7XG4gICAgY29uc3QgZHVlRGF0ZSA9IGFkZER1ZURhdGVUb0RPTSgpO1xuICAgIHRhc2tMaXN0RWxlbWVudC5hcHBlbmQodGFza1NwYW4sIGR1ZURhdGUpO1xuICAgIFxuICAgIGNvbnN0IGNvbnRhaW5lciA9IGFkZFRhc2tCdG4uY2xvc2VzdCgnLnRvZG9zJyk7XG4gICAgY29uc3QgbnVtYmVyT2ZUYXNrcyA9IGNvbnRhaW5lci5jaGlsZEVsZW1lbnRDb3VudCAtIDI7XG5cbiAgICBjb250YWluZXIuaW5zZXJ0QmVmb3JlKHRhc2tMaXN0RWxlbWVudCwgY29udGFpbmVyLmNoaWxkcmVuW251bWJlck9mVGFza3NdKTtcblxuICAgIHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgICBpbnB1dEZpZWxkLmZvY3VzKCk7XG4gICAgfSwgMCk7XG5cbiAgICByZXR1cm4gdGFza1NwYW47XG59XG5cbmNvbnN0IGFkZER1ZURhdGVUb0RPTSA9ICgpID0+IHtcbiAgICBjb25zdCBkdWVEYXRlU3BhbiA9IGNyZWF0ZUVsZW1lbnRzKCkuY3JlYXRlU3BhbkVsZW1lbnQoJ2R1ZS1kYXRlJyk7XG5cbiAgICBjb25zdCBwcmlvcml0eUljb24gPSBjcmVhdGVFbGVtZW50cygpLmNyZWF0ZUltYWdlRWxlbWVudCgnaW1hZ2VzL3ByaW9yaXR5LWljb24uc3ZnJywgJ3ByaW9yaXR5LWljb24nKVxuICAgIHByaW9yaXR5SWNvbi5jbGFzc0xpc3QuYWRkKCdwcmlvcml0eS1sb3cnKTtcbiAgICBcbiAgICBjb25zdCBkYXRlTGFiZWwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdsYWJlbCcpO1xuICAgIGRhdGVMYWJlbC5jbGFzc0xpc3QuYWRkKCdkYXRlLWxhYmVsJyk7XG4gICAgXG4gICAgY29uc3QgZGF0ZUlucHV0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnaW5wdXQnKTtcbiAgICBkYXRlSW5wdXQuc2V0QXR0cmlidXRlKCd0eXBlJywgJ2RhdGUnKTtcbiAgICBkYXRlSW5wdXQucmVxdWlyZWQgPSB0cnVlO1xuXG4gICAgY29uc3QgY2FsZW5kYXJJY29uID0gY3JlYXRlRWxlbWVudHMoKS5jcmVhdGVJbWFnZUVsZW1lbnQoJ2ltYWdlcy9jYWxlbmRhci1pY29uLnN2ZycsICdjYWxlbmRhci1pY29uJyk7XG5cbiAgICBkYXRlTGFiZWwuYXBwZW5kKGRhdGVJbnB1dCwgY2FsZW5kYXJJY29uKTtcbiAgICBkdWVEYXRlU3Bhbi5hcHBlbmQocHJpb3JpdHlJY29uLCBkYXRlTGFiZWwpO1xuXG4gICAgcmV0dXJuIGR1ZURhdGVTcGFuO1xufVxuXG5jb25zdCBhZGRUYXNrID0gKCkgPT4ge1xuICAgIGNvbnN0IGlucHV0RmllbGQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcjdXNlci1pbnB1dCcpO1xuICAgIGNvbnN0IGlucHV0Rm9ybSA9IGlucHV0RmllbGQucGFyZW50RWxlbWVudDtcbiAgICBjb25zdCB0YXNrQ29udGFpbmVyID0gaW5wdXRGb3JtLnBhcmVudEVsZW1lbnQucGFyZW50RWxlbWVudDtcbiAgICBcbiAgICBpbnB1dEZpZWxkLmFkZEV2ZW50TGlzdGVuZXIoJ2JsdXInLCBmdW5jdGlvbiAoZSkge1xuICAgICAgICBjb25zdCBwcm9qZWN0SWQgPSBlLnRhcmdldC5jbG9zZXN0KCdbZGF0YS1wcm9qZWN0LWlkXScpLmRhdGFzZXQucHJvamVjdElkO1xuICAgICAgICBjb25zdCB0YXNrID0gaW5wdXRGaWVsZC52YWx1ZTtcbiAgICAgICAgdmFsaWRhdGVVc2VySW5wdXQoKTtcbiAgICAgICAgaWYgKHRhc2spIGNyZWF0ZVRhc2sodGFzaywgcHJvamVjdElkLCB0YXNrQ29udGFpbmVyKTtcbiAgICB9KTtcbiAgICBcbiAgICBpbnB1dEZvcm0uYWRkRXZlbnRMaXN0ZW5lcignc3VibWl0JywgZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICBjb25zdCBwcm9qZWN0SWQgPSBlLnRhcmdldC5jbG9zZXN0KCdbZGF0YS1wcm9qZWN0LWlkXScpLmRhdGFzZXQucHJvamVjdElkO1xuICAgICAgICBjb25zdCB0YXNrID0gaW5wdXRGaWVsZC52YWx1ZTtcbiAgICAgICAgdmFsaWRhdGVVc2VySW5wdXQoKTtcbiAgICAgICAgaWYgKHRhc2spIGNyZWF0ZVRhc2sodGFzaywgcHJvamVjdElkLCB0YXNrQ29udGFpbmVyKTtcbiAgICB9KTtcbn1cblxuY29uc3QgY3JlYXRlVGFzayA9ICh0YXNrLCBwcm9qZWN0SWQsIHRhc2tDb250YWluZXIpID0+IHtcbiAgICBpZiAodGFza0NvbnRhaW5lci5kYXRhc2V0LnRhc2tJZCkge1xuICAgICAgICByZXR1cm4gaGFuZGxlcnMub25UYXNrTmFtZUVkaXQocHJvamVjdElkLCB0YXNrQ29udGFpbmVyLmRhdGFzZXQudGFza0lkLCB0YXNrKTtcbiAgICB9XG4gICAgY29uc3QgdGFza09iaiA9IGhhbmRsZXJzLm9uVGFza0FkZCh0YXNrLCBwcm9qZWN0SWQpO1xuICAgIHRhc2tDb250YWluZXIuc2V0QXR0cmlidXRlKCdkYXRhLXRhc2staWQnLCB0YXNrT2JqLnRhc2tJZCk7XG59XG5cbmNvbnN0IHZhbGlkYXRlVXNlcklucHV0ID0gKCkgPT4ge1xuICAgIGNvbnN0IGlucHV0RmllbGQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcjdXNlci1pbnB1dCcpO1xuICAgIGNvbnN0IGlucHV0Rm9ybSA9IGlucHV0RmllbGQucGFyZW50RWxlbWVudDtcbiAgICBjb25zdCB0YXNrSXRlbSA9IGlucHV0Rm9ybS5wYXJlbnRFbGVtZW50O1xuICAgIGNvbnN0IHRhc2tDb250YWluZXIgPSB0YXNrSXRlbS5wYXJlbnRFbGVtZW50O1xuXG4gICAgY29uc3QgdXNlcklucHV0ID0gaW5wdXRGaWVsZC52YWx1ZS50cmltKCk7XG4gICAgY29uc3QgdGFza1RleHRTcGFuID0gY3JlYXRlRWxlbWVudHMoKS5jcmVhdGVTcGFuRWxlbWVudCgndGFzay10ZXh0Jyk7XG4gICAgdGFza1RleHRTcGFuLmFwcGVuZCh1c2VySW5wdXQpO1xuXG4gICAgaWYgKHVzZXJJbnB1dCA9PSAnJykge1xuICAgICAgICB0YXNrQ29udGFpbmVyLnJlbW92ZSgpO1xuICAgICAgICByZXR1cm47XG4gICAgfVxuICAgIGlucHV0Rm9ybS5yZW1vdmUoKTtcbiAgICB0YXNrSXRlbS5wcmVwZW5kKHRhc2tUZXh0U3Bhbik7XG59XG5cbi8vIFRPRE86IFVwZGF0ZSBwcmlvcml0eSBpbiBsb2NhbFN0b3JhZ2VcbmNvbnN0IHVwZGF0ZVByaW9yaXR5ID0gKGV2ZW50VGFyZ2V0KSA9PiB7XG4gICAgY29uc3QgdGFza0l0ZW1DbGFzc0xpc3QgPSBldmVudFRhcmdldC5wYXJlbnRFbGVtZW50LnBhcmVudEVsZW1lbnQuY2xhc3NMaXN0O1xuICAgIGlmICh0YXNrSXRlbUNsYXNzTGlzdC5jb250YWlucygnY29tcGxldGVkJykpIHJldHVybjtcblxuICAgIGNvbnN0IHByaW9yaXR5Q2xhc3NMaXN0ID0gZXZlbnRUYXJnZXQuY2xhc3NMaXN0O1xuXG4gICAgaWYgKHByaW9yaXR5Q2xhc3NMaXN0LmNvbnRhaW5zKCdwcmlvcml0eS1sb3cnKSkge1xuICAgICAgICBwcmlvcml0eUNsYXNzTGlzdC5yZW1vdmUoJ3ByaW9yaXR5LWxvdycpO1xuICAgICAgICBwcmlvcml0eUNsYXNzTGlzdC5hZGQoJ3ByaW9yaXR5LW1lZGl1bScpO1xuICAgICAgICByZXR1cm47XG4gICAgfVxuICAgIGlmIChwcmlvcml0eUNsYXNzTGlzdC5jb250YWlucygncHJpb3JpdHktbWVkaXVtJykpIHtcbiAgICAgICAgcHJpb3JpdHlDbGFzc0xpc3QucmVtb3ZlKCdwcmlvcml0eS1tZWRpdW0nKTtcbiAgICAgICAgcHJpb3JpdHlDbGFzc0xpc3QuYWRkKCdwcmlvcml0eS1oaWdoJyk7XG4gICAgICAgIHJldHVybjtcbiAgICB9XG4gICAgaWYgKHByaW9yaXR5Q2xhc3NMaXN0LmNvbnRhaW5zKCdwcmlvcml0eS1oaWdoJykpIHtcbiAgICAgICAgcHJpb3JpdHlDbGFzc0xpc3QucmVtb3ZlKCdwcmlvcml0eS1oaWdoJyk7XG4gICAgICAgIHByaW9yaXR5Q2xhc3NMaXN0LmFkZCgncHJpb3JpdHktbG93Jyk7XG4gICAgICAgIHJldHVybjtcbiAgICB9XG59XG5cbmV4cG9ydCB7XG4gICAgdG9nZ2xlVGFzayxcbiAgICBhZGRUYXNrVG9ET00sXG4gICAgYWRkVGFzayxcbiAgICB1cGRhdGVQcmlvcml0eSxcbn0iLCJpbXBvcnQgeyBhZGRQcm9qZWN0LCBkZWxldGVQcm9qZWN0LCBlZGl0UHJvamVjdCB9IGZyb20gXCIuL3Byb2plY3RzXCI7XG5pbXBvcnQgdXBkYXRlU3RvcmFnZSBmcm9tIFwiLi9zdG9yYWdlXCI7XG5pbXBvcnQgeyB1cGRhdGVQcm9qZWN0TGlzdCB9IGZyb20gXCIuL2NyZWF0ZURPTUVsZW1lbnRzXCI7XG5pbXBvcnQgeyB0b2dnbGVUYXNrLCBhZGRUYXNrVG9ET00sIGFkZFRhc2ssIHVwZGF0ZVByaW9yaXR5IH0gZnJvbSBcIi4vdGFza3NcIjtcblxuLy8gTG9hZCBsb2NhbFN0b3JhZ2UgaXRlbXMgb24gcGFnZSBsb2FkXG53aW5kb3cub25sb2FkID0gKCkgPT4ge1xuICAgIGNvbnN0IHByb2plY3RzID0gdXBkYXRlU3RvcmFnZS5nZXRQcm9qZWN0cygpO1xuICAgIHVwZGF0ZVByb2plY3RMaXN0KHByb2plY3RzKTtcbn1cblxuLy8gU2lkZWJhciBNb2R1bGVcbmNvbnN0IHNpZGViYXJDb250cm9sbGVyID0gKCgpID0+IHtcblxuICAgIGNvbnN0IG1vYmlsZVRvZ2dsZUJ0biA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdiYXJzLWljb24tbW9iaWxlJyk7XG4gICAgaWYgKHdpbmRvdy5pbm5lcldpZHRoIDw9IDEwMjQgJiYgbW9iaWxlVG9nZ2xlQnRuLmNsYXNzTGlzdC5jb250YWlucygnaGlkZGVuJykpIHtcbiAgICAgICAgbW9iaWxlVG9nZ2xlQnRuLmNsYXNzTGlzdC50b2dnbGUoJ2hpZGRlbicpO1xuICAgIH1cblxuICAgIGNvbnN0IHNpZGViYXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc2lkZWJhcicpO1xuICAgIFxuICAgIGNvbnN0IHRvZ2dsZVNpZGViYXIgPSAoKSA9PiB7XG4gICAgICAgIHNpZGViYXIuY2xhc3NMaXN0LnRvZ2dsZSgndG9nZ2xlLXNpZGViYXInKTtcbiAgICAgICAgaWYgKHdpbmRvdy5pbm5lcldpZHRoIDw9IDEwMjQpIG1vYmlsZVRvZ2dsZUJ0bi5jbGFzc0xpc3QudG9nZ2xlKCdoaWRkZW4nKTtcbiAgICB9XG4gICAgXG4gICAgY29uc3QgdG9nZ2xlQnRuID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLmJhcnMtaWNvbicpO1xuICAgIHRvZ2dsZUJ0bi5mb3JFYWNoKGJ1dHRvbiA9PiB7XG4gICAgICAgIGJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIHRvZ2dsZVNpZGViYXIpO1xuICAgIH0pOyAgICAgICAgXG59KSgpO1xuXG5jb25zdCBwcm9qZWN0Q29udHJvbGxlciA9ICgoKSA9PiB7XG4gICAgZGVsZXRlUHJvamVjdCgpO1xuICAgIGNvbnN0IGFkZFByb2plY3RCdG4gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCdbZGF0YS1hZGQtcHJvamVjdF0nKTtcbiAgICBhZGRQcm9qZWN0QnRuLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgYWRkUHJvamVjdCk7XG5cbiAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIChlKSA9PiB7XG4gICAgICAgIGlmIChlLnRhcmdldC5jbGFzc0xpc3QuY29udGFpbnMoJ2VkaXQtcHJvamVjdCcpKSB7XG4gICAgICAgICAgICBlZGl0UHJvamVjdChlKTtcbiAgICAgICAgfVxuICAgIH0pO1xufSkoKTtcblxuY29uc3QgdGFza0NvbnRyb2xsZXIgPSAoKCkgPT4ge1xuICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKGUpID0+IHtcbiAgICAgICAgaWYgKGUudGFyZ2V0LmNsYXNzTGlzdC5jb250YWlucygndGFzay1pdGVtJykpIHtcbiAgICAgICAgICAgIGNvbnN0IHRhc2tFbGVtZW50ID0gZS50YXJnZXQucGFyZW50RWxlbWVudDtcbiAgICAgICAgICAgIHRvZ2dsZVRhc2sodGFza0VsZW1lbnQpO1xuICAgICAgICB9XG4gICAgICAgIGlmIChlLnRhcmdldC5jbGFzc0xpc3QuY29udGFpbnMoJ2FkZC10YXNrJykpIHtcbiAgICAgICAgICAgIGFkZFRhc2tUb0RPTShlLnRhcmdldCk7XG4gICAgICAgICAgICBhZGRUYXNrKCk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGUudGFyZ2V0LmNsYXNzTGlzdC5jb250YWlucygncHJpb3JpdHktaWNvbicpKSB7XG4gICAgICAgICAgICB1cGRhdGVQcmlvcml0eShlLnRhcmdldCk7XG4gICAgICAgIH1cbiAgICB9KTtcbn0pKCk7XG4vKlxudXBkYXRlU3RvcmFnZS5zYXZlUHJvamVjdCh7XG4gICAgcHJvamVjdE5hbWU6IFwiUHJvamVjdCAxXCIsXG4gICAgdGFza3M6IFtbXCJGaW5pc2ggdG9kbyBsaXN0XCIsIFwibG93XCIsIFwiZHVlRGF0ZVwiLCBmYWxzZV0sIFtcIkRvIHNvbWV0aGluZ1wiLCBcIm1lZGl1bVwiLCBcImR1ZURhdGVcIiwgdHJ1ZV0sIFtcIkRvIHNvbWV0aGluZyBlbHNlXCIsIFwiaGlnaFwiLCBcImR1ZURhdGVcIiwgZmFsc2VdXSxcbiAgICBpZDogODE2MDg5XG59KTtcbiovXG4vL3N0b3JhZ2UuZGVsZXRlUHJvamVjdCg1ODE4NDApOyJdLCJuYW1lcyI6WyJnZXRQcm9qZWN0cyIsIkpTT04iLCJwYXJzZSIsImxvY2FsU3RvcmFnZSIsImdldEl0ZW0iLCJzYXZlUHJvamVjdCIsInByb2plY3RUb1NhdmUiLCJwcm9qZWN0cyIsImV4aXN0aW5nIiwiZmluZCIsInByb2plY3QiLCJpZCIsInByb2plY3ROYW1lIiwidGFza3MiLCJNYXRoIiwiZmxvb3IiLCJyYW5kb20iLCJwdXNoIiwic2V0SXRlbSIsInN0cmluZ2lmeSIsImdldFRhc2tzIiwicHJvamVjdElkIiwiZGVsZXRlUHJvamVjdCIsInVwZGF0ZWRQcm9qZWN0TGlzdCIsImZpbHRlciIsImRlbGV0ZVRhc2siLCJ0YXNrSWQiLCJwcm9qZWN0V2l0aFRhc2siLCJ1cGRhdGVkVGFza09iaiIsInRhc2tPYmoiLCJmaW5kVGFza1RvVXBkYXRlIiwiZXhpc3RpbmdUYXNrSWQiLCJ0YXNrIiwidXBkYXRlVGFzayIsInVwZGF0ZWRUYXNrIiwicHJvamVjdFRvVXBkYXRlIiwidGFza3NBcnJheSIsImluZGV4T2ZVcGRhdGVkVGFzayIsImZpbmRJbmRleCIsIl9yZWZyZXNoUHJvamVjdExpc3QiLCJfc2V0UHJvamVjdExpc3QiLCJ1cGRhdGVQcm9qZWN0TGlzdCIsIl9zZXRBY3RpdmVUYWIiLCJ0YWIiLCJ1cGRhdGVBY3RpdmVUYWIiLCJvblByb2plY3RTZWxlY3QiLCJwcm9qZWN0T2JqZWN0Iiwic2VsZWN0ZWRQcm9qZWN0IiwiZG9jdW1lbnQiLCJxdWVyeVNlbGVjdG9yIiwib25Qcm9qZWN0QWRkIiwibmV3UHJvamVjdCIsIm5ld1Byb2plY3RET01FbGVtZW50Iiwib25Qcm9qZWN0TmFtZUVkaXQiLCJvblRhc2tBZGQiLCJuZXdUYXNrIiwiaXRlbSIsInByaW9yaXR5IiwiZHVlRGF0ZSIsImlzQ29tcGxldGUiLCJvblRhc2tOYW1lRWRpdCIsIm5ld1Rhc2tOYW1lIiwiZXhpc3RpbmdUYXNrIiwiY3JlYXRlRWxlbWVudHMiLCJjcmVhdGVMaXN0RWxlbWVudCIsImh0bWxDbGFzcyIsImxpIiwiY3JlYXRlRWxlbWVudCIsInNldEF0dHJpYnV0ZSIsImNyZWF0ZVNwYW5FbGVtZW50Iiwic3BhbiIsImNsYXNzTGlzdCIsImFkZCIsImNyZWF0ZUltYWdlRWxlbWVudCIsInNyYyIsImltZyIsImNyZWF0ZUlucHV0RmllbGQiLCJwbGFjZWhvbGRlclRleHQiLCJ1c2VySW5wdXQiLCJyZXF1aXJlZCIsImNyZWF0ZUZvcm0iLCJjcmVhdGVEaXYiLCJkaXYiLCJjcmVhdGVJY29uU3BhbiIsInZpZXciLCJpY29uU3BhbiIsImVkaXRJY29uIiwiZGVsZXRlSWNvbiIsImFwcGVuZCIsImFkZFByb2plY3RUb05vdGVwYWQiLCJwcm9qZWN0TGlzdCIsImN1cnJlbnRQcm9qZWN0TnVtYmVyIiwiY2hpbGRFbGVtZW50Q291bnQiLCJjaGlsZHJlbiIsInRleHRDb250ZW50Iiwibm90ZXBhZCIsInByb2plY3REaXYiLCJza2lwTGluZSIsInByb2plY3RIZWFkaW5nIiwiaDIiLCJoMyIsInRhc2tzQ29udGFpbmVyIiwiYWRkVGFza0xpc3RFbGVtZW50IiwiYWRkVGFza1NwYW4iLCJhZGRJY29uIiwiX2NyZWF0ZVByb2plY3RJdGVtSFRNTCIsIm5hbWUiLCJwcm9qZWN0SXRlbSIsInByb2plY3RzTGlzdENvbnRhaW5lciIsImFkZFByb2plY3RCdG4iLCJzbGljZSIsImNhbGwiLCJmb3JFYWNoIiwiY29udGFpbnMiLCJyZW1vdmUiLCJodG1sIiwiaW5zZXJ0QmVmb3JlIiwicXVlcnlTZWxlY3RvckFsbCIsImFkZEV2ZW50TGlzdGVuZXIiLCJkYXRhc2V0IiwiY3VycmVudEFjdGl2ZVRhYiIsImF3YWl0aW5nSW5wdXQiLCJoYW5kbGVVc2VySW5wdXQiLCJwYXJlbnRFbGVtZW50IiwicHJvamVjdFNwYW4iLCJ2YWx1ZSIsInRyaW0iLCJjaGlsZE5vZGVzIiwiYWRkUHJvamVjdCIsInByb2plY3RzQ29udGFpbmVyIiwicHJvamVjdExpc3RFbGVtZW50IiwicHJvamVjdElucHV0Rm9ybSIsInByb2plY3ROYW1lSW5wdXQiLCJsYXN0RWxlbWVudENoaWxkIiwic2V0VGltZW91dCIsImZvY3VzIiwiYWRkUHJvamVjdFRvU2lkZWJhciIsImlucHV0Rm9ybSIsImZpcnN0RWxlbWVudENoaWxkIiwiZ2V0QXR0cmlidXRlIiwiZSIsInByZXZlbnREZWZhdWx0IiwiYWRkVGFzayIsImlucHV0RmllbGQiLCJ0YXNrQ29udGFpbmVyIiwidGFyZ2V0IiwiY2xvc2VzdCIsInZhbGlkYXRlVXNlcklucHV0IiwiY3JlYXRlVGFzayIsInRhc2tJdGVtIiwidGFza1RleHRTcGFuIiwicHJlcGVuZCIsIndpbmRvdyIsIm9ubG9hZCIsIm1vYmlsZVRvZ2dsZUJ0biIsImdldEVsZW1lbnRCeUlkIiwiaW5uZXJXaWR0aCIsInRvZ2dsZSIsInNpZGViYXIiLCJ0b2dnbGVTaWRlYmFyIiwiYnV0dG9uIiwicHJldmlvdXNFbGVtZW50U2libGluZyIsImVkaXRQcm9qZWN0IiwiYWRkVGFza0J0biIsInRhc2tMaXN0RWxlbWVudCIsInRhc2tTcGFuIiwidGFza05hbWUiLCJkdWVEYXRlU3BhbiIsInByaW9yaXR5SWNvbiIsImRhdGVMYWJlbCIsImRhdGVJbnB1dCIsImNhbGVuZGFySWNvbiIsImFkZER1ZURhdGVUb0RPTSIsImNvbnRhaW5lciIsIm51bWJlck9mVGFza3MiLCJhZGRUYXNrVG9ET00iLCJldmVudFRhcmdldCIsInByaW9yaXR5Q2xhc3NMaXN0IiwidXBkYXRlUHJpb3JpdHkiXSwic291cmNlUm9vdCI6IiJ9